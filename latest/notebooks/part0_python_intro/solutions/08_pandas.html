

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>08: Working with tabular data in Pandas &mdash; Python for Hydrology 1.0a documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../../_static/documentation_options.js?v=feab032e"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="09: GeoPandas - DataFrames with geometry for GIS applications" href="../09_a_Geopandas.html" />
    <link rel="prev" title="07b: VSCode Tutorial" href="../07b_VSCode.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Python for Hydrology
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Main Curriculum</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../part0.html">     Part 0: Introduction to Python</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../00_python_basics_review.html">00: Introduction to python for hydrologists</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_functions_script__solution.html">01: Functions and scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_Namespace_objects_modules_packages__solution.html">02: Namespace, modules, packages, and objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_useful-std-library-modules.html">03: Useful standard library modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_useful-std-library-modules-solutions.html">03: Solutions to Useful standard library modules exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_files_and_strings.html">04: File input and output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_numpy.html">05: NumPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_numpy__solutions.html">05: NumPy exercise solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_matplotlib__solution.html">06: <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> — 2D and 3D plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06b_matplotlib_animation.html">06a: Using Matplotlib to Create Animation</a></li>
<li class="toctree-l2"><a class="reference internal" href="07a_Theis-exercise-solution.html">07: Using functions to solve an equation– The Theis example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07b_VSCode.html">07b: VSCode Tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">08: Working with tabular data in Pandas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Not-that-type-of-Panda----Python's-Pandas-package">Not that type of Panda – Python’s Pandas package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Get-site-information-data-for-part-of-the-Russian-River-near-Guerneville,-CA-from-NWIS">Get site information data for part of the Russian River near Guerneville, CA from NWIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Viewing-data-in-pandas">Viewing data in pandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Getting-data-from-a-pandas-dataframe">Getting data from a pandas dataframe</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Selection-by-position">Selection by position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Selection-by-label">Selection by label</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Boolean-indexing">Boolean indexing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Reading-and-writing-data-to-.csv-files">Reading and writing data to <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Class-exercise-1">Class exercise 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Get-timeseries-data-from-NWIS-for-surface-water-sites">Get timeseries data from NWIS for surface water sites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Inspect-the-data-using-.plot()">Inspect the data using <code class="docutils literal notranslate"><span class="pre">.plot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Updating-column-names">Updating column names</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Adding-a-new-column-of-data-to-the-dataframe">Adding a new column of data to the dataframe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Manipulating-data">Manipulating data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#$-\frac{1-ft^3}{s}-\times-`:nbsphinx-math:frac{60s}{min}`-\times-`:nbsphinx-math:frac{60min}{hour}`-\times-`:nbsphinx-math:frac{24hours}{day}`-\rightarrow-`:nbsphinx-math:frac{ft^3}{day}`-$">$ <span class="math">\frac{1 ft^3}{s}</span> <span class="math">\times `:nbsphinx-math:</span>frac{60s}{min}` <span class="math">\times `:nbsphinx-math:</span>frac{60min}{hour}` <span class="math">\times `:nbsphinx-math:</span>frac{24hours}{day}` <span class="math">\rightarrow `:nbsphinx-math:</span>frac{ft^3}{day}` $</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Class-exercise-2:">Class exercise 2:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#groupby:-grouping-data-and-performing-mathematical-operations-on-it">groupby: grouping data and performing mathematical operations on it</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Joining-two-DataFrames-with-an-inner-join">Joining two <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> with an inner join</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Stepping-back-for-a-minute:-exploring-Merge-and-Concat">Stepping back for a minute: exploring Merge and Concat</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#The-merge-method">The <code class="docutils literal notranslate"><span class="pre">merge</span></code> method</a></li>
<li class="toctree-l4"><a class="reference internal" href="#The-concat-method">The <code class="docutils literal notranslate"><span class="pre">concat</span></code> method</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Back-to-working-with-our-climate-and-stream-data">Back to working with our climate and stream data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#.aggregate()"><code class="docutils literal notranslate"><span class="pre">.aggregate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Class-exercise-3:-groupy,-aggregate,-and-merge">Class exercise 3: groupy, aggregate, and merge</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Baseflow-separation">Baseflow separation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Class-exercise-4:-baseflow-separation">Class exercise 4: baseflow separation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Looking-at-trends-and-seasonal-cycles-in-the-data-with-statsmodels">Looking at trends and seasonal cycles in the data with <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Writing-yearly-plots-of-data-to-a-PDF-document">Writing yearly plots of data to a PDF document</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Back-to-the-basics:">Back to the basics:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Adjusting-a-whole-column-of-data-values">Adjusting a whole column of data values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#updating-values-by-position">updating values by position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#updating-values-based-on-location">updating values based on location</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Class-exercise-5:-setting-data">Class exercise 5: setting data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Now-for-some-powerful-analysis-using-fourier-analysis-to-extract-the-data's-signal.">Now for some powerful analysis using fourier analysis to extract the data’s signal.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Evaluate-and-plot-the-Period-Spectrum-to-see-timing-of-recurrence">Evaluate and plot the Period Spectrum to see timing of recurrence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Now-let's-look-at-the-whole-signal">Now let’s look at the whole signal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Okay,-what-about-years-before-dams-were-installed-on-the-Russian-River.">Okay, what about years before dams were installed on the Russian River.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#What-if-we-focus-in-on-after-1954?">What if we focus in on after 1954?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../09_a_Geopandas.html">09: GeoPandas - DataFrames with geometry for GIS applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="09_Geopandas__solutions.html">09: Geopandas exercise solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10_Rasterio.html">10: Using Rasterio and Numpy to examine ice loss on Mt. Rainier</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11_xarray_mt_rainier_precip.html">11: Using Xarray to look at Daymet precipitation around Mt. Rainier</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../part1.html">Part 1: Flopy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bonus Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../bonus_examples.html">     General Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../SOME_HELPFUL_LINKS.html"> Additional links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html"> Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary_of_jargon.html"> Glossary of jargon</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Python for Hydrology</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../part0.html">Part 0: General Python Exercises</a></li>
      <li class="breadcrumb-item active">08: Working with tabular data in Pandas</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/notebooks/part0_python_intro/solutions/08_pandas.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="08:-Working-with-tabular-data-in-Pandas">
<h1>08: Working with tabular data in Pandas<a class="headerlink" href="#08:-Working-with-tabular-data-in-Pandas" title="Link to this heading">¶</a></h1>
<p><img alt="b953c2d7bf1d4945af6bc89969974037" src="../../../_images/panda.jpg" /></p>
<section id="Not-that-type-of-Panda----Python's-Pandas-package">
<h2>Not that type of Panda – Python’s Pandas package<a class="headerlink" href="#Not-that-type-of-Panda----Python's-Pandas-package" title="Link to this heading">¶</a></h2>
<p>Pandas is a powerful, flexible and easy to use open source data analysis and manipulation tool. Pandas is commonly used for operations that would normally be done in a spreadsheet environment and includes powerful data analysis and manipulation tools.</p>
<p>Let’s begin by importing the libraries and setting our data path</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataretrieval</span><span class="w"> </span><span class="kn">import</span> <span class="n">nwis</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_pdf</span><span class="w"> </span><span class="kn">import</span> <span class="n">PdfPages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">detrend</span>

<span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;pandas&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Get-site-information-data-for-part-of-the-Russian-River-near-Guerneville,-CA-from-NWIS">
<h2>Get site information data for part of the Russian River near Guerneville, CA from NWIS<a class="headerlink" href="#Get-site-information-data-for-part-of-the-Russian-River-near-Guerneville,-CA-from-NWIS" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">123.10</span><span class="p">,</span> <span class="mf">38.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.90</span><span class="p">,</span> <span class="mf">38.55</span><span class="p">)</span>
<span class="n">info</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">nwis</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">bBox</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bbox</span><span class="p">])</span>
<span class="k">if</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="c1"># dataretreival now returns as geopandas dataframe, drop &quot;geometry&quot; column for this example</span>
    <span class="n">info</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">SSLEOFError</span>                               Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/connectionpool.py:464</span>, in <span class="ansi-cyan-fg">HTTPConnectionPool._make_request</span><span class="ansi-blue-fg">(self, conn, method, url, body, headers, retries, timeout, chunked, response_conn, preload_content, decode_content, enforce_content_length)</span>
<span class="ansi-green-fg">    463</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">464</span>     <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_validate_conn</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">conn</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    465</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> (SocketTimeout, BaseSSLError) <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/connectionpool.py:1093</span>, in <span class="ansi-cyan-fg">HTTPSConnectionPool._validate_conn</span><span class="ansi-blue-fg">(self, conn)</span>
<span class="ansi-green-fg">   1092</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> conn.is_closed:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1093</span>     <span class="ansi-yellow-bg">conn</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">connect</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1095</span> <span style="color: rgb(95,135,135)"># TODO revise this, see https://github.com/urllib3/urllib3/issues/2791</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/connection.py:790</span>, in <span class="ansi-cyan-fg">HTTPSConnection.connect</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg">    788</span> server_hostname_rm_dot = server_hostname.rstrip(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">.</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">790</span> sock_and_verified = <span class="ansi-yellow-bg">_ssl_wrap_socket_and_match_hostname</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    791</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">sock</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sock</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    792</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">cert_reqs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">cert_reqs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    793</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ssl_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ssl_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    794</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ssl_minimum_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ssl_minimum_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    795</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ssl_maximum_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ssl_maximum_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    796</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ca_certs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ca_certs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    797</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ca_cert_dir</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ca_cert_dir</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    798</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ca_cert_data</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ca_cert_data</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    799</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">cert_file</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">cert_file</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    800</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">key_file</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">key_file</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    801</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">key_password</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">key_password</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    802</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">server_hostname</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">server_hostname_rm_dot</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    803</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ssl_context</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ssl_context</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    804</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">tls_in_tls</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">tls_in_tls</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    805</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">assert_hostname</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">assert_hostname</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    806</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">assert_fingerprint</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">assert_fingerprint</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    807</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    808</span> <span style="color: rgb(0,135,0)">self</span>.sock = sock_and_verified.socket

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/connection.py:969</span>, in <span class="ansi-cyan-fg">_ssl_wrap_socket_and_match_hostname</span><span class="ansi-blue-fg">(sock, cert_reqs, ssl_version, ssl_minimum_version, ssl_maximum_version, cert_file, key_file, key_password, ca_certs, ca_cert_dir, ca_cert_data, assert_hostname, assert_fingerprint, server_hostname, ssl_context, tls_in_tls)</span>
<span class="ansi-green-fg">    967</span>         server_hostname = normalized
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">969</span> ssl_sock = <span class="ansi-yellow-bg">ssl_wrap_socket</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    970</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">sock</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sock</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    971</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">keyfile</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">key_file</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    972</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">certfile</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">cert_file</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    973</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">key_password</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">key_password</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    974</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ca_certs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">ca_certs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    975</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ca_cert_dir</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">ca_cert_dir</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    976</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ca_cert_data</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">ca_cert_data</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    977</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">server_hostname</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">server_hostname</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    978</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">ssl_context</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    979</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">tls_in_tls</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">tls_in_tls</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    980</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    982</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/util/ssl_.py:480</span>, in <span class="ansi-cyan-fg">ssl_wrap_socket</span><span class="ansi-blue-fg">(sock, keyfile, certfile, cert_reqs, ca_certs, server_hostname, ssl_version, ciphers, ssl_context, ca_cert_dir, key_password, ca_cert_data, tls_in_tls)</span>
<span class="ansi-green-fg">    478</span> context.set_alpn_protocols(ALPN_PROTOCOLS)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">480</span> ssl_sock = <span class="ansi-yellow-bg">_ssl_wrap_socket_impl</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">sock</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">tls_in_tls</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">server_hostname</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    481</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> ssl_sock

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/util/ssl_.py:524</span>, in <span class="ansi-cyan-fg">_ssl_wrap_socket_impl</span><span class="ansi-blue-fg">(sock, ssl_context, tls_in_tls, server_hostname)</span>
<span class="ansi-green-fg">    522</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> SSLTransport(sock, ssl_context, server_hostname)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">524</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">ssl_context</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">wrap_socket</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">sock</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">server_hostname</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">server_hostname</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/ssl.py:517</span>, in <span class="ansi-cyan-fg">SSLContext.wrap_socket</span><span class="ansi-blue-fg">(self, sock, server_side, do_handshake_on_connect, suppress_ragged_eofs, server_hostname, session)</span>
<span class="ansi-green-fg">    511</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">wrap_socket</span>(<span style="color: rgb(0,135,0)">self</span>, sock, server_side=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>,
<span class="ansi-green-fg">    512</span>                 do_handshake_on_connect=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    513</span>                 suppress_ragged_eofs=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    514</span>                 server_hostname=<span class="ansi-bold" style="color: rgb(0,135,0)">None</span>, session=<span class="ansi-bold" style="color: rgb(0,135,0)">None</span>):
<span class="ansi-green-fg">    515</span>     <span style="color: rgb(95,135,135)"># SSLSocket class handles server_hostname encoding before it calls</span>
<span class="ansi-green-fg">    516</span>     <span style="color: rgb(95,135,135)"># ctx._wrap_socket()</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">517</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">sslsocket_class</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_create</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    518</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">sock</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sock</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    519</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">server_side</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">server_side</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    520</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">do_handshake_on_connect</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">do_handshake_on_connect</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    521</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">suppress_ragged_eofs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">suppress_ragged_eofs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    522</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">server_hostname</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">server_hostname</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    523</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    524</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">session</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">session</span>
<span class="ansi-green-fg">    525</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/ssl.py:1104</span>, in <span class="ansi-cyan-fg">SSLSocket._create</span><span class="ansi-blue-fg">(cls, sock, server_side, do_handshake_on_connect, suppress_ragged_eofs, server_hostname, context, session)</span>
<span class="ansi-green-fg">   1103</span>                 <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">do_handshake_on_connect should not be specified for non-blocking sockets</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1104</span>             <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">do_handshake</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1105</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/ssl.py:1382</span>, in <span class="ansi-cyan-fg">SSLSocket.do_handshake</span><span class="ansi-blue-fg">(self, block)</span>
<span class="ansi-green-fg">   1381</span>         <span style="color: rgb(0,135,0)">self</span>.settimeout(<span class="ansi-bold" style="color: rgb(0,135,0)">None</span>)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1382</span>     <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_sslobj</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">do_handshake</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1383</span> <span class="ansi-bold" style="color: rgb(0,135,0)">finally</span>:

<span class="ansi-red-fg">SSLEOFError</span>: [SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1016)

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">SSLError</span>                                  Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/connectionpool.py:787</span>, in <span class="ansi-cyan-fg">HTTPConnectionPool.urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, preload_content, decode_content, **response_kw)</span>
<span class="ansi-green-fg">    786</span> <span style="color: rgb(95,135,135)"># Make the request on the HTTPConnection object</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">787</span> response = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_make_request</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    788</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">conn</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    789</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    790</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    791</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">timeout_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    792</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">body</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">body</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    793</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">headers</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">headers</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    794</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">chunked</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunked</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    795</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">retries</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">retries</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    796</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">response_conn</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">response_conn</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    797</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">preload_content</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">preload_content</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    798</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">decode_content</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_content</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    799</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">response_kw</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    800</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    802</span> <span style="color: rgb(95,135,135)"># Everything went great!</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/connectionpool.py:488</span>, in <span class="ansi-cyan-fg">HTTPConnectionPool._make_request</span><span class="ansi-blue-fg">(self, conn, method, url, body, headers, retries, timeout, chunked, response_conn, preload_content, decode_content, enforce_content_length)</span>
<span class="ansi-green-fg">    487</span>         new_e = _wrap_proxy_error(new_e, conn.proxy.scheme)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">488</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> new_e
<span class="ansi-green-fg">    490</span> <span style="color: rgb(95,135,135)"># conn.request() calls http.client.*.request, not the method in</span>
<span class="ansi-green-fg">    491</span> <span style="color: rgb(95,135,135)"># urllib3.request. It also calls makefile (recv) on the socket.</span>

<span class="ansi-red-fg">SSLError</span>: [SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1016)

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">MaxRetryError</span>                             Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/requests/adapters.py:644</span>, in <span class="ansi-cyan-fg">HTTPAdapter.send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-fg">    643</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">644</span>     resp = <span class="ansi-yellow-bg">conn</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">urlopen</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    645</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    646</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    647</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">body</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">body</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    648</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">headers</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">headers</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    649</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">redirect</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    650</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">assert_same_host</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    651</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">preload_content</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    652</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">decode_content</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    653</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">retries</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">max_retries</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    654</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    655</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">chunked</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunked</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    656</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    658</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> (ProtocolError, <span class="ansi-bold" style="color: rgb(215,95,95)">OSError</span>) <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> err:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/connectionpool.py:841</span>, in <span class="ansi-cyan-fg">HTTPConnectionPool.urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, preload_content, decode_content, **response_kw)</span>
<span class="ansi-green-fg">    839</span>     new_e = ProtocolError(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Connection aborted.</span><span class="ansi-yellow-fg">&#34;</span>, new_e)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">841</span> retries = <span class="ansi-yellow-bg">retries</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">increment</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    842</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">error</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">new_e</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">_pool</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">_stacktrace</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sys</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">exc_info</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">[</span><span class="ansi-green-fg ansi-yellow-bg">2</span><span class="ansi-yellow-bg">]</span>
<span class="ansi-green-fg">    843</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    844</span> retries.sleep()

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/urllib3/util/retry.py:519</span>, in <span class="ansi-cyan-fg">Retry.increment</span><span class="ansi-blue-fg">(self, method, url, response, error, _pool, _stacktrace)</span>
<span class="ansi-green-fg">    518</span>     reason = error <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> ResponseError(cause)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">519</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> MaxRetryError(_pool, url, reason) <span class="ansi-bold" style="color: rgb(0,135,0)">from</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">reason</span>  <span style="color: rgb(95,135,135)"># type: ignore[arg-type]</span>
<span class="ansi-green-fg">    521</span> log.debug(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Incremented Retry for (url=</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-bold" style="color: rgb(175,95,135)">%s</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">): </span><span class="ansi-bold" style="color: rgb(175,95,135)">%r</span><span class="ansi-yellow-fg">&#34;</span>, url, new_retry)

<span class="ansi-red-fg">MaxRetryError</span>: HTTPSConnectionPool(host=&#39;waterservices.usgs.gov&#39;, port=443): Max retries exceeded with url: /nwis/site?bBox=-123.1%2C38.45%2C-122.9%2C38.55&amp;siteOutput=Expanded&amp;format=rdb (Caused by SSLError(SSLEOFError(8, &#39;[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1016)&#39;)))

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">SSLError</span>                                  Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[2]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> bbox = (-<span class="ansi-green-fg">123.10</span>, <span class="ansi-green-fg">38.45</span>, -<span class="ansi-green-fg">122.90</span>, <span class="ansi-green-fg">38.55</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> info, metadata = <span class="ansi-yellow-bg">nwis</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_info</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">bBox</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">str</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">i</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">for</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">i</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,0,255)">in</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">geometry</span><span class="ansi-yellow-fg">&#39;</span> <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">list</span>(info):
<span class="ansi-green-fg">      4</span>     <span style="color: rgb(95,135,135)"># dataretreival now returns as geopandas dataframe, drop &#34;geometry&#34; column for this example</span>
<span class="ansi-green-fg">      5</span>     info.drop(columns=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">geometry</span><span class="ansi-yellow-fg">&#34;</span>], inplace=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/dataretrieval/nwis.py:816</span>, in <span class="ansi-cyan-fg">get_info</span><span class="ansi-blue-fg">(ssl_check, **kwargs)</span>
<span class="ansi-green-fg">    812</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    813</span>     <span style="color: rgb(95,135,135)"># cannot have both seriesCatalogOutput and the expanded format</span>
<span class="ansi-green-fg">    814</span>     kwargs[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">siteOutput</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Expanded</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">816</span> response = <span class="ansi-yellow-bg">query_waterservices</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">site</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ssl_check</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">ssl_check</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    818</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> _read_rdb(response.text), NWIS_Metadata(response, **kwargs)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/dataretrieval/nwis.py:633</span>, in <span class="ansi-cyan-fg">query_waterservices</span><span class="ansi-blue-fg">(service, ssl_check, **kwargs)</span>
<span class="ansi-green-fg">    629</span>     kwargs[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">format</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">rdb</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">    631</span> url = WATERSERVICE_URL + service
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">633</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">query</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">payload</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ssl_check</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">ssl_check</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/dataretrieval/utils.py:190</span>, in <span class="ansi-cyan-fg">query</span><span class="ansi-blue-fg">(url, payload, delimiter, ssl_check)</span>
<span class="ansi-green-fg">    183</span> <span style="color: rgb(95,135,135)"># for index in range(len(payload)):</span>
<span class="ansi-green-fg">    184</span> <span style="color: rgb(95,135,135)">#    key, value = payload[index]</span>
<span class="ansi-green-fg">    185</span> <span style="color: rgb(95,135,135)">#    payload[index] = (key, to_str(value))</span>
<span class="ansi-green-fg">    186</span>
<span class="ansi-green-fg">    187</span> <span style="color: rgb(95,135,135)"># define the user agent for the query</span>
<span class="ansi-green-fg">    188</span> user_agent = {<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">user-agent</span><span class="ansi-yellow-fg">&#34;</span>: <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">python-dataretrieval/</span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>dataretrieval.__version__<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span class="ansi-yellow-fg">&#34;</span>}
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">190</span> response = <span class="ansi-yellow-bg">requests</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">params</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">payload</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">headers</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">user_agent</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">verify</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">ssl_check</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    192</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> response.status_code == <span class="ansi-green-fg">400</span>:
<span class="ansi-green-fg">    193</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-fg">    194</span>         <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Bad Request, check that your parameters are correct. URL: </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>response.url<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">    195</span>     )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/requests/api.py:73</span>, in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(url, params, **kwargs)</span>
<span class="ansi-green-fg">     62</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">get</span>(url, params=<span class="ansi-bold" style="color: rgb(0,135,0)">None</span>, **kwargs):
<span class="ansi-green-fg">     63</span> <span style="color: rgb(188,188,188)">    </span><span class="ansi-yellow-fg">r</span><span class="ansi-yellow-fg">&#34;&#34;&#34;Sends a GET request.</span>
<span class="ansi-green-fg">     64</span>
<span class="ansi-green-fg">     65</span> <span class="ansi-yellow-fg">    :param url: URL for the new :class:`Request` object.</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">     70</span> <span class="ansi-yellow-fg">    :rtype: requests.Response</span>
<span class="ansi-green-fg">     71</span> <span class="ansi-yellow-fg">    &#34;&#34;&#34;</span>
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">73</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">get</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">params</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">params</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/requests/api.py:59</span>, in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(method, url, **kwargs)</span>
<span class="ansi-green-fg">     55</span> <span style="color: rgb(95,135,135)"># By using the &#39;with&#39; statement we are sure the session is closed, thus we</span>
<span class="ansi-green-fg">     56</span> <span style="color: rgb(95,135,135)"># avoid leaving sockets open which can trigger a ResourceWarning in some</span>
<span class="ansi-green-fg">     57</span> <span style="color: rgb(95,135,135)"># cases, and look like a memory leak in others.</span>
<span class="ansi-green-fg">     58</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> sessions.Session() <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> session:
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">59</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">session</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">method</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">url</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/requests/sessions.py:589</span>, in <span class="ansi-cyan-fg">Session.request</span><span class="ansi-blue-fg">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="ansi-green-fg">    584</span> send_kwargs = {
<span class="ansi-green-fg">    585</span>     <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">timeout</span><span class="ansi-yellow-fg">&#34;</span>: timeout,
<span class="ansi-green-fg">    586</span>     <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">allow_redirects</span><span class="ansi-yellow-fg">&#34;</span>: allow_redirects,
<span class="ansi-green-fg">    587</span> }
<span class="ansi-green-fg">    588</span> send_kwargs.update(settings)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">589</span> resp = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">send</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">prep</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">send_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    591</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> resp

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/requests/sessions.py:703</span>, in <span class="ansi-cyan-fg">Session.send</span><span class="ansi-blue-fg">(self, request, **kwargs)</span>
<span class="ansi-green-fg">    700</span> start = preferred_clock()
<span class="ansi-green-fg">    702</span> <span style="color: rgb(95,135,135)"># Send the request</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">703</span> r = <span class="ansi-yellow-bg">adapter</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">send</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    705</span> <span style="color: rgb(95,135,135)"># Total elapsed time of the request (approximately)</span>
<span class="ansi-green-fg">    706</span> elapsed = preferred_clock() - start

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/requests/adapters.py:675</span>, in <span class="ansi-cyan-fg">HTTPAdapter.send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-fg">    671</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> ProxyError(e, request=request)
<span class="ansi-green-fg">    673</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">isinstance</span>(e.reason, _SSLError):
<span class="ansi-green-fg">    674</span>         <span style="color: rgb(95,135,135)"># This branch is for urllib3 v1.22 and later.</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">675</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> SSLError(e, request=request)
<span class="ansi-green-fg">    677</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ConnectionError</span>(e, request=request)
<span class="ansi-green-fg">    679</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> ClosedPoolError <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:

<span class="ansi-red-fg">SSLError</span>: HTTPSConnectionPool(host=&#39;waterservices.usgs.gov&#39;, port=443): Max retries exceeded with url: /nwis/site?bBox=-123.1%2C38.45%2C-122.9%2C38.55&amp;siteOutput=Expanded&amp;format=rdb (Caused by SSLError(SSLEOFError(8, &#39;[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1016)&#39;)))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;site_info.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">info</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[3]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">info</span>.to_csv(data_path / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">site_info.csv</span><span class="ansi-yellow-fg">&#34;</span>, index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)
<span class="ansi-green-fg">      2</span> info.head()

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<p>Wow that’s a lot of gages in this location, let’s info on all of them and then use this data to learn about pandas</p>
<p>The data returned to us from our NWIS query <code class="docutils literal notranslate"><span class="pre">info</span></code> was returned to us as pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. We’ll be working with this to start learning about the basics of pandas.</p>
</section>
<section id="Viewing-data-in-pandas">
<h2>Viewing data in pandas<a class="headerlink" href="#Viewing-data-in-pandas" title="Link to this heading">¶</a></h2>
<p>Pandas has built in methods to inspect <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects. We’ll look at a few handy methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.head()</span></code>: inspect the first few rows of data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.tail()</span></code>: inspect the last few rows of data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.index()</span></code>: show the row indexes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.columns()</span></code>: show the column names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.describe()</span></code>: statistically describe the data</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[4]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">info</span>.head()

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[5]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">info</span>.tail()

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print the index names</span>
<span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[6]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># print the index names</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-bg">info</span>.index)

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print the column names</span>
<span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># print the column names as a list</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[7]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># print the column names</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-bg">info</span>.columns)
<span class="ansi-green-fg">      4</span> <span style="color: rgb(95,135,135)"># print the column names as a list</span>
<span class="ansi-green-fg">      5</span> <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(0,135,0)">list</span>(info))

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">describe()</span></code> method is only useful for numerical data. This example is does not have a lot of useful data for <code class="docutils literal notranslate"><span class="pre">describe()</span></code>, however we’ll use it again later</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[8]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">info</span>.describe()

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Getting-data-from-a-pandas-dataframe">
<h2>Getting data from a pandas dataframe<a class="headerlink" href="#Getting-data-from-a-pandas-dataframe" title="Link to this heading">¶</a></h2>
<p>There are multiple methods to get data out of a pandas dataframe as either a “series”, numpy array, or a list</p>
<p>Let’s start by getting data as a series using a few methods</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get a series of site numbers by key</span>
<span class="n">info</span><span class="p">[</span><span class="s2">&quot;site_no&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[9]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># get a series of site numbers by key</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">info</span>[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">site_no</span><span class="ansi-yellow-fg">&#34;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get station names by attribute</span>
<span class="n">info</span><span class="o">.</span><span class="n">station_nm</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[10]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># get station names by attribute</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">info</span>.station_nm

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<p>getting data from a dataframe as a numpy array can be accomplished by using <code class="docutils literal notranslate"><span class="pre">.values</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="o">.</span><span class="n">station_nm</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[11]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">info</span>.station_nm.values

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<section id="Selection-by-position">
<h3>Selection by position<a class="headerlink" href="#Selection-by-position" title="Link to this heading">¶</a></h3>
<p>We can get data by position in the dataframe using the <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> attribute</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[12]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">info</span>.iloc[<span class="ansi-green-fg">0</span>:<span class="ansi-green-fg">2</span>, <span class="ansi-green-fg">1</span>:<span class="ansi-green-fg">4</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Selection-by-label">
<h3>Selection by label<a class="headerlink" href="#Selection-by-label" title="Link to this heading">¶</a></h3>
<p>Pandas allows the user to get data from the dataframe by index and column labels</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;site_no&quot;</span><span class="p">,</span> <span class="s2">&quot;station_nm&quot;</span><span class="p">,</span> <span class="s2">&quot;site_tp_cd&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[13]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">info</span>.loc[<span class="ansi-green-fg">0</span>:<span class="ansi-green-fg">3</span>, [<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">site_no</span><span class="ansi-yellow-fg">&#34;</span>, <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">station_nm</span><span class="ansi-yellow-fg">&#34;</span>, <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">site_tp_cd</span><span class="ansi-yellow-fg">&#34;</span>]]

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Boolean-indexing">
<h3>Boolean indexing<a class="headerlink" href="#Boolean-indexing" title="Link to this heading">¶</a></h3>
<p>pandas dataframes supports boolean indexing that allows a user to create a new dataframe with only the data that meets a boolean condition defined by the user.</p>
<p>Let’s get a dataframe of only groundwater sites from the <code class="docutils literal notranslate"><span class="pre">info</span></code> dataframe</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfgw</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;site_tp_cd&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;GW&quot;</span><span class="p">]</span>
<span class="n">dfgw</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[14]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> dfgw = <span class="ansi-yellow-bg">info</span>[info[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">site_tp_cd</span><span class="ansi-yellow-fg">&#34;</span>] == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">GW</span><span class="ansi-yellow-fg">&#34;</span>]
<span class="ansi-green-fg">      2</span> dfgw

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Reading-and-writing-data-to-.csv-files">
<h3>Reading and writing data to <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files<a class="headerlink" href="#Reading-and-writing-data-to-.csv-files" title="Link to this heading">¶</a></h3>
<p>Pandas has support to both read and write many types of files. For this example we are focusing on <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files. For information on other file types that are supported see the <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/10min.html#importing-and-exporting-data">ten minutes to pandas</a> tutorial documentation</p>
<p>For this part we’ll write a new <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file of the groundwater sites that we found in NWIS using <code class="docutils literal notranslate"><span class="pre">to_csv()</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">to_csv()</span></code> has a bunch of handy options for writing to file. For this example, I’m going to drop the index column while writing by passing <code class="docutils literal notranslate"><span class="pre">index=False</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csv_file</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;RussianRiverGWsites.csv&quot;</span>
<span class="n">dfgw</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[15]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> csv_file = data_path / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">RussianRiverGWsites.csv</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">dfgw</span>.to_csv(csv_file, index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;dfgw&#39; is not defined
</pre></div></div>
</div>
<p>Now we can load the csv file back into a pandas dataframe with the <code class="docutils literal notranslate"><span class="pre">read_csv()</span></code> method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfgw2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
<span class="n">dfgw2</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>agency_cd</th>
      <th>site_no</th>
      <th>station_nm</th>
      <th>site_tp_cd</th>
      <th>lat_va</th>
      <th>long_va</th>
      <th>dec_lat_va</th>
      <th>dec_long_va</th>
      <th>coord_meth_cd</th>
      <th>coord_acy_cd</th>
      <th>...</th>
      <th>local_time_fg</th>
      <th>reliability_cd</th>
      <th>gw_file_cd</th>
      <th>nat_aqfr_cd</th>
      <th>aqfr_cd</th>
      <th>aqfr_type_cd</th>
      <th>well_depth_va</th>
      <th>hole_depth_va</th>
      <th>depth_src_cd</th>
      <th>project_no</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>USGS</td>
      <td>382713123030401</td>
      <td>007N011W14NU01M</td>
      <td>GW</td>
      <td>382712.5</td>
      <td>1230303.5</td>
      <td>38.453472</td>
      <td>-123.050972</td>
      <td>G</td>
      <td>5</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY   Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>81.70</td>
      <td>NaN</td>
      <td>S</td>
      <td>GGMC200</td>
    </tr>
    <tr>
      <th>1</th>
      <td>USGS</td>
      <td>382713123030403</td>
      <td>007N011W14NU03M</td>
      <td>GW</td>
      <td>382712.5</td>
      <td>1230303.5</td>
      <td>38.453472</td>
      <td>-123.050972</td>
      <td>G</td>
      <td>5</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY   Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>32.56</td>
      <td>NaN</td>
      <td>S</td>
      <td>GGMC200</td>
    </tr>
    <tr>
      <th>2</th>
      <td>USGS</td>
      <td>382808122565401</td>
      <td>007N010W10H001M</td>
      <td>GW</td>
      <td>382808.5</td>
      <td>1225654.2</td>
      <td>38.469028</td>
      <td>-122.948389</td>
      <td>G</td>
      <td>5</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY   Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.00</td>
      <td>22.0</td>
      <td>D</td>
      <td>00BHM8187</td>
    </tr>
    <tr>
      <th>3</th>
      <td>USGS</td>
      <td>382819123010001</td>
      <td>007N010W07D001M</td>
      <td>GW</td>
      <td>382819.9</td>
      <td>1230100.8</td>
      <td>38.472194</td>
      <td>-123.016889</td>
      <td>G</td>
      <td>5</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY</td>
      <td>N100CACSTL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>99.00</td>
      <td>110.0</td>
      <td>D</td>
      <td>9677BHM32</td>
    </tr>
    <tr>
      <th>4</th>
      <td>USGS</td>
      <td>383001122540701</td>
      <td>008N009W31C002M</td>
      <td>GW</td>
      <td>383001.9</td>
      <td>1225407.7</td>
      <td>38.500528</td>
      <td>-122.902139</td>
      <td>G</td>
      <td>5</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY</td>
      <td>N100CACSTL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>80.00</td>
      <td>80.0</td>
      <td>D</td>
      <td>9677BHM32</td>
    </tr>
    <tr>
      <th>5</th>
      <td>USGS</td>
      <td>383003122540401</td>
      <td>008N009W31C003M</td>
      <td>GW</td>
      <td>383003.3</td>
      <td>1225404.4</td>
      <td>38.500917</td>
      <td>-122.901222</td>
      <td>G</td>
      <td>1</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY   Y</td>
      <td>N100CACSTL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>967760420</td>
    </tr>
    <tr>
      <th>6</th>
      <td>USGS</td>
      <td>383003122540402</td>
      <td>008N009W31C004M</td>
      <td>GW</td>
      <td>383003.3</td>
      <td>1225404.4</td>
      <td>38.500917</td>
      <td>-122.901222</td>
      <td>G</td>
      <td>1</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>Y</td>
      <td>N100CACSTL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>967760420</td>
    </tr>
    <tr>
      <th>7</th>
      <td>USGS</td>
      <td>383003122540403</td>
      <td>008N009W31C005M</td>
      <td>GW</td>
      <td>383003.3</td>
      <td>1225404.4</td>
      <td>38.500917</td>
      <td>-122.901222</td>
      <td>G</td>
      <td>1</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY   Y</td>
      <td>N100CACSTL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>25.00</td>
      <td>NaN</td>
      <td>S</td>
      <td>967760420</td>
    </tr>
    <tr>
      <th>8</th>
      <td>USGS</td>
      <td>383016123041101</td>
      <td>008N011W27N001M</td>
      <td>GW</td>
      <td>383016.3</td>
      <td>1230411.0</td>
      <td>38.504528</td>
      <td>-123.069722</td>
      <td>G</td>
      <td>5</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY   Y</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>30.00</td>
      <td>30.0</td>
      <td>D</td>
      <td>00BHM8187</td>
    </tr>
    <tr>
      <th>9</th>
      <td>USGS</td>
      <td>383017122580301</td>
      <td>008N010W28RU01M</td>
      <td>GW</td>
      <td>383017.4</td>
      <td>1225802.5</td>
      <td>38.504833</td>
      <td>-122.967361</td>
      <td>G</td>
      <td>5</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>98.00</td>
      <td>107.0</td>
      <td>D</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10</th>
      <td>USGS</td>
      <td>383034122590701</td>
      <td>008N010W29H004M</td>
      <td>GW</td>
      <td>383034.4</td>
      <td>1225907.9</td>
      <td>38.509556</td>
      <td>-122.985528</td>
      <td>G</td>
      <td>5</td>
      <td>...</td>
      <td>Y</td>
      <td>C</td>
      <td>YY   Y</td>
      <td>N100CACSTL</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>99.00</td>
      <td>110.0</td>
      <td>D</td>
      <td>9677BHM32</td>
    </tr>
  </tbody>
</table>
<p>11 rows × 42 columns</p>
</div></div>
</div>
</section>
</section>
<section id="Class-exercise-1">
<h2>Class exercise 1<a class="headerlink" href="#Class-exercise-1" title="Link to this heading">¶</a></h2>
<p>Using the methods presented in this notebook create a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> of surface water sites from the <code class="docutils literal notranslate"><span class="pre">info</span></code> dataframe, write it to a csv file named <code class="docutils literal notranslate"><span class="pre">&quot;RussianRiverSWsites.csv&quot;</span></code>, and read it back in as a new <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csv_name</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;RussianRiverSWsites.csv&quot;</span>
<span class="n">dfsw</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">site_tp_cd</span> <span class="o">==</span> <span class="s2">&quot;ST&quot;</span><span class="p">]</span>
<span class="n">dfsw</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">dfsw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_name</span><span class="p">)</span>
<span class="n">dfsw</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[17]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> csv_name = data_path / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">RussianRiverSWsites.csv</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> dfsw = <span class="ansi-yellow-bg">info</span>[info.site_tp_cd == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">ST</span><span class="ansi-yellow-fg">&#34;</span>]
<span class="ansi-green-fg">      3</span> dfsw.to_csv(csv_name, index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)
<span class="ansi-green-fg">      5</span> dfsw = pd.read_csv(csv_name)

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Get-timeseries-data-from-NWIS-for-surface-water-sites">
<h2>Get timeseries data from NWIS for surface water sites<a class="headerlink" href="#Get-timeseries-data-from-NWIS-for-surface-water-sites" title="Link to this heading">¶</a></h2>
<p>Now to start working with stream gage data from NWIS. We’re going to send all surface water sites to NWIS and get only sites with daily discharge measurements.</p>
<p>(<a class="reference external" href="https://waterdata.usgs.gov/nwis/inventory?agency_code=USGS&amp;site_no=11467002">11467002</a>)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># filter for only SW sites</span>
<span class="n">dfsw</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">site_tp_cd</span> <span class="o">==</span> <span class="s2">&quot;ST&quot;</span><span class="p">]</span>

<span class="c1"># create query</span>
<span class="n">sites</span> <span class="o">=</span> <span class="n">dfsw</span><span class="o">.</span><span class="n">site_no</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">pcode</span> <span class="o">=</span> <span class="s2">&quot;00060&quot;</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s2">&quot;1939-09-22&quot;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s2">&quot;2023-12-31&quot;</span>
<span class="n">df</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">nwis</span><span class="o">.</span><span class="n">get_dv</span><span class="p">(</span>
    <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
    <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
    <span class="n">parameterCd</span><span class="o">=</span><span class="n">pcode</span><span class="p">,</span>
    <span class="n">multi_index</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[18]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># filter for only SW sites</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> dfsw = <span class="ansi-yellow-bg">info</span>[info.site_tp_cd == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">ST</span><span class="ansi-yellow-fg">&#34;</span>]
<span class="ansi-green-fg">      4</span> <span style="color: rgb(95,135,135)"># create query</span>
<span class="ansi-green-fg">      5</span> sites = dfsw.site_no.to_list()

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<p>Awesome! There are two gages in this study area that have daily discharge data!</p>
<section id="Inspect-the-data-using-.plot()">
<h3>Inspect the data using <code class="docutils literal notranslate"><span class="pre">.plot()</span></code><a class="headerlink" href="#Inspect-the-data-using-.plot()" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;cubic meter per second&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[19]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> ax = <span class="ansi-yellow-bg">df</span>.plot()
<span class="ansi-green-fg">      2</span> ax.set_ylabel(<span class="ansi-yellow-fg">r</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">cubic meter per second</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      3</span> ax.set_yscale(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">log</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Updating-column-names">
<h3>Updating column names<a class="headerlink" href="#Updating-column-names" title="Link to this heading">¶</a></h3>
<p>Let’s update column names for these gages based on their locations instead of their USGS gage id. First we’ll get name information from the <code class="docutils literal notranslate"><span class="pre">info</span></code> class and then we’ll use the station name information to remap the column names.</p>
<p>the <code class="docutils literal notranslate"><span class="pre">rename()</span></code> method accepts a dictionary that is formatted <code class="docutils literal notranslate"><span class="pre">{current_col_name:</span> <span class="pre">new_col_name}</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[20]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">df</span>

<span class="ansi-red-fg">NameError</span>: name &#39;df&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;site_no&#39;</span><span class="p">,</span> <span class="s1">&#39;00060_Mean&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;site_no&#39;</span><span class="p">])</span>
<span class="n">df2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">site_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">site_no</span><span class="p">:</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">site_no</span><span class="p">,</span> <span class="n">name</span>
              <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;site_no&#39;</span><span class="p">)[</span><span class="s1">&#39;station_nm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">df2</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">site_names</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[21]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df2 = <span class="ansi-yellow-bg">df</span>[[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">site_no</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">00060_Mean</span><span class="ansi-yellow-fg">&#39;</span>]].pivot(columns=[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">site_no</span><span class="ansi-yellow-fg">&#39;</span>])
<span class="ansi-green-fg">      2</span> df2.columns = df2.columns.get_level_values(<span class="ansi-green-fg">1</span>)
<span class="ansi-green-fg">      4</span> site_names = {site_no: <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">_</span><span class="ansi-yellow-fg">&#39;</span>.join(name.split()[:<span class="ansi-green-fg">2</span>]).lower() <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> site_no, name
<span class="ansi-green-fg">      5</span>               <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> info.groupby(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">site_no</span><span class="ansi-yellow-fg">&#39;</span>)[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">station_nm</span><span class="ansi-yellow-fg">&#39;</span>].first().loc[df2.columns].items()}

<span class="ansi-red-fg">NameError</span>: name &#39;df&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Adding-a-new-column-of-data-to-the-dataframe">
<h3>Adding a new column of data to the dataframe<a class="headerlink" href="#Adding-a-new-column-of-data-to-the-dataframe" title="Link to this heading">¶</a></h3>
<p>Adding new columns of data is relatively simple in pandas. The call signature is similar to a dictionary where df[“key”] = “some_array_of_values”</p>
<p>Let’s add a year column (water year) to the dataframe by getting the year from the index and adjusting it using <code class="docutils literal notranslate"><span class="pre">np.where()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;=</span><span class="mi">10</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[22]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df2[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#39;</span>] = np.where(<span class="ansi-yellow-bg">df2</span>.index.month &gt;=<span class="ansi-green-fg">10</span>, df2.index.year, df2.index.year - <span class="ansi-green-fg">1</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Manipulating-data">
<h3>Manipulating data<a class="headerlink" href="#Manipulating-data" title="Link to this heading">¶</a></h3>
<p>Columns in a pandas dataframe can be manipulated similarly to working with a dictionary of numpy arrays. The discharge data units are <span class="math notranslate nohighlight">\(\frac{ft^3}{s}\)</span>, let’s accumulate this to daily discharge in <span class="math notranslate nohighlight">\(\frac {ft^3}{d}\)</span>.</p>
<p>The conversion for this is:</p>
</section>
</section>
<section id="$-\frac{1-ft^3}{s}-\times-`:nbsphinx-math:frac{60s}{min}`-\times-`:nbsphinx-math:frac{60min}{hour}`-\times-`:nbsphinx-math:frac{24hours}{day}`-\rightarrow-`:nbsphinx-math:frac{ft^3}{day}`-$">
<h2>$ <span class="math">\frac{1 ft^3}{s}</span> <span class="math">\times `:nbsphinx-math:</span>frac{60s}{min}` <span class="math">\times `:nbsphinx-math:</span>frac{60min}{hour}` <span class="math">\times `:nbsphinx-math:</span>frac{24hours}{day}` <span class="math">\rightarrow `:nbsphinx-math:</span>frac{ft^3}{day}` $<a class="headerlink" href="#$-\frac{1-ft^3}{s}-\times-`:nbsphinx-math:frac{60s}{min}`-\times-`:nbsphinx-math:frac{60min}{hour}`-\times-`:nbsphinx-math:frac{24hours}{day}`-\rightarrow-`:nbsphinx-math:frac{ft^3}{day}`-$" title="Link to this heading">¶</a></h2>
<p>and then convert that to acre-feet (1 acre-ft = 43559.9)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[23]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">df2</span>

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conv</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span>
<span class="n">df2</span><span class="p">[</span><span class="s2">&quot;russian_r_cfd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">russian_r</span> <span class="o">*</span> <span class="n">conv</span>
<span class="n">df2</span><span class="p">[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">russian_r_cfd</span> <span class="o">/</span> <span class="mf">43559.9</span>
<span class="n">df2</span>

<span class="c1"># now let&#39;s plot up discharge from 2018 - 2020</span>
<span class="n">dfplt</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2015</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2020</span><span class="p">)]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">dfplt</span><span class="p">[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[24]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> conv = <span class="ansi-green-fg">60</span> * <span class="ansi-green-fg">60</span> * <span class="ansi-green-fg">24</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_cfd</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-yellow-bg">df2</span>.russian_r * conv
<span class="ansi-green-fg">      3</span> df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>] = df2.russian_r_cfd / <span class="ansi-green-fg">43559.9</span>
<span class="ansi-green-fg">      4</span> df2

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Class-exercise-2:">
<h2>Class exercise 2:<a class="headerlink" href="#Class-exercise-2:" title="Link to this heading">¶</a></h2>
<p>Using the methods described in the notebook. Convert the discharge for <code class="docutils literal notranslate"><span class="pre">&quot;austin_c&quot;</span></code> from <span class="math notranslate nohighlight">\(\frac{m^3}{s}\)</span> acre-ft by adding two additional fields to <code class="docutils literal notranslate"><span class="pre">df2</span></code> named <code class="docutils literal notranslate"><span class="pre">&quot;austin_c_cfs&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;austin_c_af&quot;</span></code>.</p>
<p>After these two fields have been added to df2 use boolean indexing to create a new dataframe from 2015 through 2020. Finally plot the discharge data (in acre-ft) for “austin_cr”.</p>
<p><strong>bonus exercise</strong> try to plot both <code class="docutils literal notranslate"><span class="pre">&quot;russian_r_af&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;austin_c_af&quot;</span></code> on the same plot</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conv</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span>
<span class="n">df2</span><span class="p">[</span><span class="s2">&quot;austin_c_cfd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">austin_c</span> <span class="o">*</span> <span class="n">conv</span>
<span class="n">df2</span><span class="p">[</span><span class="s2">&quot;austin_c_af&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">austin_c_cfd</span> <span class="o">/</span> <span class="mf">43559.9</span>
<span class="n">df2</span>

<span class="c1"># now let&#39;s plot up discharge from 2018 - 2020</span>
<span class="n">dfplt</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2015</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2020</span><span class="p">)]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">dfplt</span><span class="p">[</span><span class="s2">&quot;austin_c_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[25]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> conv = <span class="ansi-green-fg">60</span> * <span class="ansi-green-fg">60</span> * <span class="ansi-green-fg">24</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">austin_c_cfd</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-yellow-bg">df2</span>.austin_c * conv
<span class="ansi-green-fg">      3</span> df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">austin_c_af</span><span class="ansi-yellow-fg">&#34;</span>] = df2.austin_c_cfd / <span class="ansi-green-fg">43559.9</span>
<span class="ansi-green-fg">      4</span> df2

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now let&#39;s plot up discharge from 2018 - 2020</span>
<span class="n">dfplt</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2015</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2020</span><span class="p">)]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">dfplt</span><span class="p">[[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">,</span><span class="s2">&quot;austin_c_af&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[26]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># now let&#39;s plot up discharge from 2018 - 2020</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> dfplt = <span class="ansi-yellow-bg">df2</span>[(df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>] &gt;= <span class="ansi-green-fg">2015</span>) &amp; (df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>] &lt;= <span class="ansi-green-fg">2020</span>)]
<span class="ansi-green-fg">      3</span> ax = dfplt[[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>,<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">austin_c_af</span><span class="ansi-yellow-fg">&#34;</span>]].plot()
<span class="ansi-green-fg">      4</span> ax.set_yscale(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">log</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<section id="groupby:-grouping-data-and-performing-mathematical-operations-on-it">
<h3>groupby: grouping data and performing mathematical operations on it<a class="headerlink" href="#groupby:-grouping-data-and-performing-mathematical-operations-on-it" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">groupby()</span></code> is a powerful method that allows for performing statistical operations over a groups of “common” data within a dataframe.</p>
<p>For this example we’ll use it to get mean daily flows for the watershed. Pandas will group all common days of the year with each other and then calculate the mean value of these via the function <code class="docutils literal notranslate"><span class="pre">.mean()</span></code>. <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> also supports other operations such as <code class="docutils literal notranslate"><span class="pre">.median()</span></code>, <code class="docutils literal notranslate"><span class="pre">.sum()</span></code>, <code class="docutils literal notranslate"><span class="pre">max()</span></code>, <code class="docutils literal notranslate"><span class="pre">min()</span></code>, <code class="docutils literal notranslate"><span class="pre">std()</span></code>, and other functions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;day_of_year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day_of_year</span>

<span class="n">df_mean_day</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;day_of_year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">,</span> <span class="s2">&quot;austin_c_af&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_mean_day</span><span class="p">[[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">,</span> <span class="s2">&quot;austin_c_af&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[27]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">day_of_year</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-yellow-bg">df2</span>.index.day_of_year
<span class="ansi-green-fg">      3</span> df_mean_day = df2.groupby(by=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">day_of_year</span><span class="ansi-yellow-fg">&#34;</span>], as_index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)[[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>, <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">austin_c_af</span><span class="ansi-yellow-fg">&#34;</span>]].mean()
<span class="ansi-green-fg">      4</span> ax = df_mean_day[[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>, <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">austin_c_af</span><span class="ansi-yellow-fg">&#34;</span>]].plot()

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<p>We can see that around March flow starts decreasing heavily and doesn’t recover until sometime in october. What’s going on here? Let’s load some climate data and see what’s happening.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cimis_file</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;santa_rosa_CIMIS_83.csv&quot;</span>
<span class="n">df_cimis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">cimis_file</span><span class="p">)</span>
<span class="n">drop_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;qc&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;qc.</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">)]</span>
<span class="n">df_cimis</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">drop_list</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_cimis</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Stn Id</th>
      <th>Stn Name</th>
      <th>CIMIS Region</th>
      <th>Date</th>
      <th>Jul</th>
      <th>ETo (in)</th>
      <th>Precip (in)</th>
      <th>Sol Rad (Ly/day)</th>
      <th>Avg Vap Pres (mBars)</th>
      <th>Max Air Temp (F)</th>
      <th>...</th>
      <th>Rose NNE</th>
      <th>Rose ENE</th>
      <th>Rose ESE</th>
      <th>Rose SSE</th>
      <th>Rose SSW</th>
      <th>Rose WSW</th>
      <th>Rose WNW</th>
      <th>Rose NNW</th>
      <th>Wind Run (miles)</th>
      <th>Avg Soil Temp (F)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/1/1990</td>
      <td>1</td>
      <td>0.00</td>
      <td>0.30</td>
      <td>42.0</td>
      <td>7.7</td>
      <td>48.7</td>
      <td>...</td>
      <td>0.03</td>
      <td>0.02</td>
      <td>0.06</td>
      <td>0.06</td>
      <td>0.04</td>
      <td>0.10</td>
      <td>0.15</td>
      <td>0.14</td>
      <td>32.1</td>
      <td>46.3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/2/1990</td>
      <td>2</td>
      <td>0.06</td>
      <td>0.00</td>
      <td>236.0</td>
      <td>6.1</td>
      <td>58.4</td>
      <td>...</td>
      <td>0.06</td>
      <td>0.01</td>
      <td>0.04</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.06</td>
      <td>0.45</td>
      <td>1.53</td>
      <td>121.0</td>
      <td>44.9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/3/1990</td>
      <td>3</td>
      <td>0.04</td>
      <td>0.00</td>
      <td>225.0</td>
      <td>5.8</td>
      <td>63.0</td>
      <td>...</td>
      <td>0.08</td>
      <td>0.04</td>
      <td>0.10</td>
      <td>0.04</td>
      <td>0.06</td>
      <td>0.05</td>
      <td>0.21</td>
      <td>0.23</td>
      <td>44.5</td>
      <td>43.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/4/1990</td>
      <td>4</td>
      <td>0.03</td>
      <td>0.01</td>
      <td>190.0</td>
      <td>6.3</td>
      <td>56.7</td>
      <td>...</td>
      <td>0.07</td>
      <td>0.07</td>
      <td>0.11</td>
      <td>0.07</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.08</td>
      <td>0.09</td>
      <td>30.2</td>
      <td>42.8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/5/1990</td>
      <td>5</td>
      <td>0.04</td>
      <td>0.00</td>
      <td>192.0</td>
      <td>7.2</td>
      <td>59.1</td>
      <td>...</td>
      <td>0.08</td>
      <td>0.13</td>
      <td>0.33</td>
      <td>0.08</td>
      <td>0.04</td>
      <td>0.08</td>
      <td>0.07</td>
      <td>0.05</td>
      <td>45.2</td>
      <td>43.7</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11948</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>9/18/2022</td>
      <td>261</td>
      <td>0.03</td>
      <td>0.77</td>
      <td>113.0</td>
      <td>16.4</td>
      <td>66.8</td>
      <td>...</td>
      <td>0.01</td>
      <td>0.04</td>
      <td>0.29</td>
      <td>0.51</td>
      <td>0.14</td>
      <td>0.01</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>197.4</td>
      <td>65.2</td>
    </tr>
    <tr>
      <th>11949</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>9/19/2022</td>
      <td>262</td>
      <td>0.14</td>
      <td>0.02</td>
      <td>424.0</td>
      <td>15.6</td>
      <td>73.9</td>
      <td>...</td>
      <td>0.09</td>
      <td>0.07</td>
      <td>0.08</td>
      <td>0.17</td>
      <td>0.09</td>
      <td>0.28</td>
      <td>0.15</td>
      <td>0.07</td>
      <td>108.9</td>
      <td>65.9</td>
    </tr>
    <tr>
      <th>11950</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>9/20/2022</td>
      <td>263</td>
      <td>0.10</td>
      <td>0.00</td>
      <td>330.0</td>
      <td>13.9</td>
      <td>72.6</td>
      <td>...</td>
      <td>0.08</td>
      <td>0.04</td>
      <td>0.10</td>
      <td>0.11</td>
      <td>0.18</td>
      <td>0.25</td>
      <td>0.15</td>
      <td>0.10</td>
      <td>79.6</td>
      <td>65.8</td>
    </tr>
    <tr>
      <th>11951</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>9/21/2022</td>
      <td>264</td>
      <td>0.15</td>
      <td>0.07</td>
      <td>458.0</td>
      <td>14.8</td>
      <td>75.5</td>
      <td>...</td>
      <td>0.09</td>
      <td>0.05</td>
      <td>0.13</td>
      <td>0.16</td>
      <td>0.18</td>
      <td>0.22</td>
      <td>0.08</td>
      <td>0.09</td>
      <td>103.3</td>
      <td>66.7</td>
    </tr>
    <tr>
      <th>11952</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>9/22/2022</td>
      <td>265</td>
      <td>0.17</td>
      <td>0.00</td>
      <td>494.0</td>
      <td>13.1</td>
      <td>82.9</td>
      <td>...</td>
      <td>0.14</td>
      <td>0.06</td>
      <td>0.09</td>
      <td>0.10</td>
      <td>0.11</td>
      <td>0.20</td>
      <td>0.12</td>
      <td>0.19</td>
      <td>83.7</td>
      <td>66.3</td>
    </tr>
  </tbody>
</table>
<p>11953 rows × 27 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_mean_clim</span> <span class="o">=</span> <span class="n">df_cimis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Jul&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[[</span><span class="s2">&quot;ETo (in)&quot;</span><span class="p">,</span> <span class="s2">&quot;Precip (in)&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df_mean_clim</span> <span class="o">=</span> <span class="n">df_mean_clim</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Jul&quot;</span><span class="p">:</span> <span class="s2">&quot;day_of_year&quot;</span><span class="p">})</span>
<span class="n">df_mean_clim</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>day_of_year</th>
      <th>ETo (in)</th>
      <th>Precip (in)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0.031212</td>
      <td>0.335455</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0.031212</td>
      <td>0.155152</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>0.030303</td>
      <td>0.195484</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0.030909</td>
      <td>0.190303</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0.034242</td>
      <td>0.150000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Joining-two-DataFrames-with-an-inner-join">
<h3>Joining two <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> with an inner join<a class="headerlink" href="#Joining-two-DataFrames-with-an-inner-join" title="Link to this heading">¶</a></h3>
<p>Inner joins can be made in pandas with the <code class="docutils literal notranslate"><span class="pre">merge()</span></code> method. As inner join, joins two dataframes on a common key or values, when a key or value exists in one dataframe, but not the other that row of data will be excluded from the joined dataframe.</p>
<p>There are a number of other ways to join dataframes in pandas. Detailed examples and discussion of the different merging methods can be found <a class="reference external" href="https://realpython.com/pandas-merge-join-and-concat/">here</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_mean_day</span><span class="p">,</span> <span class="n">df_mean_clim</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;day_of_year&quot;</span><span class="p">,])</span>
<span class="n">df_merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[30]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df_merged = pd.merge(<span class="ansi-yellow-bg">df_mean_day</span>, df_mean_clim, on=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">day_of_year</span><span class="ansi-yellow-fg">&#34;</span>,])
<span class="ansi-green-fg">      2</span> df_merged.head()

<span class="ansi-red-fg">NameError</span>: name &#39;df_mean_day&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_merged</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s2">&quot;day_of_year&quot;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_merged</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[31]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> cols = [i <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> i <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">list</span>(<span class="ansi-yellow-bg">df_merged</span>) <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> i != <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">day_of_year</span><span class="ansi-yellow-fg">&#34;</span>]
<span class="ansi-green-fg">      2</span> ax = df_merged[cols].plot()
<span class="ansi-green-fg">      3</span> ax.set_yscale(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">log</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df_merged&#39; is not defined
</pre></div></div>
</div>
<p>This starts to make a little more sense! We can see that this area gets most of it’s precipitation in the winter and early spring. The evapotranspiration curve shows what we’d expect: that there is more evapotranspiration in the summer than the winter.</p>
</section>
</section>
<section id="Stepping-back-for-a-minute:-exploring-Merge-and-Concat">
<h2>Stepping back for a minute: exploring Merge and Concat<a class="headerlink" href="#Stepping-back-for-a-minute:-exploring-Merge-and-Concat" title="Link to this heading">¶</a></h2>
<p>Merge and concat are very powerful and important methods for combining pandas DataFrames (and later geopandas GeoDataFrames). This section takes a moment, as an aside to explore some of the common funtions and options for performing merges and concatenation.</p>
<section id="The-merge-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">merge</span></code> method<a class="headerlink" href="#The-merge-method" title="Link to this heading">¶</a></h3>
<p>Pandas <code class="docutils literal notranslate"><span class="pre">merge</span></code> method allows the user to join two dataframes based on column values. There are a few methods that can be used to control the type of merge and the result.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inner</span></code>: operates as a intersection of the data and keeps rows from both dataframes if the row has a matching key in both dataframes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outer</span></code>: operates as a union and joins all rows from both dataframes, fills columns with nan where data is not available for a row.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">left</span></code>: keeps all rows from the ‘left’ dataframe and joins columns from the right</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">right</span></code>: keeps all rows from the ‘right’ dataframe and joins columns from the left</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ex0</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;childhood_dream_job&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
<span class="n">ex1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
<section id="The-concat-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">concat</span></code> method<a class="headerlink" href="#The-concat-method" title="Link to this heading">¶</a></h3>
<p>Pandas <code class="docutils literal notranslate"><span class="pre">concat</span></code> method allows the user to concatenate dataframes together</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gw</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">site_tp_cd</span> <span class="o">==</span> <span class="s2">&quot;GW&quot;</span><span class="p">]</span>
<span class="n">sw</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">site_tp_cd</span> <span class="o">==</span> <span class="s2">&quot;ST&quot;</span><span class="p">]</span>
<span class="n">sw</span> <span class="o">=</span> <span class="n">sw</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">sw</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]]</span>
<span class="n">sw</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[33]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> gw = <span class="ansi-yellow-bg">info</span>[info.site_tp_cd == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">GW</span><span class="ansi-yellow-fg">&#34;</span>]
<span class="ansi-green-fg">      2</span> sw = info[info.site_tp_cd == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">ST</span><span class="ansi-yellow-fg">&#34;</span>]
<span class="ansi-green-fg">      3</span> sw = sw[<span style="color: rgb(0,135,0)">list</span>(sw)[<span class="ansi-green-fg">0</span>:<span class="ansi-green-fg">8</span>]]

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">gw</span><span class="p">,</span> <span class="n">sw</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">newdf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[34]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> newdf = pd.concat((<span class="ansi-yellow-bg">gw</span>, sw), ignore_index=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">      2</span> newdf

<span class="ansi-red-fg">NameError</span>: name &#39;gw&#39; is not defined
</pre></div></div>
</div>
</section>
</section>
<section id="Back-to-working-with-our-climate-and-stream-data">
<h2>Back to working with our climate and stream data<a class="headerlink" href="#Back-to-working-with-our-climate-and-stream-data" title="Link to this heading">¶</a></h2>
<p>Is there anything else we can look at that might give us more insights into this basin?</p>
<p>Let’s try looking at long term, yearly trends to see what’s there.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dstr</span> <span class="ow">in</span> <span class="n">df_cimis</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">mo</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">yr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">mo</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yr</span><span class="p">)</span>
<span class="n">df_cimis</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
<span class="n">df_cimis</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Stn Id</th>
      <th>Stn Name</th>
      <th>CIMIS Region</th>
      <th>Date</th>
      <th>Jul</th>
      <th>ETo (in)</th>
      <th>Precip (in)</th>
      <th>Sol Rad (Ly/day)</th>
      <th>Avg Vap Pres (mBars)</th>
      <th>Max Air Temp (F)</th>
      <th>...</th>
      <th>Rose ENE</th>
      <th>Rose ESE</th>
      <th>Rose SSE</th>
      <th>Rose SSW</th>
      <th>Rose WSW</th>
      <th>Rose WNW</th>
      <th>Rose NNW</th>
      <th>Wind Run (miles)</th>
      <th>Avg Soil Temp (F)</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/1/1990</td>
      <td>1</td>
      <td>0.00</td>
      <td>0.30</td>
      <td>42.0</td>
      <td>7.7</td>
      <td>48.7</td>
      <td>...</td>
      <td>0.02</td>
      <td>0.06</td>
      <td>0.06</td>
      <td>0.04</td>
      <td>0.10</td>
      <td>0.15</td>
      <td>0.14</td>
      <td>32.1</td>
      <td>46.3</td>
      <td>1989</td>
    </tr>
    <tr>
      <th>1</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/2/1990</td>
      <td>2</td>
      <td>0.06</td>
      <td>0.00</td>
      <td>236.0</td>
      <td>6.1</td>
      <td>58.4</td>
      <td>...</td>
      <td>0.01</td>
      <td>0.04</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.06</td>
      <td>0.45</td>
      <td>1.53</td>
      <td>121.0</td>
      <td>44.9</td>
      <td>1989</td>
    </tr>
    <tr>
      <th>2</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/3/1990</td>
      <td>3</td>
      <td>0.04</td>
      <td>0.00</td>
      <td>225.0</td>
      <td>5.8</td>
      <td>63.0</td>
      <td>...</td>
      <td>0.04</td>
      <td>0.10</td>
      <td>0.04</td>
      <td>0.06</td>
      <td>0.05</td>
      <td>0.21</td>
      <td>0.23</td>
      <td>44.5</td>
      <td>43.3</td>
      <td>1989</td>
    </tr>
    <tr>
      <th>3</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/4/1990</td>
      <td>4</td>
      <td>0.03</td>
      <td>0.01</td>
      <td>190.0</td>
      <td>6.3</td>
      <td>56.7</td>
      <td>...</td>
      <td>0.07</td>
      <td>0.11</td>
      <td>0.07</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.08</td>
      <td>0.09</td>
      <td>30.2</td>
      <td>42.8</td>
      <td>1989</td>
    </tr>
    <tr>
      <th>4</th>
      <td>83</td>
      <td>Santa Rosa</td>
      <td>North Coast Valleys</td>
      <td>1/5/1990</td>
      <td>5</td>
      <td>0.04</td>
      <td>0.00</td>
      <td>192.0</td>
      <td>7.2</td>
      <td>59.1</td>
      <td>...</td>
      <td>0.13</td>
      <td>0.33</td>
      <td>0.08</td>
      <td>0.04</td>
      <td>0.08</td>
      <td>0.07</td>
      <td>0.05</td>
      <td>45.2</td>
      <td>43.7</td>
      <td>1989</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 28 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[36]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">df2</span>.head()

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<section id=".aggregate()">
<h3><code class="docutils literal notranslate"><span class="pre">.aggregate()</span></code><a class="headerlink" href="#.aggregate()" title="Link to this heading">¶</a></h3>
<p>The pandas <code class="docutils literal notranslate"><span class="pre">.aggregate()</span></code> can be used with <code class="docutils literal notranslate"><span class="pre">.groupy()</span></code> to perform multiple statistical operations.</p>
<p>Example usage could be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">agdf</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;day_of_year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;austin_c_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
</pre></div>
</div>
<p>And would return a dataframe grouped by the day of year and take the min, max, mean, and standard deviation of these data.</p>
</section>
</section>
<section id="Class-exercise-3:-groupy,-aggregate,-and-merge">
<h2>Class exercise 3: groupy, aggregate, and merge<a class="headerlink" href="#Class-exercise-3:-groupy,-aggregate,-and-merge" title="Link to this heading">¶</a></h2>
<p>For this exercise we need to produce yearly mean and standard deviation flows for the <code class="docutils literal notranslate"><span class="pre">russian_r_af</span></code> variable and merge the data with yearly mean precipitation and evapotranspiration</p>
<p><strong>Hints:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df2</span></code> and <code class="docutils literal notranslate"><span class="pre">df_cimis</span></code> are the dataframes these operations should be performed on</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code> to group by the year and do <code class="docutils literal notranslate"><span class="pre">precip</span></code> and <code class="docutils literal notranslate"><span class="pre">ETo</span></code> in separate groupby routines</p></li>
<li><p>rename the columns in the ETo aggregated dataframe and the Precip dataframe to <code class="docutils literal notranslate"><span class="pre">mean_et</span></code>, <code class="docutils literal notranslate"><span class="pre">std_et</span></code>, <code class="docutils literal notranslate"><span class="pre">mean_precip</span></code>, <code class="docutils literal notranslate"><span class="pre">std_precip</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">np.mean</span></code> and <code class="docutils literal notranslate"><span class="pre">np.std</span></code> can be used to calculate mean and std flows</p></li>
</ul>
<p>Name your final joined dataframe <code class="docutils literal notranslate"><span class="pre">df_yearly</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfg0</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>
<span class="n">dfg1</span> <span class="o">=</span> <span class="n">df_cimis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;ETo (in)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>
<span class="n">dfg2</span> <span class="o">=</span> <span class="n">df_cimis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;Precip (in)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>

<span class="n">dfm1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfg0</span><span class="p">,</span> <span class="n">dfg1</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_et&quot;</span><span class="p">))</span>
<span class="n">df_yearly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfm1</span><span class="p">,</span> <span class="n">dfg2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_precip&quot;</span><span class="p">))</span>

<span class="n">df_yearly</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[37]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> dfg0 = <span class="ansi-yellow-bg">df2</span>.groupby(by=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>], as_index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>].aggregate([<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">std</span><span class="ansi-yellow-fg">&#39;</span>])
<span class="ansi-green-fg">      2</span> dfg1 = df_cimis.groupby(by=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>], as_index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">ETo (in)</span><span class="ansi-yellow-fg">&#34;</span>].aggregate([<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">std</span><span class="ansi-yellow-fg">&#39;</span>])
<span class="ansi-green-fg">      3</span> dfg2 = df_cimis.groupby(by=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>], as_index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Precip (in)</span><span class="ansi-yellow-fg">&#34;</span>].aggregate([<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">std</span><span class="ansi-yellow-fg">&#39;</span>])

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<p>Lets examine the long term flow record for the Russian River</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_y_flow</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">lower_ci</span> <span class="o">=</span> <span class="n">df_y_flow</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">df_y_flow</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="n">lower_ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lower_ci</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lower_ci</span><span class="p">)</span>
<span class="n">upper_ci</span> <span class="o">=</span> <span class="n">df_y_flow</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">df_y_flow</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_y_flow</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;b.-&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_y_flow</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">lower_ci</span><span class="p">,</span> <span class="n">upper_ci</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[38]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df_y_flow = <span class="ansi-yellow-bg">df2</span>.groupby(by=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>], as_index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>].aggregate([<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">std</span><span class="ansi-yellow-fg">&#39;</span>])
<span class="ansi-green-fg">      3</span> fig = plt.figure(figsize=(<span class="ansi-green-fg">12</span>,<span class="ansi-green-fg">4</span>))
<span class="ansi-green-fg">      5</span> lower_ci = df_y_flow[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#34;</span>] - <span class="ansi-green-fg">2</span> * df_y_flow[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">std</span><span class="ansi-yellow-fg">&#39;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<p>From this plot it looks like the long term trend in yearly discharge in the Russian River has been decreasing. We will revisit and test this later.</p>
<p>First let’s see if there are any relationships between yearly discharge and climate</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfg0</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">])</span>
<span class="n">dfg1</span> <span class="o">=</span> <span class="n">df_cimis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;ETo (in)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">])</span>
<span class="n">dfg2</span> <span class="o">=</span> <span class="n">df_cimis</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;Precip (in)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">])</span>
<span class="n">dfm1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfg0</span><span class="p">,</span> <span class="n">dfg1</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_et&quot;</span><span class="p">))</span>
<span class="n">df_yearly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfm1</span><span class="p">,</span> <span class="n">dfg2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_precip&quot;</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">lower_ci</span> <span class="o">=</span> <span class="n">df_yearly</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">df_yearly</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="n">lower_ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lower_ci</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lower_ci</span><span class="p">)</span>
<span class="n">upper_ci</span> <span class="o">=</span> <span class="n">df_yearly</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">df_yearly</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df_yearly</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;b.-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;flow_af&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_yearly</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">lower_ci</span><span class="p">,</span> <span class="n">upper_ci</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_yearly</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_yearly</span><span class="o">.</span><span class="n">sum_precip</span><span class="p">,</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Precip&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_yearly</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_yearly</span><span class="o">.</span><span class="n">sum_et</span><span class="p">,</span> <span class="s2">&quot;r.--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ET&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[39]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> dfg0 = <span class="ansi-yellow-bg">df2</span>.groupby(by=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>], as_index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>].aggregate([<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">std</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">sum</span><span class="ansi-yellow-fg">&#39;</span>])
<span class="ansi-green-fg">      2</span> dfg1 = df_cimis.groupby(by=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>], as_index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">ETo (in)</span><span class="ansi-yellow-fg">&#34;</span>].aggregate([<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">std</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">sum</span><span class="ansi-yellow-fg">&#39;</span>])
<span class="ansi-green-fg">      3</span> dfg2 = df_cimis.groupby(by=[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>], as_index=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Precip (in)</span><span class="ansi-yellow-fg">&#34;</span>].aggregate([<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">mean</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">std</span><span class="ansi-yellow-fg">&#39;</span>, <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">sum</span><span class="ansi-yellow-fg">&#39;</span>])

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<p>As expected, precipitation amount is the main driver of the yearly discharge regime here</p>
<section id="Baseflow-separation">
<h3>Baseflow separation<a class="headerlink" href="#Baseflow-separation" title="Link to this heading">¶</a></h3>
<p>Baseflow separation is a method to separate the quick response hydrograph (storm runoff) from the long term flow. We’re going to go back to the complete daily dataset to perform this operation. The following cell contains a low pass filtration method that is used for digital baseflow separation. We’ll use these in our analysis</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_baseflow_low_pass_filter</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">enforce</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Private method to apply digital baseflow separation filter</span>
<span class="sd">    (Lyne &amp; Hollick, 1979; Nathan &amp; Mcmahon, 1990;</span>
<span class="sd">    Boughton, 1993; Chapman &amp; Maxwell, 1996).</span>

<span class="sd">    This method should not be called by the user!</span>

<span class="sd">    Method removes &quot;spikes&quot; which would be consistent with storm flow</span>
<span class="sd">    events from data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : np.array</span>
<span class="sd">        streamflow or municipal pumping time series</span>

<span class="sd">    beta : float</span>
<span class="sd">        baseflow filtering parameter that ranges from 0 - 1</span>
<span class="sd">        values in 0.8 - 0.95 range used in literature for</span>
<span class="sd">        streamflow baseflow separation</span>

<span class="sd">    enforce : bool</span>
<span class="sd">        enforce physical constraint of baseflow less than measured flow</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        np.array of filtered data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># prepend 10 records to data for initial spin up</span>
    <span class="c1"># these records will be dropped before returning data to user</span>
    <span class="n">qt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">qt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">qt</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:]</span>

    <span class="n">qdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">qbf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>

    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">qdt</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ix</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">qbf</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">qt</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
            <span class="k">continue</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">qdt</span><span class="p">[</span><span class="n">ix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">qt</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">qt</span><span class="p">[</span><span class="n">ix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">qdt</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>

        <span class="n">qb</span> <span class="o">=</span> <span class="n">qt</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">qdt</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">enforce</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">qb</span> <span class="o">&gt;</span> <span class="n">qt</span><span class="p">[</span><span class="n">ix</span><span class="p">]:</span>
                <span class="n">qbf</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">qt</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qbf</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">qb</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">qbf</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">qb</span>

    <span class="k">return</span> <span class="n">qbf</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">baseflow_low_pass_filter</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">enforce</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    User method to apply digital baseflow separation filter</span>
<span class="sd">    (Lyne &amp; Hollick, 1979; Nathan &amp; Mcmahon, 1990;</span>
<span class="sd">    Boughton, 1993; Chapman &amp; Maxwell, 1996).</span>

<span class="sd">    Method removes &quot;spikes&quot; which would be consistent with storm flow</span>
<span class="sd">    events from data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : np.array</span>
<span class="sd">        streamflow or municipal pumping time series</span>

<span class="sd">    beta : float</span>
<span class="sd">        baseflow filtering parameter that ranges from 0 - 1</span>
<span class="sd">        values in 0.8 - 0.95 range used in literature for</span>
<span class="sd">        streamflow baseflow separation</span>

<span class="sd">    T : int</span>
<span class="sd">        number of recursive filtering passes to apply to the data</span>

<span class="sd">    enforce : bool</span>
<span class="sd">        enforce physical constraint of baseflow less than measured flow</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        np.array of baseflow</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">_baseflow_low_pass_filter</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">enforce</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arr</span>
<br/></pre></div>
</div>
</div>
</section>
</section>
<section id="Class-exercise-4:-baseflow-separation">
<h2>Class exercise 4: baseflow separation<a class="headerlink" href="#Class-exercise-4:-baseflow-separation" title="Link to this heading">¶</a></h2>
<p>Using the full dataframe discharge dataframe, <code class="docutils literal notranslate"><span class="pre">df2</span></code>, get the baseflows for the Russian River (in acre-ft) and add these to the dataframe as a new column named <code class="docutils literal notranslate"><span class="pre">russian_bf_af</span></code>.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">baseflow_low_pass_filter()</span></code> will be used to perform baseflow. This function takes a numpy array of stream discharge and runs a digital low pass filtration method to calculate baseflow.</p>
<p>After performing baseflow separation plot both the baseflow and the total discharge for the years 2015 - 2017.</p>
<p><strong>Hints:</strong></p>
<ul class="simple">
<li><p>make sure to use the <code class="docutils literal notranslate"><span class="pre">.values</span></code> property when you get discharge data from the pandas dataframe</p></li>
<li><p>feel free to play with the input parameters <code class="docutils literal notranslate"><span class="pre">beta</span></code> and <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">beta</span></code> is commonly between 0.8 - 0.95 for hydrologic problems.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code> is the number of filter passes over the data, therefore increasing <code class="docutils literal notranslate"><span class="pre">T</span></code> will create a smoother profile. I recommend starting with a <code class="docutils literal notranslate"><span class="pre">T</span></code> value of around 5 and adjusting it to see how it changes the baseflow profile.</p></li>
</ul>
</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseflow</span> <span class="o">=</span> <span class="n">baseflow_low_pass_filter</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">df2</span><span class="p">[</span><span class="s2">&quot;russian_bf_af&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseflow</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">tdf</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[(</span><span class="n">df2</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2015</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2017</span><span class="p">)]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">tdf</span><span class="p">[[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">,</span> <span class="s2">&quot;russian_bf_af&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[41]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> baseflow = baseflow_low_pass_filter(<span class="ansi-yellow-bg">df2</span>[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>].values, beta=<span class="ansi-green-fg">0.90</span>, T=<span class="ansi-green-fg">5</span>)
<span class="ansi-green-fg">      2</span> df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_bf_af</span><span class="ansi-yellow-fg">&#34;</span>] = baseflow
<span class="ansi-green-fg">      4</span> fig = plt.figure(figsize=(<span class="ansi-green-fg">15</span>, <span class="ansi-green-fg">10</span>))

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Looking-at-trends-and-seasonal-cycles-in-the-data-with-statsmodels">
<h2>Looking at trends and seasonal cycles in the data with <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code><a class="headerlink" href="#Looking-at-trends-and-seasonal-cycles-in-the-data-with-statsmodels" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> is a Python module that provides classes and functions for the estimation of many different statistical models, as well as for conducting statistical tests, and statistical data exploration. For more information on <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> and it’s many features visit <a class="reference external" href="https://www.statsmodels.org/dev/gettingstarted.html">the getting started guide</a></p>
<p>For this example we’ll be using time series analysis to perform a seasonal decomposition using moving averages. The <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> function <code class="docutils literal notranslate"><span class="pre">seasonal_decompose</span></code> will perform this analysis and return the data trend, seasonal fluctuations, and residuals.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;russian_bf_af&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseflow_low_pass_filter</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># drop nan values prior to running decomposition</span>
<span class="n">dfsm</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;russian_bf_af&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>

<span class="n">dfsm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1"># decompose</span>
<span class="n">decomposition</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">dfsm</span><span class="p">[</span><span class="s2">&quot;russian_bf_af&quot;</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;additive&quot;</span><span class="p">)</span>

<span class="n">decomposition</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[42]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_bf_af</span><span class="ansi-yellow-fg">&#34;</span>] = baseflow_low_pass_filter(<span class="ansi-yellow-bg">df2</span>[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>].values, beta=<span class="ansi-green-fg">0.9</span>, T=<span class="ansi-green-fg">5</span>)
<span class="ansi-green-fg">      2</span> <span style="color: rgb(95,135,135)"># drop nan values prior to running decomposition</span>
<span class="ansi-green-fg">      3</span> dfsm = df2[df2[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">russian_bf_af</span><span class="ansi-yellow-fg">&#39;</span>].notna()]

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<p>Now let’s plot our baseflow trend against the baseflow we calculated</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">decomposition</span><span class="o">.</span><span class="n">trend</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">decomposition</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;russian_river.png&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[43]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">8</span>, <span class="ansi-green-fg">8</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> ax = <span class="ansi-yellow-bg">df2</span>[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>].plot(ax=ax)
<span class="ansi-green-fg">      4</span> ax.plot(decomposition.trend.index, decomposition.trend, <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">r-</span><span class="ansi-yellow-fg">&#34;</span>, lw=<span class="ansi-green-fg">1.5</span>)
<span class="ansi-green-fg">      5</span> ax.set_yscale(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">log</span><span class="ansi-yellow-fg">&#39;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_part0_python_intro_solutions_08_pandas_85_1.png" src="../../../_images/notebooks_part0_python_intro_solutions_08_pandas_85_1.png" />
</div>
</div>
<p>What’s going on at the end of the 1970’s? Why is the baseflow trend so low and peak flows are also low?</p>
<p>From <a class="reference external" href="https://cawaterlibrary.net/wp-content/uploads/2017/05/CalSignficantDroughts_v10_int.pdf">“California’s Most Significant Droughts”</a>, Chapter 3</p>
<p>The setting for the 1976-77 drought differed significantly from the dry times of the 1920s-30s. Although only a two-year event, its hydrology was severe. Based on 114 years of computed statewide runoff, 1977 occupies rank 114 (driest year) and 1976 is in rank 104. The drought was notable for the impacts experienced by water agencies that were unprepared for such conditions. One reason for the lack of preparedness was the perception of relatively ample water supplies in most areas of the state.</p>
<p>We can also see the analysis that there is an overall reduction in baseflow from 1940’s to the 2020’s</p>
<section id="Writing-yearly-plots-of-data-to-a-PDF-document">
<h3>Writing yearly plots of data to a PDF document<a class="headerlink" href="#Writing-yearly-plots-of-data-to-a-PDF-document" title="Link to this heading">¶</a></h3>
<p>We can write the plots we make with pandas to a multipage pdf using matplotlib’s <code class="docutils literal notranslate"><span class="pre">PdfPages</span></code>. For this example we’ll make yearly plots of all of the discharge, baseflow, and baseflow trend and bundle them into a single pdf document.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add the decomposition trend to the dataframe to make plotting easy</span>
<span class="n">df2</span><span class="p">[</span><span class="s2">&quot;baseflow_trend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">decomposition</span><span class="o">.</span><span class="n">trend</span>

<span class="n">pdf_file</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;all_years_russian.pdf&quot;</span>
<span class="k">with</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">outpdf</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">tdf</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="n">df2</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="n">tdf</span><span class="p">[[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">,</span> <span class="s2">&quot;russian_bf_af&quot;</span><span class="p">,</span> <span class="s2">&quot;baseflow_trend&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;acre-feet&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300000</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">outpdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[44]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># add the decomposition trend to the dataframe to make plotting easy</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> df2[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">baseflow_trend</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-yellow-bg">decomposition</span>.trend
<span class="ansi-green-fg">      4</span> pdf_file = data_path / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">all_years_russian.pdf</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">      5</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> PdfPages(pdf_file) <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> outpdf:

<span class="ansi-red-fg">NameError</span>: name &#39;decomposition&#39; is not defined
</pre></div></div>
</div>
<p>Go into the “data/pandas” and open up the file “all_years_russian.pdf” to check out the plots.</p>
</section>
</section>
<section id="Back-to-the-basics:">
<h2>Back to the basics:<a class="headerlink" href="#Back-to-the-basics:" title="Link to this heading">¶</a></h2>
<p>Now that we’ve done some analysis on real data, let’s go back to the basic and briefly discuss how to adjust data values in pandas</p>
<section id="Adjusting-a-whole-column-of-data-values">
<h3>Adjusting a whole column of data values<a class="headerlink" href="#Adjusting-a-whole-column-of-data-values" title="Link to this heading">¶</a></h3>
<p>Because pandas series objects (columns) are built off of numpy, we can perform mathematical operations in place on a whole column similarly to numpy arrays</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># Adding values</span>
<span class="n">df3</span><span class="p">[</span><span class="s2">&quot;russian_r&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10000</span>

<span class="c1"># Subtracting values</span>
<span class="n">df3</span><span class="p">[</span><span class="s2">&quot;russian_r&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">10000</span>

<span class="c1"># multiplication</span>
<span class="n">df3</span><span class="p">[</span><span class="s2">&quot;russian_r&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">5</span>

<span class="c1"># division</span>
<span class="n">df3</span><span class="p">[</span><span class="s2">&quot;russian_r&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="mi">5</span>

<span class="c1"># more complex operations</span>
<span class="n">df3</span><span class="p">[</span><span class="s2">&quot;russian_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;russian_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df3</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[45]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df3 = <span class="ansi-yellow-bg">df2</span>.copy()
<span class="ansi-green-fg">      2</span> <span style="color: rgb(95,135,135)"># Adding values</span>
<span class="ansi-green-fg">      3</span> df3[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r</span><span class="ansi-yellow-fg">&#34;</span>] += <span class="ansi-green-fg">10000</span>

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="updating-values-by-position">
<h3>updating values by position<a class="headerlink" href="#updating-values-by-position" title="Link to this heading">¶</a></h3>
<p>We can update single or multiple values by their position in the dataframe using <code class="docutils literal notranslate"><span class="pre">.iloc</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999</span>
<span class="n">df3</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[46]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">df3</span>.iloc[<span class="ansi-green-fg">0</span>, <span class="ansi-green-fg">1</span>] = <span class="ansi-green-fg">999</span>
<span class="ansi-green-fg">      2</span> df3.head()

<span class="ansi-red-fg">NameError</span>: name &#39;df3&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="updating-values-based-on-location">
<h3>updating values based on location<a class="headerlink" href="#updating-values-based-on-location" title="Link to this heading">¶</a></h3>
<p>We can update values in the dataframe based on their index and column headers too using <code class="docutils literal notranslate"><span class="pre">.loc</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df3</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;russian_r&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">100</span>
<span class="n">df3</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[47]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">df3</span>.loc[df3.index[<span class="ansi-green-fg">0</span>], <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">russian_r</span><span class="ansi-yellow-fg">&#39;</span>] *= <span class="ansi-green-fg">100</span>
<span class="ansi-green-fg">      2</span> df3.head()

<span class="ansi-red-fg">NameError</span>: name &#39;df3&#39; is not defined
</pre></div></div>
</div>
</section>
</section>
<section id="Class-exercise-5:-setting-data">
<h2>Class exercise 5: setting data<a class="headerlink" href="#Class-exercise-5:-setting-data" title="Link to this heading">¶</a></h2>
<p>The russian river discharge in cubic feet per day highly variable and represented by large numbers. To make this data easier to read and plot, update it to a log10 representation.</p>
<p>Then use either a location based method to change the value in austin_c on 10-4-1939 to 0.</p>
<p>Finally display the first 5 records in the notebook.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;russian_r_cfd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df3</span><span class="p">[</span><span class="s2">&quot;russian_r_cfd&quot;</span><span class="p">])</span>
<span class="n">df3</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df3</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;austin_c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">df3</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[48]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df3[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_cfd</span><span class="ansi-yellow-fg">&#34;</span>] = np.log10(<span class="ansi-yellow-bg">df3</span>[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_cfd</span><span class="ansi-yellow-fg">&#34;</span>])
<span class="ansi-green-fg">      2</span> df3.loc[df3.index[<span class="ansi-green-fg">3</span>], <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">austin_c</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-green-fg">0</span>
<span class="ansi-green-fg">      3</span> df3.head()

<span class="ansi-red-fg">NameError</span>: name &#39;df3&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Now-for-some-powerful-analysis-using-fourier-analysis-to-extract-the-data's-signal.">
<h2>Now for some powerful analysis using fourier analysis to extract the data’s signal.<a class="headerlink" href="#Now-for-some-powerful-analysis-using-fourier-analysis-to-extract-the-data's-signal." title="Link to this heading">¶</a></h2>
<p>Some background for your evening viewing: <a class="reference external" href="https://youtu.be/spUNpyF58BY">https://youtu.be/spUNpyF58BY</a></p>
<p>We have to detrend the data for fast fourier transforms to work properly. Here’s a discussion on why:</p>
<p><a class="reference external" href="https://groups.google.com/forum/#!topic/comp.dsp/kYDZqetr_TU">https://groups.google.com/forum/#!topic/comp.dsp/kYDZqetr_TU</a></p>
<p>Fortunately we can easily do this in python using scipy!</p>
<p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.detrend.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.detrend.html</a></p>
<p>Let’s create a new dataframe with only the data we’re interested in analysing.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_data</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[[</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">]]</span>
<span class="n">df_data</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;russian_r_af&quot;</span><span class="p">:</span> <span class="s2">&quot;Q&quot;</span><span class="p">})</span>
<span class="n">df_data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[49]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df_data = <span class="ansi-yellow-bg">df2</span>[[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>, <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">year</span><span class="ansi-yellow-fg">&#34;</span>]]
<span class="ansi-green-fg">      2</span> df_data = df_data.rename(columns={<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">russian_r_af</span><span class="ansi-yellow-fg">&#34;</span>: <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Q</span><span class="ansi-yellow-fg">&#34;</span>})
<span class="ansi-green-fg">      3</span> df_data.describe()

<span class="ansi-red-fg">NameError</span>: name &#39;df2&#39; is not defined
</pre></div></div>
</div>
<p>But first let’s also set the water year by date on this dataframe and drop the single nan value from the dataframe</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_data</span><span class="p">[</span><span class="s1">&#39;water_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">30</span><span class="o">+</span><span class="mi">31</span><span class="o">+</span><span class="mi">31</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">df_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;detrended&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detrend</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[50]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> df_data[<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">water_year</span><span class="ansi-yellow-fg">&#39;</span>] = <span class="ansi-yellow-bg">df_data</span>.index.shift(<span class="ansi-green-fg">30</span>+<span class="ansi-green-fg">31</span>+<span class="ansi-green-fg">31</span>,freq=<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">d</span><span class="ansi-yellow-fg">&#39;</span>).year
<span class="ansi-green-fg">      2</span> df_data.dropna(inplace=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">      3</span> df_data[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">detrended</span><span class="ansi-yellow-fg">&#34;</span>] = detrend(df_data.Q.values)

<span class="ansi-red-fg">NameError</span>: name &#39;df_data&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">detrended</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;detrended signal&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_data</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Raw Signal&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_data</span><span class="o">.</span><span class="n">Q</span> <span class="o">-</span> <span class="n">df_data</span><span class="o">.</span><span class="n">detrended</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Difference&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[51]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> fig = plt.figure(figsize=(<span class="ansi-green-fg">12</span>,<span class="ansi-green-fg">6</span>))
<span class="ansi-green-fg">      2</span> ax = plt.subplot(<span class="ansi-green-fg">3</span>,<span class="ansi-green-fg">1</span>,<span class="ansi-green-fg">1</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> plt.plot(<span class="ansi-yellow-bg">df_data</span>.detrended)
<span class="ansi-green-fg">      4</span> plt.title(<span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">detrended signal</span><span class="ansi-yellow-fg">&#39;</span>)
<span class="ansi-green-fg">      6</span> plt.subplot(<span class="ansi-green-fg">3</span>,<span class="ansi-green-fg">1</span>,<span class="ansi-green-fg">2</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df_data&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_part0_python_intro_solutions_08_pandas_104_1.png" src="../../../_images/notebooks_part0_python_intro_solutions_08_pandas_104_1.png" />
</div>
</div>
<section id="Evaluate-and-plot-the-Period-Spectrum-to-see-timing-of-recurrence">
<h3>Evaluate and plot the Period Spectrum to see timing of recurrence<a class="headerlink" href="#Evaluate-and-plot-the-Period-Spectrum-to-see-timing-of-recurrence" title="Link to this heading">¶</a></h3>
<p>Here we’ve created a function that performs fast fourier transforms and then plot’s the spectrum for signals of various lengths.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fft_and_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">plot_dominant_periods</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">yf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">detrended</span><span class="p">)</span>
    <span class="n">yf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yf</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)])</span>

    <span class="c1"># get the right frequency</span>
    <span class="c1"># https://docs.scipy.org/doc/numpy/reference/generated/numpy.fft.fftfreq.html#numpy.fft.fftfreq</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mf">1.</span> <span class="c1"># day</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">d</span><span class="p">)[:</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
    <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.00001</span>
    <span class="n">per</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">f</span> <span class="c1"># days</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">per</span><span class="p">,</span> <span class="n">yf</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">top</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">yf</span><span class="p">)[</span><span class="o">-</span><span class="n">plot_dominant_periods</span><span class="p">:]</span>
    <span class="n">j</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="n">plot_dominant_periods</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">top</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">per</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">per</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yf</span><span class="p">)],</span> <span class="s1">&#39;r:&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">per</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yf</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">per</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">j</span><span class="o">+=</span><span class="mf">0.1</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Period Spectrum&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (days)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Raw Signal&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Now-let's-look-at-the-whole-signal">
<h3>Now let’s look at the whole signal<a class="headerlink" href="#Now-let's-look-at-the-whole-signal" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fft_and_plot</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[53]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> fft_and_plot(<span class="ansi-yellow-bg">df_data</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df_data&#39; is not defined
</pre></div></div>
</div>
<p>We see a strong annual frequency that corresponds to spring snowmelt from the surrounding mountain ranges. The second strongest frequency is biannually, and is likely due to the onset of fall in winter rains</p>
</section>
<section id="Okay,-what-about-years-before-dams-were-installed-on-the-Russian-River.">
<h3>Okay, what about years before dams were installed on the Russian River.<a class="headerlink" href="#Okay,-what-about-years-before-dams-were-installed-on-the-Russian-River." title="Link to this heading">¶</a></h3>
<p>Let’s get in the wayback machine and look at only the years prior to 1954!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fft_and_plot</span><span class="p">(</span><span class="n">df_data</span><span class="p">[</span><span class="n">df_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1954</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[54]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> fft_and_plot(<span class="ansi-yellow-bg">df_data</span>[df_data.index.year &lt; <span class="ansi-green-fg">1954</span>])

<span class="ansi-red-fg">NameError</span>: name &#39;df_data&#39; is not defined
</pre></div></div>
</div>
<p>The binanual and annual signals have a much wider spread, which suggests that peak runoff was a little more variable in it’s timing compared to the entire data record.</p>
</section>
<section id="What-if-we-focus-in-on-after-1954?">
<h3>What if we focus in on after 1954?<a class="headerlink" href="#What-if-we-focus-in-on-after-1954?" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fft_and_plot</span><span class="p">(</span><span class="n">df_data</span><span class="p">[(</span><span class="n">df_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;</span> <span class="mi">1954</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[55]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> fft_and_plot(<span class="ansi-yellow-bg">df_data</span>[(df_data.index.year &gt; <span class="ansi-green-fg">1954</span>)])

<span class="ansi-red-fg">NameError</span>: name &#39;df_data&#39; is not defined
</pre></div></div>
</div>
<p>It looks like flows are more controlled with a tighter periods.</p>
<p>So post dam construction, flows are much more controlled with regular release schedules.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../07b_VSCode.html" class="btn btn-neutral float-left" title="07b: VSCode Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../09_a_Geopandas.html" class="btn btn-neutral float-right" title="09: GeoPandas - DataFrames with geometry for GIS applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2025, USGS Python for Hydrology instructors.
      <span class="lastupdated">Last updated on Sep 19, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>