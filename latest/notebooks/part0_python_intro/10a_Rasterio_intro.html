

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10a: Introduction to Rasterio for working with raster data &mdash; Python for Hydrology 1.0a documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=feab032e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10b: Using Rasterio and Numpy to examine ice loss on Mt. Rainier" href="10b_Rasterio_advanced.html" />
    <link rel="prev" title="09: Geopandas exercise solutions" href="solutions/09_Geopandas__solutions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Python for Hydrology
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Main Curriculum</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../part0.html">     Part 0: Introduction to Python</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="00_python_basics_review.html">00: Introduction to python for hydrologists</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/01_functions_script__solution.html">01: Functions and scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/02_Namespace_objects_modules_packages__solution.html">02: Namespace, modules, packages, and objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_useful-std-library-modules.html">03: Useful standard library modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/03_useful-std-library-modules-solutions.html">03: Solutions to Useful standard library modules exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/04_files_and_strings.html">04: File input and output</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_numpy.html">05: NumPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/05_numpy__solutions.html">05: NumPy exercise solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/06_matplotlib__solution.html">06: <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> — 2D and 3D plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="06b_matplotlib_animation.html">06a: Using Matplotlib to Create Animation</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/07a_Theis-exercise-solution.html">07: Using functions to solve an equation– The Theis example</a></li>
<li class="toctree-l2"><a class="reference internal" href="07b_VSCode.html">07b: VSCode Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/08_pandas.html">08: Working with tabular data in Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="09_a_Geopandas.html">09: GeoPandas - DataFrames with geometry for GIS applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/09_Geopandas__solutions.html">09: Geopandas exercise solutions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10a: Introduction to Rasterio for working with raster data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Opening-and-closing-raster-datasets-using-rasterio">Opening and closing raster datasets using <code class="docutils literal notranslate"><span class="pre">rasterio</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plotting">Plotting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Close-the-dataset-when-we're-done">Close the dataset when we’re done</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Accessing-and-manipulating-raster-data">Accessing and manipulating raster data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Convert-to-units-of-feet">Convert to units of feet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Make-the-data-categorical">Make the data categorical</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Writing-Raster-files">Writing Raster files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#A-word-on-transforms">A word on transforms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#The-affine-matrix">The affine matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#There-are-six-elements-in-the-affine-transform-(a,-b,-c,-d,-e,-f)">There are six elements in the affine transform (a, b, c, d, e, f)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#...-now-back-to-writing-that-raster">… now back to writing that raster</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Building-a-raster-from-scratch">Building a raster from scratch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Class-activity">Class activity</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Masking-(aka-clipping)-rasters-using-polygons">Masking (aka clipping) rasters using polygons</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="10b_Rasterio_advanced.html">10b: Using Rasterio and Numpy to examine ice loss on Mt. Rainier</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_xarray_mt_rainier_precip.html">11: Using Xarray to look at Daymet precipitation around Mt. Rainier</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../part1.html">Part 1: Flopy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bonus Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bonus_examples.html">     General Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SOME_HELPFUL_LINKS.html"> Additional links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html"> Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary_of_jargon.html"> Glossary of jargon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packaging.html"> Making a Python package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../best_practices.html"> Scientific programming best practices</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python for Hydrology</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../part0.html">Part 0: General Python Exercises</a></li>
      <li class="breadcrumb-item active">10a: Introduction to Rasterio for working with raster data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/part0_python_intro/10a_Rasterio_intro.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="10a:-Introduction-to-Rasterio-for-working-with-raster-data">
<h1>10a: Introduction to Rasterio for working with raster data<a class="headerlink" href="#10a:-Introduction-to-Rasterio-for-working-with-raster-data" title="Link to this heading"></a></h1>
<p>This exercise introduces <a class="reference external" href="https://rasterio.readthedocs.io/en/stable/">ratsterio</a> for working with <a class="reference external" href="https://docs.qgis.org/3.4/en/docs/gentle_gis_introduction/raster_data.html">GIS raster datasets</a>.</p>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> library, along with <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> to open, explore, and create raster datasets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">show</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/rasterio&quot;</span><span class="p">)</span>  <span class="c1"># set path to raster data folder</span>
</pre></div>
</div>
</div>
<section id="Opening-and-closing-raster-datasets-using-rasterio">
<h2>Opening and closing raster datasets using <code class="docutils literal notranslate"><span class="pre">rasterio</span></code><a class="headerlink" href="#Opening-and-closing-raster-datasets-using-rasterio" title="Link to this heading"></a></h2>
<p>We can open a GeoTIFF file containing a digital elevation model of Mt. Rainier (20150818_rainier_summer-tile-30.tif) using <code class="docutils literal notranslate"><span class="pre">rasterio.open</span></code>, in a way that’s similar to using Python’s built-in <code class="docutils literal notranslate"><span class="pre">open</span></code> function for text files.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raster_file</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;20150818_rainier_summer-tile-30.tif&#39;</span>  <span class="c1"># example raster data</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This returns a rasterio <code class="docutils literal notranslate"><span class="pre">DatasetReader</span></code> object (in this case called “dataset”). This object provides methods and attributes for accessing raster properties. Let’s explore some of these properties.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">name</span>  <span class="c1">#  file name</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;data/rasterio/20150818_rainier_summer-tile-30.tif&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">driver</span>  <span class="c1"># The file format (`GTiff` is recommended)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;GTiff&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">mode</span>  <span class="c1"># Opening mode - &#39;r&#39; for read mode by default</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;r&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">count</span>  <span class="c1"># number of datasets or &quot;bands&quot; contained in the raster dataset</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">dtypes</span>  <span class="c1"># The raster data type, one of `numpy` types supported by the driver</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;float32&#39;,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">width</span>  <span class="c1"># number of columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
827
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">height</span>  <span class="c1"># number of rows</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
761
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">nodata</span>  <span class="c1"># The value which represents “No Data”, if any</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">crs</span>  <span class="c1"># The coordinate reference system EPSG code</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CRS.from_wkt(&#39;PROJCS[&#34;WGS 84 / UTM zone 10N&#34;,GEOGCS[&#34;WGS 84&#34;,DATUM[&#34;WGS_1984&#34;,SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563,AUTHORITY[&#34;EPSG&#34;,&#34;7030&#34;]],AUTHORITY[&#34;EPSG&#34;,&#34;6326&#34;]],PRIMEM[&#34;Greenwich&#34;,0,AUTHORITY[&#34;EPSG&#34;,&#34;8901&#34;]],UNIT[&#34;degree&#34;,0.0174532925199433,AUTHORITY[&#34;EPSG&#34;,&#34;9122&#34;]],AUTHORITY[&#34;EPSG&#34;,&#34;4326&#34;]],PROJECTION[&#34;Transverse_Mercator&#34;],PARAMETER[&#34;latitude_of_origin&#34;,0],PARAMETER[&#34;central_meridian&#34;,-123],PARAMETER[&#34;scale_factor&#34;,0.9996],PARAMETER[&#34;false_easting&#34;,500000],PARAMETER[&#34;false_northing&#34;,0],UNIT[&#34;metre&#34;,1,AUTHORITY[&#34;EPSG&#34;,&#34;9001&#34;]],AXIS[&#34;Easting&#34;,EAST],AXIS[&#34;Northing&#34;,NORTH],AUTHORITY[&#34;EPSG&#34;,&#34;32610&#34;]]&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">transform</span>  <span class="c1"># the transform matrix</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Affine(30.0, 0.0, 583464.253406,
       0.0, -30.0, 5202549.0989)
</pre></div></div>
</div>
<p>More on the <code class="docutils literal notranslate"><span class="pre">transform</span></code> later…</p>
<p>Most of this information is contained within the dataset’s metadata dictionary and can be accessed at once.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">meta</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;driver&#39;: &#39;GTiff&#39;,
 &#39;dtype&#39;: &#39;float32&#39;,
 &#39;nodata&#39;: 0.0,
 &#39;width&#39;: 827,
 &#39;height&#39;: 761,
 &#39;count&#39;: 1,
 &#39;crs&#39;: CRS.from_wkt(&#39;PROJCS[&#34;WGS 84 / UTM zone 10N&#34;,GEOGCS[&#34;WGS 84&#34;,DATUM[&#34;WGS_1984&#34;,SPHEROID[&#34;WGS 84&#34;,6378137,298.257223563,AUTHORITY[&#34;EPSG&#34;,&#34;7030&#34;]],AUTHORITY[&#34;EPSG&#34;,&#34;6326&#34;]],PRIMEM[&#34;Greenwich&#34;,0,AUTHORITY[&#34;EPSG&#34;,&#34;8901&#34;]],UNIT[&#34;degree&#34;,0.0174532925199433,AUTHORITY[&#34;EPSG&#34;,&#34;9122&#34;]],AUTHORITY[&#34;EPSG&#34;,&#34;4326&#34;]],PROJECTION[&#34;Transverse_Mercator&#34;],PARAMETER[&#34;latitude_of_origin&#34;,0],PARAMETER[&#34;central_meridian&#34;,-123],PARAMETER[&#34;scale_factor&#34;,0.9996],PARAMETER[&#34;false_easting&#34;,500000],PARAMETER[&#34;false_northing&#34;,0],UNIT[&#34;metre&#34;,1,AUTHORITY[&#34;EPSG&#34;,&#34;9001&#34;]],AXIS[&#34;Easting&#34;,EAST],AXIS[&#34;Northing&#34;,NORTH],AUTHORITY[&#34;EPSG&#34;,&#34;32610&#34;]]&#39;),
 &#39;transform&#39;: Affine(30.0, 0.0, 583464.253406,
        0.0, -30.0, 5202549.0989)}
</pre></div></div>
</div>
</section>
<section id="Plotting">
<h2>Plotting<a class="headerlink" href="#Plotting" title="Link to this heading"></a></h2>
<p>rasterio reads raster data into numpy arrays so plotting a single band as two dimensional data can be accomplished directly with <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.imshow()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
numpy.ndarray
</pre></div></div>
</div>
<p>using <code class="docutils literal notranslate"><span class="pre">plt.imshow()</span></code>, we can visualize the array data contained in the raster dataset</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4500</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_24_0.png" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_24_0.png" />
</div>
</div>
<p>rasterio also offers <code class="docutils literal notranslate"><span class="pre">rasterio.plot.show()</span></code> to display rasters images and label the axes with geo-referenced extents. It also masks “nodata” cells.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4500</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_26_0.png" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_26_0.png" />
</div>
</div>
<p>To plot a raster and a vector layers together, we need to initialize a plot object with <code class="docutils literal notranslate"><span class="pre">plt.subplots</span></code>, and pass the same ax argument to both plots. For example, let’s import the HUC12 polygon of the upper White River (see the GeoPandas notebooks for more information on working with geospatial vector data):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="n">white_riv_huc12</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;data/rasterio/white_river_huc12.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">show</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4500</span><span class="p">)</span>
<span class="n">white_riv_huc12</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_29_0.png" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_29_0.png" />
</div>
</div>
<section id="Close-the-dataset-when-we're-done">
<h3>Close the dataset when we’re done<a class="headerlink" href="#Close-the-dataset-when-we're-done" title="Link to this heading"></a></h3>
<p>the <code class="docutils literal notranslate"><span class="pre">close()</span></code> method is used to close a dataset, releasing the underlying file handle and any associated resources. This is important for proper resource management, especially when dealing with many files or in long-running processes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">closed</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">closed</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
</section>
</section>
<section id="Accessing-and-manipulating-raster-data">
<h2>Accessing and manipulating raster data<a class="headerlink" href="#Accessing-and-manipulating-raster-data" title="Link to this heading"></a></h2>
<p>It is best practice to use <code class="docutils literal notranslate"><span class="pre">rasterio.open()</span></code> within a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement. This ensures proper closing of the dataset and resource management, even if errors occur. You might recognize this syntax from working with files in notebook <code class="docutils literal notranslate"><span class="pre">04_files_and_strings.ipynb</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;20150818_rainier_summer-tile-30.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">array_m</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">array_m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
numpy.ndarray
</pre></div></div>
</div>
<section id="Convert-to-units-of-feet">
<h3>Convert to units of feet<a class="headerlink" href="#Convert-to-units-of-feet" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_ft</span> <span class="o">=</span> <span class="n">array_m</span> <span class="o">*</span> <span class="mf">3.2084</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array_m</span><span class="p">,</span>  <span class="n">vmin</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4500</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_40_0.png" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_40_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">array_ft</span><span class="p">,</span>  <span class="n">vmin</span><span class="o">=</span><span class="mi">1600</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">14450</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_41_0.png" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_41_0.png" />
</div>
</div>
<p><strong>Looks the same! But notice the new units on the colobar scale.</strong></p>
<p>Now let’s save this raster to a new file.</p>
</section>
<section id="Make-the-data-categorical">
<h3>Make the data categorical<a class="headerlink" href="#Make-the-data-categorical" title="Link to this heading"></a></h3>
<p>Bin the array data into three categories (1, 2, or 3) based on elevation values using numpy indexing</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_classified</span> <span class="o">=</span> <span class="n">array_ft</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">array_classified</span><span class="p">[</span><span class="n">array_classified</span> <span class="o">&lt;</span> <span class="mi">6000</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>                                 <span class="c1"># Low elevation zone, less than 6,000 ft</span>
<span class="n">array_classified</span><span class="p">[(</span><span class="n">array_classified</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">array_classified</span> <span class="o">&gt;</span> <span class="mi">6000</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Mid elevation zone, between 6,000 and 10,000 ft</span>
<span class="n">array_classified</span><span class="p">[</span><span class="n">array_classified</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>                               <span class="c1"># High elevation zone, greater than 10,000 ft</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ct</span> <span class="o">=</span> <span class="n">show</span><span class="p">(</span><span class="n">array_classified</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">get_images</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;Low Elev. &#39;</span><span class="p">,</span> <span class="s1">&#39;Mid Elev.&#39;</span><span class="p">,</span> <span class="s1">&#39;High Elev.&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_45_0.png" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_45_0.png" />
</div>
</div>
</section>
</section>
<section id="Writing-Raster-files">
<h2>Writing Raster files<a class="headerlink" href="#Writing-Raster-files" title="Link to this heading"></a></h2>
<p>Writing a file with <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> involves defining the characteristics of the output raster and then writing your data array to it.</p>
<p>The characteristics are provided in the form of metadata (or “profile”) which takes the form of a dictionary containing parameters we looked at above, including:</p>
<ul class="simple">
<li><p>dimensions of the raster (height, width)</p></li>
<li><p>data type (dtype)</p></li>
<li><p>number of bands (count)</p></li>
<li><p>coordinate reference system (crs), and;</p></li>
<li><p>georeferencing transform (transform)</p></li>
</ul>
<section id="A-word-on-transforms">
<h3>A word on transforms<a class="headerlink" href="#A-word-on-transforms" title="Link to this heading"></a></h3>
<p>In a raster dataset, an affine transformation is a mathematical mapping that relates the dataset’s internal pixel coordinates to a real-world coordinate system. This process, known as georeferencing, allows software to correctly display, scale, and align the image with other spatial data.</p>
</section>
<section id="The-affine-matrix">
<h3>The affine matrix<a class="headerlink" href="#The-affine-matrix" title="Link to this heading"></a></h3>
<p>A raster georeferencing transform can be expressed in mathematical terms using an affine matrix. This matrix defines a set of equations to convert a pixel’s row and column coordinates into real-world x-y coordinates.</p>
<p>Geospatial coordinate reference systems are typically defined on a cartesian plane with the 0,0 origin in the bottom left. Raster data uses a different referencing system. Rows and columns with the 0,0 origin in the upper left and rows increase and you move down while the columns increase as you go right.</p>
<p><img alt="title" src="../../_images/xyrowcol.png" /></p>
<p>Image from <a class="reference external" href="https://www.perrygeo.com/python-affine-transforms.html">https://www.perrygeo.com/python-affine-transforms.html</a>. More info on the Python <a class="reference external" href="https://affine.readthedocs.io/en/latest/">Affine</a> library.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;20150818_rainier_summer-tile-30.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">transform</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">meta</span>

<span class="n">transform</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Affine(30.0, 0.0, 583464.253406,
       0.0, -30.0, 5202549.0989)
</pre></div></div>
</div>
</section>
<section id="There-are-six-elements-in-the-affine-transform-(a,-b,-c,-d,-e,-f)">
<h3>There are six elements in the affine transform (a, b, c, d, e, f)<a class="headerlink" href="#There-are-six-elements-in-the-affine-transform-(a,-b,-c,-d,-e,-f)" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>a = width of a pixel</p></li>
<li><p>b = row rotation (typically zero)</p></li>
<li><p>c = x-coordinate of the upper-left corner of the upper-left pixel</p></li>
<li><p>d = column rotation (typically zero)</p></li>
<li><p>e = height of a pixel (typically negative)</p></li>
<li><p>f = y-coordinate of the of the upper-left corner of the upper-left pixel</p></li>
</ul>
<p>rasterio provides an <code class="docutils literal notranslate"><span class="pre">rasterio.Affine</span></code> class, which can be used to create and manipulate new transforms</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Affine</span><span class="p">(</span>
    <span class="n">a</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="mf">583464.253406</span><span class="p">,</span>
    <span class="n">d</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">e</span><span class="o">=-</span><span class="mf">30.0</span><span class="p">,</span>
    <span class="n">f</span><span class="o">=</span><span class="mf">5202549.0989</span>
<span class="p">)</span>

<span class="n">transform</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Affine(30.0, 0.0, 583464.253406,
       0.0, -30.0, 5202549.0989)
</pre></div></div>
</div>
</section>
<section id="...-now-back-to-writing-that-raster">
<h3>… now back to writing that raster<a class="headerlink" href="#...-now-back-to-writing-that-raster" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_raster_file</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;20150818_rainier_summer-tile-30_feet.tif&#39;</span>
</pre></div>
</div>
</div>
<p>The long way - specify metadata and close manually:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out_dataset</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
    <span class="n">new_raster_file</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>         <span class="c1"># open file in write mode this time</span>
    <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">827</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">761</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">crs</span><span class="o">=</span><span class="mi">32610</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span>
    <span class="n">nodata</span><span class="o">=</span><span class="mf">0.0</span>
<span class="p">)</span>

<span class="n">out_dataset</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">array_ft</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">out_dataset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The short way - use <code class="docutils literal notranslate"><span class="pre">with</span></code> and the original file metadata, <code class="docutils literal notranslate"><span class="pre">meta</span></code>, using <code class="docutils literal notranslate"><span class="pre">**</span></code> to unpack the dictionary into arguments</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">new_raster_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_dataset</span><span class="p">:</span>
    <span class="n">out_dataset</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">array_ft</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Building-a-raster-from-scratch">
<h2>Building a raster from scratch<a class="headerlink" href="#Building-a-raster-from-scratch" title="Link to this heading"></a></h2>
<section id="Class-activity">
<h3>Class activity<a class="headerlink" href="#Class-activity" title="Link to this heading"></a></h3>
<p>Create and write your own raster. This raster should be:</p>
<ol class="arabic simple">
<li><p>10 rows, 10 columns</p></li>
<li><p>The raster can contain any value(s) you want, but bonus points for a checkerboard pattern</p></li>
<li><p>Set upper left coordinates to:</p>
<ul class="simple">
<li><p>xul: 569005.45</p></li>
<li><p>yul: 10746521.08</p></li>
</ul>
</li>
<li><p>EPSG is 3070</p></li>
</ol>
<p>Use the completed code blocks above as a template. <strong>Don’t be ashamed to adapt code you got from someone else or on the internet to accomplish something useful.</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Masking-(aka-clipping)-rasters-using-polygons">
<h2>Masking (aka clipping) rasters using polygons<a class="headerlink" href="#Masking-(aka-clipping)-rasters-using-polygons" title="Link to this heading"></a></h2>
<p>The rasterio <code class="docutils literal notranslate"><span class="pre">mask</span></code> function can be used to clip a raster to exclude areas outside of the polygon(s) defined in the shapefile.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.mask</span><span class="w"> </span><span class="kn">import</span> <span class="n">mask</span>
</pre></div>
</div>
</div>
<p>As an example, we can use the geometry information contained in the shapefile we plotted earlier as the mask</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">white_riv_huc12</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_68_0.svg" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_68_0.svg" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crop_shape</span> <span class="o">=</span> <span class="n">white_riv_huc12</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>A quick refersher - here’s what we’re working with:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">show</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4500</span><span class="p">)</span>
    <span class="n">white_riv_huc12</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_71_0.png" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_71_0.png" />
</div>
</div>
<p>Now let’s use the <code class="docutils literal notranslate"><span class="pre">mask</span></code> function to clip the raster data with the polygon.</p>
<p>Set <code class="docutils literal notranslate"><span class="pre">crop=True</span></code> to crop the raster’s extent to the bounding box of the polygon(s).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">mask_image</span><span class="p">,</span> <span class="n">mask_transform</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span>
        <span class="n">crop_shape</span><span class="p">,</span>
        <span class="n">crop</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">mask_meta</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">meta</span>

<span class="n">show</span><span class="p">(</span><span class="n">mask_image</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">mask_transform</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_73_0.png" src="../../_images/notebooks_part0_python_intro_10a_Rasterio_intro_73_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask_meta</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">mask_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">mask_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                 <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">mask_transform</span><span class="p">})</span>

<span class="n">masked_file</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">/</span> <span class="s1">&#39;20150818_rainier_summer-tile-30_masked.tif&#39;</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">masked_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">mask_meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_dataset</span><span class="p">:</span>
    <span class="n">out_dataset</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mask_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="solutions/09_Geopandas__solutions.html" class="btn btn-neutral float-left" title="09: Geopandas exercise solutions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="10b_Rasterio_advanced.html" class="btn btn-neutral float-right" title="10b: Using Rasterio and Numpy to examine ice loss on Mt. Rainier" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2025, USGS Python for Hydrology instructors.
      <span class="lastupdated">Last updated on Sep 24, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>