<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10: Particle tracking with MODPATH &mdash; Python for Hydrology 1.0a documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=feab032e"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Bonus examples" href="../../bonus_examples.html" />
    <link rel="prev" title="09: Demonstration of MODFLOW 6 Groundwater Transport with a Voronoi Grid" href="09-gwt-voronoi-demo.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Python for Hydrology
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Main Curriculum</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../part0.html">     Part 0: Introduction to Python</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../part1.html">Part 1: Flopy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01-Flopy-intro.html">01: Introduction to FloPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/02-Building-Post-Processing-MODFLOW6__solutions.html">02: Building and post-processing a MODFLOW 6 model</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/03_Loading_and_visualizing_models-solutions.html">03: Loading and visualizing groundwater models</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/04_Modelgrid_and_intersection_solution.html">04: Modelgrid and intersection</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-unstructured-grids.html">05: Unstructred Grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/06-Project-structured_completed.html">06: FloPy class project: Structured grid version</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/06-Project-quadtree.html">06: FloPy class project: Quadtree grid version</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/06-Project-voronoi.html">06: FloPy class project: Voronoi grid version</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/07-stream_capture_voronoi.html">07: Evaluating stream capture with a Voronoi grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="08_Modflow-setup-demo.html">08: Modflow-setup demonstration</a></li>
<li class="toctree-l2"><a class="reference internal" href="09-gwt-voronoi-demo.html">09: Demonstration of MODFLOW 6 Groundwater Transport with a Voronoi Grid</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10: Particle tracking with MODPATH</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Define-the-workspace-and-model-names.">Define the workspace and model names.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Load-the-MODFLOW-6-Model">Load the MODFLOW 6 Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Load-the-groundwater-flow-model">Load the groundwater flow model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Change-the-workspace">Change the workspace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Write-the-model-files">Write the model files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Create-and-Run-the-MODPATH-model">Create and Run the MODPATH model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Lets-plot-the-model-grid-and-the-location-of-the-contamination-patch.">Lets plot the model grid and the location of the contamination patch.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Create-the-MODPATH-particle-data">Create the MODPATH particle data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Create-the-MODPATH-7-files">Create the MODPATH 7 files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Write-MODPATH-7-files-and-run-the-model">Write MODPATH 7 files and run the model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Post-Process-the-MODFLOW-and-MODPATH-Results">Post-Process the MODFLOW and MODPATH Results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Load-MODFLOW-and-MODPATH-results-from-the-heads-and-pathline-files">Load MODFLOW and MODPATH results from the heads and pathline files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plot-the-heads-and-pathlines">Plot the heads and pathlines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Export-the-pathlines-to-a-shapefile">Export the pathlines to a shapefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Load-the-shapefile-into-geopandas">Load the shapefile into geopandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Show-the-dataframe">Show the dataframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plot-the-geopandas-dataframe-on-the-modelgrid">Plot the geopandas dataframe on the modelgrid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Export-the-data-to-VTK-(Visualization-ToolKit)-format-for-a-3d-representation">Export the data to VTK (Visualization ToolKit) format for a 3d representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Alternatively-we-can-visualize-the-VTK-representation-using-pyvista.-To-activate-these-cells,-set-plotvtk=True">Alternatively we can visualize the VTK representation using <code class="docutils literal notranslate"><span class="pre">pyvista</span></code>. To activate these cells, set <code class="docutils literal notranslate"><span class="pre">plotvtk=True</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bonus Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bonus_examples.html">     General Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SOME_HELPFUL_LINKS.html"> Additional links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html"> Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary_of_jargon.html"> Glossary of jargon</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python for Hydrology</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../part1.html">Part 1 flopy</a></li>
      <li class="breadcrumb-item active">10: Particle tracking with MODPATH</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/part1_flopy/10_modpath_particle_tracking-demo.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="10:-Particle-tracking-with-MODPATH">
<h1>10: Particle tracking with MODPATH<a class="headerlink" href="#10:-Particle-tracking-with-MODPATH" title="Link to this heading">¶</a></h1>
<p>In this exercise, we will use MODPATH to simulate advective transport with the Freyberg flow model.</p>
<p>MODPATH is a particle tracking software that simulates the advective transport of particles using the output from a MODFLOW groundwater flow model. The MODPATH user guide, documentation, and executable can be found <a class="reference external" href="https://www.usgs.gov/software/modpath-particle-tracking-model-modflow">here</a>. The MODPATH executable is downloaded with the stack of modflow related programs when <code class="docutils literal notranslate"><span class="pre">get_modflow()</span></code> was run in setup for this course. Students should already have this program on their machines.</p>
<p>For this exercise, we will use a quadtree version of the Freyberg model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">pathlib</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">flopy.utils.gridintersect</span> <span class="kn">import</span> <span class="n">GridIntersect</span>
<span class="kn">import</span> <span class="nn">flopy</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
<p>The location of the contamination patch and the nodes that the define bounding cells of the patch are calculated below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># patch upper left and lower right</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mf">250.</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">250.</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="mi">14</span><span class="p">)</span> <span class="o">*</span> <span class="mf">250.</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span> <span class="o">-</span> <span class="mi">11</span><span class="p">)</span> <span class="o">*</span> <span class="mf">250.</span>

<span class="n">csx</span><span class="p">,</span> <span class="n">csy</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">]</span>
<span class="n">polygon</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">csx</span><span class="p">,</span> <span class="n">csy</span><span class="p">))]</span>
<span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((250.0, 7250.0), (750.0, 6500.0))
</pre></div></div>
</div>
<hr class="docutils" />
<section id="Define-the-workspace-and-model-names.">
<h2>Define the workspace and model names.<a class="headerlink" href="#Define-the-workspace-and-model-names." title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">load_ws</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/quadtree&#39;</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;temp/ex10a&quot;</span><span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;project&quot;</span>
<span class="n">name_mp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_mp&quot;</span>
<span class="n">exe_name</span> <span class="o">=</span> <span class="s1">&#39;mf6&#39;</span>
</pre></div>
</div>
</div>
<section id="Load-the-MODFLOW-6-Model">
<h3>Load the MODFLOW 6 Model<a class="headerlink" href="#Load-the-MODFLOW-6-Model" title="Link to this heading">¶</a></h3>
<p>Load a simulation object using <code class="docutils literal notranslate"><span class="pre">flopy.mf6.MFSimulation().load()</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">mf6</span><span class="o">.</span><span class="n">MFSimulation</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sim_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">exe_name</span><span class="o">=</span><span class="n">exe_name</span><span class="p">,</span>
                                    <span class="n">sim_ws</span><span class="o">=</span><span class="n">load_ws</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Load-the-groundwater-flow-model">
<h2>Load the groundwater flow model<a class="headerlink" href="#Load-the-groundwater-flow-model" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gwf</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="n">gwf</span><span class="o">.</span><span class="n">modelgrid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
xll:0.0; yll:0.0; rotation:0.0; units:meters; lenuni:2
</pre></div></div>
</div>
</section>
<section id="Change-the-workspace">
<h2>Change the workspace<a class="headerlink" href="#Change-the-workspace" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">set_sim_path</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Write-the-model-files">
<h2>Write the model files<a class="headerlink" href="#Write-the-model-files" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="n">sim</span><span class="o">.</span><span class="n">write_simulation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Run the simulation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FloPy is using the following executable to run the model: ../../../../../../../.local/share/flopy/bin/mf6
                                   MODFLOW 6
                U.S. GEOLOGICAL SURVEY MODULAR HYDROLOGIC MODEL
                            VERSION 6.4.2 06/28/2023

   MODFLOW 6 compiled Jul 05 2023 20:29:14 with Intel(R) Fortran Intel(R) 64
   Compiler Classic for applications running on Intel(R) 64, Version 2021.7.0
                             Build 20220726_000000

This software has been approved for release by the U.S. Geological
Survey (USGS). Although the software has been subjected to rigorous
review, the USGS reserves the right to update the software as needed
pursuant to further analysis and review. No warranty, expressed or
implied, is made by the USGS or the U.S. Government as to the
functionality of the software and related material nor shall the
fact of release constitute any such warranty. Furthermore, the
software is released on condition that neither the USGS nor the U.S.
Government shall be held liable for any damages resulting from its
authorized or unauthorized use. Also refer to the USGS Water
Resources Software User Rights Notice for complete use, copyright,
and distribution information.


 Run start date and time (yyyy/mm/dd hh:mm:ss): 2024/03/20 14:00:05

 Writing simulation list file: mfsim.lst
 Using Simulation name file: mfsim.nam

    Solving:  Stress period:     1    Time step:     1

 Run end date and time (yyyy/mm/dd hh:mm:ss): 2024/03/20 14:00:06
 Elapsed run time:  0.603 Seconds


WARNING REPORT:

  1. OPTIONS BLOCK VARIABLE &#39;UNIT_CONVERSION&#39; IN FILE &#39;project.sfr&#39; WAS
     DEPRECATED IN VERSION 6.4.2. SETTING UNIT_CONVERSION DIRECTLY.
 Normal termination of simulation.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(True, [])
</pre></div></div>
</div>
<section id="Create-and-Run-the-MODPATH-model">
<h3>Create and Run the MODPATH model<a class="headerlink" href="#Create-and-Run-the-MODPATH-model" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="Lets-plot-the-model-grid-and-the-location-of-the-contamination-patch.">
<h2>Lets plot the model grid and the location of the contamination patch.<a class="headerlink" href="#Lets-plot-the-model-grid-and-the-location-of-the-contamination-patch." title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">mm</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">PlotMapView</span><span class="p">(</span><span class="n">gwf</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">mm</span><span class="o">.</span><span class="n">plot_bc</span><span class="p">(</span><span class="s1">&#39;SFR&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">plotAll</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_bc</span><span class="p">(</span><span class="s1">&#39;WEL&#39;</span><span class="p">,</span> <span class="n">plotAll</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="n">mm</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">csx</span><span class="p">,</span> <span class="n">csy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#e534eb&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_17_0.png" src="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_17_0.png" />
</div>
</div>
<p>Find the node numbers of the contamination patch using the groundwater model grid object and the <code class="docutils literal notranslate"><span class="pre">GridIntersect</span></code> utility. The <code class="docutils literal notranslate"><span class="pre">GridIntersect</span></code> utility has an <code class="docutils literal notranslate"><span class="pre">intersect</span></code> method that can be used to identified cellids from points, lines, and polygons.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gx</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">gwf</span><span class="o">.</span><span class="n">modelgrid</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">)</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">cellids</span>
<span class="n">nodes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([1352, 1353, 1459, 1460, 1581, 1582], dtype=object)
</pre></div></div>
</div>
</section>
<section id="Create-the-MODPATH-particle-data">
<h2>Create the MODPATH particle data<a class="headerlink" href="#Create-the-MODPATH-particle-data" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modpath</span><span class="o">.</span><span class="n">CellDataType</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modpath</span><span class="o">.</span><span class="n">NodeParticleData</span><span class="p">(</span><span class="n">subdivisiondata</span><span class="o">=</span><span class="p">[</span><span class="n">sd</span><span class="p">],</span>
                                   <span class="n">nodes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
<span class="c1"># create forward particle group</span>
<span class="n">fpth</span> <span class="o">=</span> <span class="n">name_mp</span> <span class="o">+</span> <span class="s1">&#39;.sloc&#39;</span>
<span class="n">pg</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modpath</span><span class="o">.</span><span class="n">ParticleGroupNodeTemplate</span><span class="p">(</span><span class="n">particlegroupname</span><span class="o">=</span><span class="s1">&#39;contaminant&#39;</span><span class="p">,</span>
                                             <span class="n">particledata</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
                                             <span class="n">filename</span><span class="o">=</span><span class="n">fpth</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Create-the-MODPATH-7-files">
<h2>Create the MODPATH 7 files<a class="headerlink" href="#Create-the-MODPATH-7-files" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create modpath files</span>
<span class="n">mp</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modpath</span><span class="o">.</span><span class="n">Modpath7</span><span class="p">(</span><span class="n">modelname</span><span class="o">=</span><span class="n">name_mp</span><span class="p">,</span> <span class="n">flowmodel</span><span class="o">=</span><span class="n">gwf</span><span class="p">,</span>
                            <span class="n">exe_name</span><span class="o">=</span><span class="s1">&#39;mp7&#39;</span><span class="p">,</span> <span class="n">model_ws</span><span class="o">=</span><span class="n">ws</span><span class="p">)</span>
<span class="n">mpbas</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modpath</span><span class="o">.</span><span class="n">Modpath7Bas</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">porosity</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">mpsim</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">modpath</span><span class="o">.</span><span class="n">Modpath7Sim</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">simulationtype</span><span class="o">=</span><span class="s1">&#39;pathline&#39;</span><span class="p">,</span>
                                  <span class="n">trackingdirection</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span>
                                  <span class="n">weaksinkoption</span><span class="o">=</span><span class="s1">&#39;pass_through&#39;</span><span class="p">,</span>
                                  <span class="n">weaksourceoption</span><span class="o">=</span><span class="s1">&#39;pass_through&#39;</span><span class="p">,</span>
                                  <span class="n">referencetime</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                                  <span class="n">stoptimeoption</span><span class="o">=</span><span class="s1">&#39;extend&#39;</span><span class="p">,</span>
                                  <span class="n">particlegroups</span><span class="o">=</span><span class="n">pg</span><span class="p">)</span>
<span class="n">help</span><span class="p">(</span><span class="n">flopy</span><span class="o">.</span><span class="n">modpath</span><span class="o">.</span><span class="n">Modpath7Sim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on class Modpath7Sim in module flopy.modpath.mp7sim:

class Modpath7Sim(flopy.pakbase.Package)
 |  Modpath7Sim(model, mpnamefilename=None, listingfilename=None, endpointfilename=None, pathlinefilename=None, timeseriesfilename=None, tracefilename=None, simulationtype=&#39;pathline&#39;, trackingdirection=&#39;forward&#39;, weaksinkoption=&#39;stop_at&#39;, weaksourceoption=&#39;stop_at&#39;, budgetoutputoption=&#39;no&#39;, traceparticledata=None, budgetcellnumbers=None, referencetime=None, stoptimeoption=&#39;extend&#39;, stoptime=None, timepointdata=None, zonedataoption=&#39;off&#39;, stopzone=None, zones=0, retardationfactoroption=&#39;off&#39;, retardation=1.0, particlegroups=None, extension=&#39;mpsim&#39;)
 |
 |  MODPATH Simulation File Package Class.
 |
 |  Parameters
 |  ----------
 |  model : model object
 |      The model object (of type :class:`flopy.modpath.Modpath7`) to
 |      which this package will be added.
 |  mpnamefilename : str
 |      Filename of the MODPATH 7 name file. If mpnamefilename is not
 |      defined it will be generated from the model name
 |      (default is None).
 |  listingfilename : str
 |      Filename of the MODPATH 7 listing file. If listingfilename is not
 |      defined it will be generated from the model name
 |      (default is None).
 |  endpointfilename : str
 |      Filename of the MODPATH 7 endpoint file. If endpointfilename is
 |      not defined it will be generated from the model name
 |      (default is None).
 |  pathlinefilename : str
 |      Filename of the MODPATH 7 pathline file. If pathlinefilename is
 |      not defined it will be generated from the model name
 |      (default is None).
 |  timeseriesfilename : str
 |      Filename of the MODPATH 7 timeseries file. If timeseriesfilename
 |      is not defined it will be generated from the model name
 |      (default is None).
 |  tracefilename : str
 |      Filename of the MODPATH 7 tracefile file. If tracefilename is not
 |      defined it will be generated from the model name
 |      (default is None).
 |  simulationtype : str
 |      MODPATH 7 simulation type. Valid simulation types are &#39;endpoint&#39;,
 |      &#39;pathline&#39;, &#39;timeseries&#39;, or &#39;combined&#39; (default is &#39;pathline&#39;).
 |  trackingdirection : str
 |      MODPATH 7 tracking direction. Valid tracking directions are
 |      &#39;forward&#39; or &#39;backward&#39; (default os &#39;forward&#39;).
 |  weaksinkoption : str
 |      MODPATH 7 weak sink option. Valid weak sink options are
 |      &#39;pass_through&#39; or &#39;stop_at&#39; (default value is &#39;stop_at&#39;).
 |  weaksourceoption : str
 |      MODPATH 7 weak source option. Valid weak source options are
 |      &#39;pass_through&#39; or &#39;stop_at&#39; (default value is &#39;stop_at&#39;).
 |  budgetoutputoption : str
 |      MODPATH 7 budget output option. Valid budget output options are
 |      &#39;no&#39; - individual cell water balance errors are not computed
 |      and budget record headers are not printed, &#39;summary&#39; - a summary
 |      of individual cell water balance errors for each time step is
 |      printed in the listing file without record headers, or
 |      &#39;record_summary&#39; -  a summary of individual cell water balance
 |      errors for each time step is printed in the listing file with
 |      record headers (default is &#39;summary&#39;).
 |  traceparticledata : list or tuple
 |      List or tuple with two ints that define the particle group and
 |      particle id (zero-based) of the specified particle that is
 |      followed in detail. If traceparticledata is None, trace mode is
 |      off (default is None).
 |  budgetcellnumbers : int, list of ints, tuple of ints, or np.ndarray
 |      Cell numbers (zero-based) for which detailed water budgets are
 |      computed. If budgetcellnumbers is None, detailed water budgets are
 |      not calculated (default is None).
 |  referencetime : float, list, or tuple
 |      Specified reference time if a float or a list/tuple with a single
 |      float value is provided (reference time option 1). Otherwise a
 |      list or tuple with a zero-based stress period (int) and time
 |      step (int) and a float defining the relative time position in the
 |      time step is provided (reference time option 2). If referencetime
 |      is None, reference time is set to 0 (default is None).
 |  stoptimeoption : str
 |      String indicating how a particle tracking simulation is
 |      terminated based on time. If stop time option is &#39;total&#39;, particles
 |      will be stopped at the end of the final time step if &#39;forward&#39;
 |      tracking is simulated or at the beginning of the first time step
 |      if backward tracking. If stop time option is &#39;extend&#39;, initial or
 |      final steady-state time steps will be extended and all particles
 |      will be tracked until they reach a termination location. If stop
 |      time option is &#39;specified&#39;, particles will be tracked until they
 |      reach a termination location or the specified stop time is reached
 |      (default is &#39;extend&#39;).
 |  stoptime : float
 |      User-specified value of tracking time at which to stop a particle
 |      tracking simulation. Stop time is only used if the stop time option
 |      is &#39;specified&#39;. If stoptime is None and the stop time option is
 |      &#39;specified&#39; particles will be terminated at the end of the last
 |      time step if &#39;forward&#39; tracking or the beginning of the first time
 |      step if &#39;backward&#39; tracking (default is None).
 |  timepointdata : list or tuple
 |      List or tuple with 2 items that is only used if simulationtype is
 |      &#39;timeseries&#39; or &#39;combined&#39;. If the second item is a float then the
 |      timepoint data corresponds to time point option 1 and the first
 |      entry is the number of time points (timepointcount) and the second
 |      entry is the time point interval. If the second item is a list,
 |      tuple, or np.ndarray then the timepoint data corresponds to time
 |      point option 2 and the number of time points entries
 |      (timepointcount) in the second item and the second item is an
 |      list, tuple, or array of user-defined time points. If Timepointdata
 |      is None, time point option 1 is specified and the total simulation
 |      time is split into 100 intervals (default is None).
 |  zonedataoption : str
 |      If zonedataoption is &#39;off&#39;, zone array data are not read and a zone
 |      value of 1 is applied to all cells. If zonedataoption is &#39;on&#39;,
 |      zone array data are read (default is &#39;off&#39;).
 |  stopzone : int
 |      A zero-based specified integer zone value that indicates an
 |      automatic stopping location for particles and is only used if
 |      zonedataoption is &#39;on&#39;. A value of -1 indicates no automatic stop
 |      zone is used.  Stopzone values less than -1 are not allowed. If
 |      stopzone is None, stopzone is set to -1 (default is None).
 |  zones : float or array of floats (nlay, nrow, ncol)
 |      Array of zero-based positive integer zones that are only used if
 |      zonedataoption is &#39;on&#39; (default is 0).
 |  retardationfactoroption : str
 |      If retardationfactoroption is &#39;off&#39;, retardation array data are not
 |      read and a retardation factor of 1 is applied to all cells. If
 |      retardationfactoroption is &#39;on&#39;, retardation factor array data are
 |      read (default is &#39;off&#39;).
 |  retardation : float or array of floats (nlay, nrow, ncol)
 |      Array of retardation factors that are only used if
 |      retardationfactoroption is &#39;on&#39; (default is 1).
 |  particlegroups : ParticleGroup or list of ParticleGroups
 |      ParticleGroup or list of ParticlesGroups that contain data for
 |      individual particle groups. If None is specified, a
 |      particle in the center of node 0 will be created (default is None).
 |  extension : string
 |      Filename extension (default is &#39;mpsim&#39;)
 |
 |  Examples
 |  --------
 |
 |  &gt;&gt;&gt; import flopy
 |  &gt;&gt;&gt; m = flopy.modflow.Modflow.load(&#39;mf2005.nam&#39;)
 |  &gt;&gt;&gt; mp = flopy.modpath.Modpath7(&#39;mf2005_mp&#39;, flowmodel=m)
 |  &gt;&gt;&gt; mpsim = flopy.modpath.Modpath7Sim(mp)
 |
 |  Method resolution order:
 |      Modpath7Sim
 |      flopy.pakbase.Package
 |      flopy.pakbase.PackageInterface
 |      builtins.object
 |
 |  Methods defined here:
 |
 |  __init__(self, model, mpnamefilename=None, listingfilename=None, endpointfilename=None, pathlinefilename=None, timeseriesfilename=None, tracefilename=None, simulationtype=&#39;pathline&#39;, trackingdirection=&#39;forward&#39;, weaksinkoption=&#39;stop_at&#39;, weaksourceoption=&#39;stop_at&#39;, budgetoutputoption=&#39;no&#39;, traceparticledata=None, budgetcellnumbers=None, referencetime=None, stoptimeoption=&#39;extend&#39;, stoptime=None, timepointdata=None, zonedataoption=&#39;off&#39;, stopzone=None, zones=0, retardationfactoroption=&#39;off&#39;, retardation=1.0, particlegroups=None, extension=&#39;mpsim&#39;)
 |      Initialize self.  See help(type(self)) for accurate signature.
 |
 |  write_file(self, check=False)
 |      Write the package file
 |
 |      Parameters
 |      ----------
 |      check : boolean
 |          Check package data for common errors. (default False)
 |
 |      Returns
 |      -------
 |      None
 |
 |  ----------------------------------------------------------------------
 |  Methods inherited from flopy.pakbase.Package:
 |
 |  __getitem__(self, item)
 |
 |  __repr__(self)
 |      Return repr(self).
 |
 |  __setattr__(self, key, value)
 |      Implement setattr(self, name, value).
 |
 |  __setitem__(self, key, value)
 |
 |  export(self, f, **kwargs)
 |      Method to export a package to netcdf or shapefile based on the
 |      extension of the file name (.shp for shapefile, .nc for netcdf)
 |
 |      Parameters
 |      ----------
 |      f : str
 |          filename
 |      kwargs : keyword arguments
 |          modelgrid : flopy.discretization.Grid instance
 |              user supplied modelgrid which can be used for exporting
 |              in lieu of the modelgrid associated with the model object
 |
 |      Returns
 |      -------
 |          None or Netcdf object
 |
 |  level1_arraylist(self, idx, v, name, txt)
 |
 |  plot(self, **kwargs)
 |      Plot 2-D, 3-D, transient 2-D, and stress period list (MfList)
 |      package input data
 |
 |      Parameters
 |      ----------
 |      **kwargs : dict
 |          filename_base : str
 |              Base file name that will be used to automatically generate file
 |              names for output image files. Plots will be exported as image
 |              files if file_name_base is not None. (default is None)
 |          file_extension : str
 |              Valid matplotlib.pyplot file extension for savefig(). Only used
 |              if filename_base is not None. (default is &#39;png&#39;)
 |          mflay : int
 |              MODFLOW zero-based layer number to return.  If None, then all
 |              all layers will be included. (default is None)
 |          kper : int
 |              MODFLOW zero-based stress period number to return. (default is
 |              zero)
 |          key : str
 |              MfList dictionary key. (default is None)
 |
 |      Returns
 |      ----------
 |      axes : list
 |          Empty list is returned if filename_base is not None. Otherwise
 |          a list of matplotlib.pyplot.axis are returned.
 |
 |      See Also
 |      --------
 |
 |      Notes
 |      -----
 |
 |      Examples
 |      --------
 |      &gt;&gt;&gt; import flopy
 |      &gt;&gt;&gt; ml = flopy.modflow.Modflow.load(&#39;test.nam&#39;)
 |      &gt;&gt;&gt; ml.dis.plot()
 |
 |  set_cbc_output_file(self, ipakcb, model, fname)
 |
 |  to_shapefile(self, filename, **kwargs)
 |      Export 2-D, 3-D, and transient 2-D model data to shapefile (polygons).
 |      Adds an attribute for each layer in each data array
 |
 |      Parameters
 |      ----------
 |      filename : str
 |          Shapefile name to write
 |
 |      Returns
 |      ----------
 |      None
 |
 |      See Also
 |      --------
 |
 |      Notes
 |      -----
 |
 |      Examples
 |      --------
 |      &gt;&gt;&gt; import flopy
 |      &gt;&gt;&gt; ml = flopy.modflow.Modflow.load(&#39;test.nam&#39;)
 |      &gt;&gt;&gt; ml.lpf.to_shapefile(&#39;test_hk.shp&#39;)
 |
 |  webdoc(self)
 |      Open the web documentation.
 |
 |  ----------------------------------------------------------------------
 |  Static methods inherited from flopy.pakbase.Package:
 |
 |  add_to_dtype(dtype, field_names, field_types)
 |      Add one or more fields to a structured array data type
 |
 |      Parameters
 |      ----------
 |      dtype : numpy.dtype
 |          Input structured array datatype to add to.
 |      field_names : str or list
 |          One or more field names.
 |      field_types : numpy.dtype or list
 |          One or more data types. If one data type is supplied, it is
 |          repeated for each field name.
 |
 |  load(f: Union[str, bytes, os.PathLike], model, pak_type, ext_unit_dict=None, **kwargs)
 |      Default load method for standard boundary packages.
 |
 |  ----------------------------------------------------------------------
 |  Readonly properties inherited from flopy.pakbase.Package:
 |
 |  data_list
 |
 |  package_type
 |
 |  plottable
 |
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from flopy.pakbase.Package:
 |
 |  name
 |
 |  parent
 |
 |  ----------------------------------------------------------------------
 |  Methods inherited from flopy.pakbase.PackageInterface:
 |
 |  check(self, f=None, verbose=True, level=1, checktype=None)
 |      Check package data for common errors.
 |
 |      Parameters
 |      ----------
 |      f : str or file handle
 |          String defining file name or file handle for summary file
 |          of check method output. If a sting is passed a file handle
 |          is created. If f is None, check method does not write
 |          results to a summary file. (default is None)
 |      verbose : bool
 |          Boolean flag used to determine if check method results are
 |          written to the screen
 |      level : int
 |          Check method analysis level. If level=0, summary checks are
 |          performed. If level=1, full checks are performed.
 |      checktype : check
 |          Checker type to be used. By default class check is used from
 |          check.py.
 |
 |      Returns
 |      -------
 |      None
 |
 |      Examples
 |      --------
 |
 |      &gt;&gt;&gt; import flopy
 |      &gt;&gt;&gt; m = flopy.modflow.Modflow.load(&#39;model.nam&#39;)
 |      &gt;&gt;&gt; m.dis.check()
 |
 |  ----------------------------------------------------------------------
 |  Readonly properties inherited from flopy.pakbase.PackageInterface:
 |
 |  has_stress_period_data
 |
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from flopy.pakbase.PackageInterface:
 |
 |  __dict__
 |      dictionary for instance variables
 |
 |  __weakref__
 |      list of weak references to the object

</pre></div></div>
</div>
</section>
<section id="Write-MODPATH-7-files-and-run-the-model">
<h2>Write MODPATH 7 files and run the model<a class="headerlink" href="#Write-MODPATH-7-files-and-run-the-model" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># write modpath datasets</span>
<span class="n">mp</span><span class="o">.</span><span class="n">write_input</span><span class="p">()</span>

<span class="c1"># run modpath</span>
<span class="n">mp</span><span class="o">.</span><span class="n">run_model</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FloPy is using the following executable to run the model: ../../../../../../../.local/share/flopy/bin/mp7

MODPATH Version 7.2.001
Program compiled Jul 05 2023 20:35:22 with IFORT compiler (ver. 20.21.7)


Run particle tracking simulation ...
Processing Time Step     1 Period     1.  Time =  1.00000E+00  Steady-state flow

Particle Summary:
         0 particles are pending release.
         0 particles remain active.
         0 particles terminated at boundary faces.
         0 particles terminated at weak sink cells.
         0 particles terminated at weak source cells.
       162 particles terminated at strong source/sink cells.
         0 particles terminated in cells with a specified zone number.
         0 particles were stranded in inactive or dry cells.
         0 particles were unreleased.
         0 particles have an unknown status.

Normal termination.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(True, [])
</pre></div></div>
</div>
<section id="Post-Process-the-MODFLOW-and-MODPATH-Results">
<h3>Post-Process the MODFLOW and MODPATH Results<a class="headerlink" href="#Post-Process-the-MODFLOW-and-MODPATH-Results" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="Load-MODFLOW-and-MODPATH-results-from-the-heads-and-pathline-files">
<h2>Load MODFLOW and MODPATH results from the heads and pathline files<a class="headerlink" href="#Load-MODFLOW-and-MODPATH-results-from-the-heads-and-pathline-files" title="Link to this heading">¶</a></h2>
<p>Load the MODFLOW heads</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hobj</span> <span class="o">=</span> <span class="n">gwf</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hds</span> <span class="o">=</span> <span class="n">hobj</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Load the pathline file</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ppth</span> <span class="o">=</span><span class="n">ws</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_mp</span><span class="si">}</span><span class="s2">.mppth&quot;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">PathlineFile</span><span class="p">(</span><span class="n">ppth</span><span class="p">)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_alldata</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[array([( 291.66666, 7041.6665, 25.157747 ,     0.    , 0, 0),
        ( 292.26523, 7053.434 , 24.259151 ,  1066.6232, 0, 0),
        ( 296.87158, 7187.315 , 18.867577 ,  9176.828 , 1, 0),
        ( 298.29572, 7250.    , 17.83786  , 11656.656 , 2, 0),
        ( 327.38013, 7500.    , 17.041315 , 17482.574 , 2, 0),
        ( 351.95312, 7750.    , 14.886883 , 21403.549 , 2, 0),
        ( 384.25983, 8000.    , 14.738331 , 24241.266 , 2, 0),
        ( 437.98865, 8250.    , 15.478686 , 26416.283 , 2, 0),
        ( 500.     , 8325.292 , 14.165776 , 27109.031 , 2, 0),
        ( 692.9299 , 8500.    , 15.878951 , 28298.334 , 2, 0),
        ( 750.     , 8540.724 , 17.176243 , 28605.803 , 2, 0),
        (1000.     , 8630.868 , 14.297673 , 30072.422 , 2, 0),
        (1250.     , 8669.552 , 14.05823  , 31359.709 , 2, 0),
        (1500.     , 8683.525 , 15.129906 , 32383.266 , 2, 0),
        (1750.     , 8648.858 , 15.427488 , 33216.24  , 2, 0),
        (2000.     , 8599.475 , 13.062349 , 34121.06  , 2, 0),
        (2250.     , 8531.675 , 14.423839 , 34772.07  , 2, 0),
        (2322.0684 , 8500.    , 10.878183 , 35016.754 , 2, 0),
        (2500.     , 8421.822 ,  9.152523 , 35671.594 , 2, 0),
        (2588.7498 , 8375.    ,  3.7609835, 36132.93  , 2, 0),
        (2625.     , 8356.87  ,  3.756292 , 36310.203 , 2, 0),
        (2750.     , 8295.934 ,  3.7417758, 36877.59  , 2, 0),
        (2849.241  , 8250.    ,  3.6520696, 37296.168 , 2, 0),
        (2875.     , 8235.725 ,  3.6121962, 37420.03  , 2, 0),
        (2937.5    , 8205.341 ,  3.7405884, 37695.703 , 2, 0),
        (2971.6401 , 8187.5   ,  3.7372005, 37843.93  , 2, 0),
        (3000.     , 8175.1055,  3.7348478, 37948.184 , 2, 0),
        (3062.5    , 8156.6216,  3.9858716, 38161.88  , 2, 0),
        (3063.7656 , 8156.25  ,  4.1625876, 38166.094 , 2, 0),
        (3093.75   , 8147.8945,  4.1604686, 38263.008 , 2, 0),
        (3125.     , 8139.558 ,  4.1584296, 38357.234 , 2, 0),
        (3140.625  , 8136.6265,  4.202556 , 38401.426 , 2, 0),
        (3156.25   , 8133.5854,  4.201312 , 38444.7   , 2, 0),
        (3171.875  , 8131.6494,  4.052273 , 38486.99  , 2, 0),
        (3187.5    , 8127.9507,  3.803092 , 38593.96  , 2, 0),
        (3191.0186 , 8125.    ,  3.708662 , 38683.953 , 2, 0),
        (3203.125  , 8118.2197,  3.697419 , 38890.438 , 2, 0),
        (3218.75   , 8110.778 ,  3.696752 , 39123.6   , 2, 0),
        (3250.     , 8098.4146,  3.542844 , 39516.027 , 2, 0),
        (3259.4897 , 8093.75  ,  3.3440852, 39625.527 , 2, 0),
        (3281.25   , 8082.3413,  3.34398  , 39905.668 , 2, 0),
        (3312.5    , 8070.0215,  3.3438506, 40262.293 , 2, 0),
        (3333.566  , 8062.5   ,  3.0362823, 40485.49  , 2, 0),
        (3375.     , 8047.49  ,  3.1637154, 40932.04  , 2, 0),
        (3437.5    , 8013.0425,  2.9553792, 41570.11  , 2, 0),
        (3464.91   , 8000.    ,  2.9553003, 41827.246 , 2, 0),
        (3500.     , 7990.7407,  3.2104254, 42010.31  , 2, 0),
        (3625.     , 7967.9907,  3.2902322, 42530.023 , 2, 0),
        (3680.1426 , 7937.5   ,  3.2615664, 42698.07  , 2, 0),
        (3687.5    , 7934.937 ,  3.2615619, 42714.484 , 2, 0),
        (3750.     , 7915.0894,  3.2615318, 42823.734 , 2, 0),
        (3773.753  , 7906.25  ,  3.2376952, 42854.773 , 2, 0),
        (3781.25   , 7904.3774,  3.23769  , 42862.258 , 2, 0),
        (3812.5    , 7896.45  ,  3.237673 , 42886.637 , 2, 0),
        (3828.125  , 7891.537 ,  3.2256062, 42895.133 , 2, 0),
        (3830.2957 , 7890.625 ,  3.225588 , 42896.133 , 2, 0),
        (3843.75   , 7887.5903,  3.2255182, 42900.066 , 2, 0),
        (3859.375  , 7885.2886,  3.2016592, 42902.145 , 2, 0),
        (3859.375  , 7885.2886,  3.2188113, 42902.145 , 2, 0)],
       dtype={&#39;names&#39;: [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;time&#39;, &#39;k&#39;, &#39;particleid&#39;], &#39;formats&#39;: [&#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;i4&#39;, &#39;&lt;i4&#39;], &#39;offsets&#39;: [20, 24, 28, 16, 32, 0], &#39;itemsize&#39;: 60}),
 array([( 375.     , 7041.6665, 25.157747 ,     0.    , 0, 1),
        ( 375.75186, 7053.434 , 24.259151 ,  1066.6232, 0, 1),
        ( 381.52545, 7187.315 , 18.867577 ,  9176.828 , 1, 1),
        ( 383.30856, 7250.    , 17.83786  , 11656.656 , 2, 1),
        ( 406.18857, 7500.    , 17.041315 , 17482.574 , 2, 1),
        ( 429.23462, 7750.    , 14.886883 , 21403.549 , 2, 1),
        ( 466.02756, 8000.    , 14.738331 , 24241.266 , 2, 1),
        ( 500.     , 8134.05  , 15.576507 , 25436.912 , 2, 1),
        ( 518.4427 , 8250.    , 15.027732 , 26109.572 , 2, 1),
        ( 750.     , 8465.881 , 15.941434 , 27393.213 , 2, 1),
        ( 894.6647 , 8500.    , 12.070309 , 28152.492 , 2, 1),
        (1000.     , 8535.509 , 14.394118 , 28748.236 , 2, 1),
        (1250.     , 8562.502 , 14.136991 , 30035.523 , 2, 1),
        (1500.     , 8564.003 , 15.185995 , 31059.08  , 2, 1),
        (1750.     , 8521.553 , 15.469522 , 31892.055 , 2, 1),
        (1840.7961 , 8500.    , 13.12992  , 32226.053 , 2, 1),
        (2000.     , 8464.708 , 13.11985  , 32755.252 , 2, 1),
        (2250.     , 8386.366 , 14.19391  , 33350.297 , 2, 1),
        (2500.     , 8257.273 ,  9.194104 , 34267.223 , 2, 1),
        (2514.2393 , 8250.    ,  3.8298988, 34341.61  , 2, 1),
        (2625.     , 8181.72  ,  3.796223 , 35022.78  , 2, 1),
        (2709.697  , 8125.    ,  3.7807877, 35533.742 , 2, 1),
        (2750.     , 8103.26  ,  3.7751324, 35727.203 , 2, 1),
        (2875.     , 8047.326 ,  3.7963305, 36297.71  , 2, 1),
        (2937.5    , 8022.2764,  3.7470431, 36574.035 , 2, 1),
        (2998.7302 , 8000.    ,  3.7404735, 36823.684 , 2, 1),
        (3000.     , 7999.431 ,  3.7184064, 36830.277 , 2, 1),
        (3062.5    , 7978.786 ,  3.7055447, 37123.875 , 2, 1),
        (3093.75   , 7972.582 ,  3.6036906, 37257.2   , 2, 1),
        (3112.059  , 7968.75  ,  3.601786 , 37334.098 , 2, 1),
        (3125.     , 7966.217 ,  3.6005259, 37385.312 , 2, 1),
        (3140.625  , 7964.6694,  3.5051665, 37446.508 , 2, 1),
        (3156.25   , 7963.018 ,  3.5032501, 37508.477 , 2, 1),
        (3171.875  , 7961.6426,  3.5620072, 37567.363 , 2, 1),
        (3187.5    , 7959.37  ,  3.3982596, 37676.285 , 2, 1),
        (3203.125  , 7953.85  ,  3.4009736, 37923.64  , 2, 1),
        (3205.5557 , 7953.125 ,  3.4006464, 37960.184 , 2, 1),
        (3218.75   , 7949.4136,  3.3990479, 38150.58  , 2, 1),
        (3250.     , 7942.7827,  3.453589 , 38556.527 , 2, 1),
        (3281.25   , 7937.636 ,  3.60839  , 38914.742 , 2, 1),
        (3282.212  , 7937.5   ,  3.6083763, 38924.887 , 2, 1),
        (3312.5    , 7933.544 ,  3.3178153, 39235.176 , 2, 1),
        (3375.     , 7927.682 ,  3.427484 , 39777.83  , 2, 1),
        (3437.5    , 7925.3003,  3.2190576, 40175.04  , 2, 1),
        (3500.     , 7913.6294,  3.2186823, 40493.594 , 2, 1),
        (3625.     , 7912.4023,  3.2980738, 41013.31  , 2, 1),
        (3687.5    , 7899.6323,  3.2693596, 41184.34  , 2, 1),
        (3750.     , 7891.814 ,  3.2692423, 41293.59  , 2, 1),
        (3781.25   , 7888.684 ,  3.2453935, 41329.97  , 2, 1),
        (3812.5    , 7885.8335,  3.2453277, 41354.344 , 2, 1),
        (3828.125  , 7884.7036,  3.2328875, 41362.043 , 2, 1),
        (3843.75   , 7883.1997,  3.2325552, 41366.78  , 2, 1),
        (3859.375  , 7883.1904,  3.2065158, 41368.86  , 2, 1),
        (3859.375  , 7883.1904,  3.2236557, 41368.86  , 2, 1)],
       dtype={&#39;names&#39;: [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;time&#39;, &#39;k&#39;, &#39;particleid&#39;], &#39;formats&#39;: [&#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;i4&#39;, &#39;&lt;i4&#39;], &#39;offsets&#39;: [20, 24, 28, 16, 32, 0], &#39;itemsize&#39;: 60})]
</pre></div></div>
</div>
</section>
<section id="Plot-the-heads-and-pathlines">
<h2>Plot the heads and pathlines<a class="headerlink" href="#Plot-the-heads-and-pathlines" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">mm</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">PlotMapView</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">gwf</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">hds</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mf">1e30</span><span class="p">])</span>

<span class="n">mm</span><span class="o">.</span><span class="n">plot_bc</span><span class="p">(</span><span class="s1">&#39;SFR&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">plotAll</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_bc</span><span class="p">(</span><span class="s1">&#39;WEL&#39;</span><span class="p">,</span> <span class="n">plotAll</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_ibound</span><span class="p">()</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_pathline</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">csx</span><span class="p">,</span> <span class="n">csy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#e534eb&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.75</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_33_0.png" src="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_33_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="n">mm</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">PlotMapView</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">gwf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">hds</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mf">1e30</span><span class="p">])</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_bc</span><span class="p">(</span><span class="s1">&#39;SFR&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">plotAll</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_bc</span><span class="p">(</span><span class="s1">&#39;WEL&#39;</span><span class="p">,</span> <span class="n">plotAll</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_ibound</span><span class="p">()</span>
<span class="n">mm</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">PathlineFile</span><span class="p">(</span><span class="n">ppth</span><span class="p">)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_alldata</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">recarray</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p0</span><span class="p">):</span>
    <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">recarray</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df</span><span class="p">,</span> <span class="n">dft</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">times</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">74001</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">times</span><span class="p">[</span><span class="n">ix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">times</span><span class="p">[</span><span class="n">ix</span><span class="p">])]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;magma&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="n">ix</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ix</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;particle travel time from source&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_34_0.png" src="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_34_0.png" />
</div>
</div>
</section>
<section id="Export-the-pathlines-to-a-shapefile">
<h2>Export the pathlines to a shapefile<a class="headerlink" href="#Export-the-pathlines-to-a-shapefile" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spth</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">ws</span> <span class="o">/</span> <span class="s1">&#39;pathline.shp&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">write_shapefile</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">mg</span><span class="o">=</span><span class="n">gwf</span><span class="o">.</span><span class="n">modelgrid</span><span class="p">,</span> <span class="n">one_per_particle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shpname</span><span class="o">=</span><span class="n">spth</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;names&#39;: [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;time&#39;, &#39;k&#39;, &#39;particleid&#39;], &#39;formats&#39;: [&#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;f4&#39;, &#39;&lt;i4&#39;, &#39;&lt;i4&#39;], &#39;offsets&#39;: [20, 24, 28, 16, 32, 0], &#39;itemsize&#39;: 60}
No CRS information for writing a .prj file.
Supply an valid coordinate system reference to the attached modelgrid object or .export() method.
</pre></div></div>
</div>
</section>
<section id="Load-the-shapefile-into-geopandas">
<h2>Load the shapefile into geopandas<a class="headerlink" href="#Load-the-shapefile-into-geopandas" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rshp</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">spth</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Show-the-dataframe">
<h2>Show the dataframe<a class="headerlink" href="#Show-the-dataframe" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rshp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>time</th>
      <th>k</th>
      <th>particleid</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>292.265228</td>
      <td>7053.434082</td>
      <td>24.259151</td>
      <td>1066.623169</td>
      <td>1</td>
      <td>1</td>
      <td>LINESTRING (291.667 7041.667, 292.265 7053.434)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>296.871582</td>
      <td>7187.314941</td>
      <td>18.867577</td>
      <td>9176.828125</td>
      <td>2</td>
      <td>1</td>
      <td>LINESTRING (292.265 7053.434, 296.872 7187.315)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>298.295715</td>
      <td>7250.000000</td>
      <td>17.837860</td>
      <td>11656.656250</td>
      <td>3</td>
      <td>1</td>
      <td>LINESTRING (296.872 7187.315, 298.296 7250.000)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>327.380127</td>
      <td>7500.000000</td>
      <td>17.041315</td>
      <td>17482.574219</td>
      <td>3</td>
      <td>1</td>
      <td>LINESTRING (298.296 7250.000, 327.380 7500.000)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>351.953125</td>
      <td>7750.000000</td>
      <td>14.886883</td>
      <td>21403.548828</td>
      <td>3</td>
      <td>1</td>
      <td>LINESTRING (327.380 7500.000, 351.953 7750.000)</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7326</th>
      <td>3312.500000</td>
      <td>5125.320312</td>
      <td>1.554207</td>
      <td>49924.312500</td>
      <td>3</td>
      <td>162</td>
      <td>LINESTRING (3304.377 5125.000, 3312.500 5125.320)</td>
    </tr>
    <tr>
      <th>7327</th>
      <td>3328.125000</td>
      <td>5128.071289</td>
      <td>1.580646</td>
      <td>49943.050781</td>
      <td>3</td>
      <td>162</td>
      <td>LINESTRING (3312.500 5125.320, 3328.125 5128.071)</td>
    </tr>
    <tr>
      <th>7328</th>
      <td>3343.750000</td>
      <td>5128.837891</td>
      <td>1.579881</td>
      <td>49954.789062</td>
      <td>3</td>
      <td>162</td>
      <td>LINESTRING (3328.125 5128.071, 3343.750 5128.838)</td>
    </tr>
    <tr>
      <th>7329</th>
      <td>3359.375000</td>
      <td>5131.090332</td>
      <td>1.578388</td>
      <td>49959.777344</td>
      <td>3</td>
      <td>162</td>
      <td>LINESTRING (3343.750 5128.838, 3359.375 5131.090)</td>
    </tr>
    <tr>
      <th>7330</th>
      <td>3359.375000</td>
      <td>5131.090332</td>
      <td>1.587395</td>
      <td>49959.777344</td>
      <td>3</td>
      <td>162</td>
      <td>LINESTRING (3359.375 5131.090, 3359.375 5131.090)</td>
    </tr>
  </tbody>
</table>
<p>7331 rows × 7 columns</p>
</div></div>
</div>
</section>
<section id="Plot-the-geopandas-dataframe-on-the-modelgrid">
<h2>Plot the geopandas dataframe on the modelgrid<a class="headerlink" href="#Plot-the-geopandas-dataframe-on-the-modelgrid" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">pmv</span> <span class="o">=</span> <span class="n">flopy</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">PlotMapView</span><span class="p">(</span><span class="n">gwf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_shapes</span><span class="p">(</span><span class="n">rshp</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">)</span> <span class="c1">#, edgecolor=&quot;b&quot;)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_ibound</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_42_0.png" src="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_42_0.png" />
</div>
</div>
<section id="Export-the-data-to-VTK-(Visualization-ToolKit)-format-for-a-3d-representation">
<h3>Export the data to VTK (Visualization ToolKit) format for a 3d representation<a class="headerlink" href="#Export-the-data-to-VTK-(Visualization-ToolKit)-format-for-a-3d-representation" title="Link to this heading">¶</a></h3>
<p>FloPy’s <code class="docutils literal notranslate"><span class="pre">Vtk</span></code> module allows us to create Visualization ToolKit (VTK) files that can be opened and explored with pyVISTAs or external software such as ParaView.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flopy.export.vtk</span> <span class="kn">import</span> <span class="n">Vtk</span>

<span class="n">vtk</span> <span class="o">=</span> <span class="n">Vtk</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">gwf</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vertical_exageration</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">vtk</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">gwf</span><span class="p">)</span>
<span class="n">vtk</span><span class="o">.</span><span class="n">add_pathline_points</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Write VTK file for use in ParaView or other VTK software</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pth</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">)</span>
<span class="n">pth</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">vtk</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pth</span> <span class="o">/</span> <span class="s2">&quot;freyberg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Alternatively-we-can-visualize-the-VTK-representation-using-pyvista.-To-activate-these-cells,-set-plotvtk=True">
<h3>Alternatively we can visualize the VTK representation using <code class="docutils literal notranslate"><span class="pre">pyvista</span></code>. To activate these cells, set <code class="docutils literal notranslate"><span class="pre">plotvtk=True</span></code><a class="headerlink" href="#Alternatively-we-can-visualize-the-VTK-representation-using-pyvista.-To-activate-these-cells,-set-plotvtk=True" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotvtk</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">plotvtk</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>
</pre></div>
</div>
</div>
<p>Convert the VTK to pyvista meshes and rotate the meshes to match the orientation of our matplotlib plots</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">plotvtk</span><span class="p">:</span>
    <span class="n">grid</span><span class="p">,</span> <span class="n">pathlines</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">plotvtk</span><span class="p">:</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Axes</span><span class="p">(</span><span class="n">show_actor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">actor_scale</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">grid</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pathlines</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Select particle release locations and build a dictionary of particle tracks (pathlines). This will be used below for particle labelling, as well as for animation.</p>
<p><em>Note</em>: while below we construct pathlines manually from data read from the exported VTK files, pathlines may also be read directly from the MODPATH 7 pathline output file (provided the simulation was run in pathline or combined mode, as this one was).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">plotvtk</span><span class="p">:</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">particle_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">release_locs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pathlines</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]):</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pathlines</span><span class="p">[</span><span class="s2">&quot;particleid&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])))</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">pathlines</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">pid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>
            <span class="n">tracks</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">particle_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            <span class="n">release_locs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>

        <span class="c1"># store the particle location in the corresponding track</span>
        <span class="n">tracks</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">loc</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

    <span class="n">release_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">release_locs</span><span class="p">)</span>
    <span class="n">tracks</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tracks</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">max_track_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tracks</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<p>View the grid and pathlines with PyVista, with particle tracks/locations colored by time. Also add particle ID labels to a few particles’ release locations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">plotvtk</span><span class="p">:</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">set_plot_theme</span><span class="p">(</span><span class="s2">&quot;document&quot;</span><span class="p">)</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">set_jupyter_backend</span><span class="p">(</span><span class="s2">&quot;static&quot;</span><span class="p">)</span>

    <span class="c1"># create the plot and add the grid and pathline meshes</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">pathlines</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

    <span class="c1"># add a particle ID label to each 20th particle&#39;s starting point</span>
    <span class="n">label_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">tracks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">label_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">track</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">start_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Particle </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">add_point_labels</span><span class="p">(</span>
        <span class="n">label_coords</span><span class="p">,</span>
        <span class="n">start_labels</span><span class="p">,</span>
        <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">point_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">point_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># zoom in and show the plot</span>
    <span class="n">p</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="mf">2.4</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_55_0.png" src="../../_images/notebooks_part1_flopy_10_modpath_particle_tracking-demo_55_0.png" />
</div>
</div>
<p>Create an animated GIF of the particles traveling along their pathlines, with particles colored by time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">plotvtk</span><span class="p">:</span>
    <span class="c1"># create plotter</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">off_screen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># open GIF file</span>
    <span class="n">gif_path</span> <span class="o">=</span> <span class="n">pth</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;freyberg_tracks.gif&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">open_gif</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">gif_path</span><span class="p">))</span>

    <span class="c1"># create mesh from release locations</span>
    <span class="n">spls</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">release_locs</span><span class="p">)</span>
    <span class="n">spls</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spls</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>

    <span class="c1"># add the underlying grid mesh and particle data, then zoom in</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">spls</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.23e09</span><span class="p">])</span>
    <span class="n">p</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="mf">2.4</span><span class="p">)</span>

    <span class="c1"># cycle through time steps and update particle location</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_track_len</span><span class="p">):</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">particle_ids</span><span class="p">:</span>
            <span class="n">track</span> <span class="o">=</span> <span class="n">tracks</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span>
            <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">track</span><span class="p">)</span>
            <span class="c1"># use last locn if particle has already terminated</span>
            <span class="n">loc</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">npts</span> <span class="k">else</span> <span class="n">track</span><span class="p">[</span><span class="n">npts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">npts</span><span class="p">:</span>
                <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">track</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">update_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">pts</span><span class="p">),</span> <span class="n">render</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">update_scalars</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="n">mesh</span><span class="o">=</span><span class="n">spls</span><span class="p">,</span> <span class="n">render</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">segments</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">write_frame</span><span class="p">()</span>  <span class="c1"># write frame to file</span>

    <span class="c1"># close the plotter and the GIF file</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/mnfienen/miniforge3/envs/pyclass/lib/python3.11/site-packages/pyvista/plotting/plotter.py:4722: PyVistaDeprecationWarning: This method is deprecated and will be removed in a future version of PyVista. Directly modify the points of a mesh in-place instead.
  warnings.warn(
/Users/mnfienen/miniforge3/envs/pyclass/lib/python3.11/site-packages/pyvista/plotting/plotter.py:4644: PyVistaDeprecationWarning: This method is deprecated and will be removed in a future version of PyVista. Directly modify the scalars of a mesh in-place instead.
  warnings.warn(
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">plotvtk</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">Image</span>

    <span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">gif_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;gif&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;IPython.core.display.Image object&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="09-gwt-voronoi-demo.html" class="btn btn-neutral float-left" title="09: Demonstration of MODFLOW 6 Groundwater Transport with a Voronoi Grid" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../bonus_examples.html" class="btn btn-neutral float-right" title="Bonus examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, USGS Python for Hydrology instructors.
      <span class="lastupdated">Last updated on Jul 30, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>