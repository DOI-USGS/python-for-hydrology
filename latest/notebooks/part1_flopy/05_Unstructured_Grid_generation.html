

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>05: Unstructured grid and general mesh generation with FloPy &mdash; Python for Hydrology 1.0a documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=feab032e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="06: FloPy class project: Structured grid version" href="solutions/06-Project-structured_completed.html" />
    <link rel="prev" title="04: Modelgrid and intersection" href="solutions/04_Modelgrid_and_intersection_solution.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Python for Hydrology
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Main Curriculum</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../part0.html">     Part 0: Introduction to Python</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../part1.html">Part 1: Flopy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01-Flopy-intro.html">01: Introduction to FloPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/02-Building-Post-Processing-MODFLOW6__solutions.html">02: Building and post-processing a MODFLOW 6 model</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/03_Loading_and_visualizing_models-solutions.html">03: Loading and visualizing groundwater models</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/04_Modelgrid_and_intersection_solution.html">04: Modelgrid and intersection</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">05: Unstructured grid and general mesh generation with FloPy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Creating-a-regular-structured-(rectilinear)-grid">Creating a regular structured (rectilinear) grid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Resampling-data-to-finish-creating-our-initial-grid.">Resampling data to finish creating our initial grid.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Vector-(shapefile)-intersection-review">Vector (shapefile) intersection review</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Irregular-structured-Grid-(DIS)">Irregular structured Grid (DIS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Local-Grid-Refinement-(LGR)-mesh">Local Grid Refinement (LGR) mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Activity:-Create-the-idomainp-(parent,-child)-array-from-the-polygon-provided-by-the-lgr-geodataframe">Activity: Create the <code class="docutils literal notranslate"><span class="pre">idomainp</span></code> (parent, child) array from the polygon provided by the lgr geodataframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Quadtree-Mesh">Quadtree Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Triangular-Mesh">Triangular Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Voronoi-Mesh">Voronoi Mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#plot-the-meshes-we-produced-side-by-side-for-comparison!">plot the meshes we produced side by side for comparison!</a></li>
<li class="toctree-l4"><a class="reference internal" href="#More-information">More information</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Activity-(If-time-permits);-Build-a-Voronoi-mesh/Vertex-Grid:">Activity (If time permits); Build a Voronoi mesh/Vertex Grid:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="solutions/06-Project-structured_completed.html">06: FloPy class project: Structured grid version</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/06-Project-quadtree.html">06: FloPy class project: Quadtree grid version</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/06-Project-voronoi.html">06: FloPy class project: Voronoi grid version</a></li>
<li class="toctree-l2"><a class="reference internal" href="solutions/07-stream_capture_voronoi.html">07: Evaluating stream capture with a Voronoi grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="08_Modflow-setup-demo.html">08: Modflow-setup demonstration</a></li>
<li class="toctree-l2"><a class="reference internal" href="09-gwt-voronoi-demo.html">09: Demonstration of MODFLOW 6 Groundwater Transport with a Voronoi Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="10a_prt_particle_tracking-demo.html">10a: Particle tracking with MODFLOW 6 PRT</a></li>
<li class="toctree-l2"><a class="reference internal" href="10b_modpath_particle_tracking-demo.html">10b: Particle tracking with MODPATH</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bonus Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bonus_examples.html">     General Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../SOME_HELPFUL_LINKS.html"> Additional links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html"> Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary_of_jargon.html"> Glossary of jargon</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python for Hydrology</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../part1.html">Part 1 flopy</a></li>
      <li class="breadcrumb-item active">05: Unstructured grid and general mesh generation with FloPy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/part1_flopy/05_Unstructured_Grid_generation.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="05:-Unstructured-grid-and-general-mesh-generation-with-FloPy">
<h1>05: Unstructured grid and general mesh generation with FloPy<a class="headerlink" href="#05:-Unstructured-grid-and-general-mesh-generation-with-FloPy" title="Link to this heading"></a></h1>
<p>In this notebook we’ll cover how to build Structured and Unstructured Meshes (Grids) with FloPy for use in MODFLOW models.</p>
<p>This notebook will start with generating a simple Structured Grid and we will use this grid object to begin developing Unstructured Meshes. The grids generated in theis notebook include the following:</p>
<ul class="simple">
<li><p>Regular structured grid (review)</p></li>
<li><p>Irregular structured grid with variable row and column spacings</p></li>
<li><p>Local Grid Refinement (LGR): A locally refined mesh that can be subsetted into a second model within a MODFLOW simulation</p></li>
<li><p>Quadtree Mesh: A mesh with a four fold (quad) refinement for each grid cell in a given refinement area</p></li>
<li><p>Triangular Mesh: A triangular mesh generated using Delaunay triangulation</p></li>
<li><p>Voronoi Mesh: A mesh generated from the connected centers of the Delaunay triangulation circumcircles</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">flopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextily</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ctx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataretrieval</span><span class="w"> </span><span class="kn">import</span> <span class="n">nldi</span><span class="p">,</span> <span class="n">nwis</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.discretization</span><span class="w"> </span><span class="kn">import</span> <span class="n">StructuredGrid</span><span class="p">,</span> <span class="n">VertexGrid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">PlotMapView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.utils.gridgen</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gridgen</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.utils.gridintersect</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridIntersect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.utils.lgrutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lgr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.utils.rasters</span><span class="w"> </span><span class="kn">import</span> <span class="n">Raster</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.utils.triangle</span><span class="w"> </span><span class="kn">import</span> <span class="n">Triangle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flopy.utils.voronoi</span><span class="w"> </span><span class="kn">import</span> <span class="n">VoronoiGrid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ShapelyDeprecationWarning</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">ShapelyDeprecationWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ModuleNotFoundError</span>                       Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[1]</span><span class="ansi-green-fg">, line 9</span>
<span class="ansi-green-fg">      7</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">numpy</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">np</span>
<span class="ansi-green-fg">      8</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pandas</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pd</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">9</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">contextily</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">ctx</span>
<span class="ansi-green-fg">     10</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">dataretrieval</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">import</span> nldi, nwis
<span class="ansi-green-fg">     11</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">flopy</span><span class="ansi-blue-intense-fg ansi-bold">.</span><span class="ansi-blue-intense-fg ansi-bold">discretization</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">import</span> StructuredGrid, VertexGrid

<span class="ansi-red-fg">ModuleNotFoundError</span>: No module named &#39;contextily&#39;
</pre></div></div>
</div>
<section id="Creating-a-regular-structured-(rectilinear)-grid">
<h2>Creating a regular structured (rectilinear) grid<a class="headerlink" href="#Creating-a-regular-structured-(rectilinear)-grid" title="Link to this heading"></a></h2>
<p>This activity will start by creating a simple sturctured (rectilinear) grid from a 1/3 arc second Digital Elevation Model of the Sagehen Creek watershed as an illustration of how we can create an initial mesh that can be used to develop a model from.</p>
<p>This is a quick review for more information, see the previous activity <code class="docutils literal notranslate"><span class="pre">04_Modelgrid_and_intersection.ipynb</span></code></p>
<p>Load the Digital Elevation Model and visualize it</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_ws</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./data&quot;</span><span class="p">)</span>
<span class="n">geospatial_ws</span> <span class="o">=</span> <span class="n">data_ws</span> <span class="o">/</span> <span class="s2">&quot;unstructured_grid_data&quot;</span>
<span class="n">dem</span> <span class="o">=</span> <span class="n">geospatial_ws</span> <span class="o">/</span> <span class="s2">&quot;dem.img&quot;</span>
<span class="n">rstr</span> <span class="o">=</span> <span class="n">Raster</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dem</span><span class="p">)</span>
<span class="n">rstr</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[2]</span><span class="ansi-green-fg">, line 4</span>
<span class="ansi-green-fg">      2</span> geospatial_ws = data_ws / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">unstructured_grid_data</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">      3</span> dem = geospatial_ws / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">dem.img</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">4</span> rstr = <span class="ansi-yellow-bg">Raster</span>.load(dem)
<span class="ansi-green-fg">      5</span> rstr.plot();

<span class="ansi-red-fg">NameError</span>: name &#39;Raster&#39; is not defined
</pre></div></div>
</div>
<p>Get the DEM boundaries</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">bounds</span>
<span class="n">epsg</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xmin</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">xmax</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">epsg</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[3]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> xmin, xmax, ymin, ymax = <span class="ansi-yellow-bg">rstr</span>.bounds
<span class="ansi-green-fg">      2</span> epsg = rstr.crs.to_epsg()
<span class="ansi-green-fg">      3</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>xmin<span class="ansi-bold" style="color: rgb(175,95,135)">=}</span><span class="ansi-yellow-fg">, </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>xmax<span class="ansi-bold" style="color: rgb(175,95,135)">=}</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<p>And begin developing an initial mesh for the model</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># live code modelgrid creation</span>
<span class="n">cellsize</span> <span class="o">=</span> <span class="mi">200</span>
<br/></pre></div>
</div>
</div>
<p>Finally create a fake top, bottom, and idomain for the model for now. These will be refined in a subsequent step.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># live code modelgrid creation</span>
<br/></pre></div>
</div>
</div>
<p>And now we can generate a <code class="docutils literal notranslate"><span class="pre">StructuredGrid</span></code> object (called <code class="docutils literal notranslate"><span class="pre">sgrid</span></code>) that can be used for developing model inputs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># live code modelgrid creation</span>
<br/></pre></div>
</div>
</div>
<p>We can plot our <code class="docutils literal notranslate"><span class="pre">SturcturedGrid</span></code> object over the existing raster data to check that it is correctly orientied in space</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">rstr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[7]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">6</span>, <span class="ansi-green-fg">6</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">rstr</span>.plot(ax=ax)
<span class="ansi-green-fg">      3</span> pmv = PlotMapView(modelgrid=sgrid, ax=ax)
<span class="ansi-green-fg">      4</span> pmv.plot_grid(lw=<span class="ansi-green-fg">0.5</span>);

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_14_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_14_1.png" />
</div>
</div>
<section id="Resampling-data-to-finish-creating-our-initial-grid.">
<h3>Resampling data to finish creating our initial grid.<a class="headerlink" href="#Resampling-data-to-finish-creating-our-initial-grid." title="Link to this heading"></a></h3>
<p>Once we have an initial grid, raster and vector data can be resampled or intersected with the grid to begin building a model domain. Although the focus of this notebook is to generate different types of meshes for modeling, the resampling and intersection process in this notebook can be applied many different data types and be used to generate boundary conditions within a MODFLOW model.</p>
<section id="Raster-resampling">
<h4>Raster resampling<a class="headerlink" href="#Raster-resampling" title="Link to this heading"></a></h4>
<p>We’ll use FloPy’s built in raster resampling method to generate values for land surface elevation (<code class="docutils literal notranslate"><span class="pre">top</span></code>) using the existing <code class="docutils literal notranslate"><span class="pre">StructuredGrid</span></code> object. For more information on raster resampling, please see this <a class="reference external" href="https://flopy.readthedocs.io/en/latest/Notebooks/raster_intersection_example.html">example</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">resample_to_grid</span><span class="p">(</span>
    <span class="n">sgrid</span><span class="p">,</span> <span class="n">rstr</span><span class="o">.</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">extrapolate_edges</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[8]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> top = <span class="ansi-yellow-bg">rstr</span>.resample_to_grid(
<span class="ansi-green-fg">      2</span>     sgrid, rstr.bands[<span class="ansi-green-fg">0</span>], method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">min</span><span class="ansi-yellow-fg">&#34;</span>, extrapolate_edges=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">      3</span> )

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">sgrid</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[9]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">7</span>, <span class="ansi-green-fg">7</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=sgrid)
<span class="ansi-green-fg">      3</span> pc = pmv.plot_array(top)
<span class="ansi-green-fg">      4</span> pmv.plot_grid(lw=<span class="ansi-green-fg">0.5</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_18_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_18_1.png" />
</div>
</div>
</section>
</section>
<section id="Vector-(shapefile)-intersection-review">
<h3>Vector (shapefile) intersection review<a class="headerlink" href="#Vector-(shapefile)-intersection-review" title="Link to this heading"></a></h3>
<p>We can also intersect lines, points, and polygons with an existing modelgrid object. In this example, we’ll load up the watershed boundary and get the active and inactive areas of the grid. For more information on intersecting shapefiles with a modelgrid/model see this <a class="reference external" href="https://flopy.readthedocs.io/en/latest/Notebooks/grid_intersection_example.html">example</a></p>
<p>Our first step in this process is to get the watershed boundary. We can use the <code class="docutils literal notranslate"><span class="pre">dataretrieval</span></code> package to begin downloading information about the watershed from NWIS.</p>
<p><strong>Note</strong>: this information has been stored in the repository as shapefiles if internet access is not available.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the get_info() call accepts a decimal lat/lon bounding box</span>
<span class="n">griddf</span> <span class="o">=</span> <span class="n">sgrid</span><span class="o">.</span><span class="n">geo_dataframe</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">26911</span><span class="p">)</span>
<span class="n">grid_wgs</span> <span class="o">=</span> <span class="n">griddf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>

<span class="n">wxmin</span><span class="p">,</span> <span class="n">wxmax</span><span class="p">,</span> <span class="n">wymin</span><span class="p">,</span> <span class="n">wymax</span> <span class="o">=</span> <span class="n">grid_wgs</span><span class="o">.</span><span class="n">total_bounds</span>
<span class="n">wgs_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">wxmin</span><span class="p">,</span> <span class="n">wymin</span><span class="p">,</span> <span class="n">wxmax</span><span class="p">,</span> <span class="n">wymax</span><span class="p">]</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">info</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">nwis</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">bBox</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wgs_bounds</span><span class="p">])</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geospatial_ws</span> <span class="o">/</span> <span class="s2">&quot;gage_info.shp&quot;</span><span class="p">)</span>

<span class="n">info</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[10]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># the get_info() call accepts a decimal lat/lon bounding box</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> griddf = <span class="ansi-yellow-bg">sgrid</span>.geo_dataframe.set_crs(epsg=<span class="ansi-green-fg">26911</span>)
<span class="ansi-green-fg">      3</span> grid_wgs = griddf.to_crs(epsg=<span class="ansi-green-fg">4326</span>)
<span class="ansi-green-fg">      5</span> wxmin, wxmax, wymin, wymax = grid_wgs.total_bounds

<span class="ansi-red-fg">NameError</span>: name &#39;sgrid&#39; is not defined
</pre></div></div>
</div>
<p>Reproject the gage data into UTM Zone 11 N</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[11]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> info = <span class="ansi-yellow-bg">info</span>.to_crs(epsg=epsg)

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<p>And plot the gage data on the raster</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">rstr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">info</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;site_no&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[12]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots()
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> <span class="ansi-yellow-bg">rstr</span>.plot(ax=ax)
<span class="ansi-green-fg">      4</span> info.plot(
<span class="ansi-green-fg">      5</span>     column=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">site_no</span><span class="ansi-yellow-fg">&#34;</span>,
<span class="ansi-green-fg">      6</span>     ax=ax,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">      9</span>     legend_kwds={<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">fontsize</span><span class="ansi-yellow-fg">&#34;</span>: <span class="ansi-green-fg">6</span>},
<span class="ansi-green-fg">     10</span> );

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_25_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_25_1.png" />
</div>
</div>
<p>Grab the site record for gage number 10343500</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sitedf</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">site_no</span> <span class="o">==</span> <span class="s2">&quot;10343500&quot;</span><span class="p">]</span>
<span class="n">sitedf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[13]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> sitedf = <span class="ansi-yellow-bg">info</span>.loc[info.site_no == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">10343500</span><span class="ansi-yellow-fg">&#34;</span>]
<span class="ansi-green-fg">      2</span> sitedf

<span class="ansi-red-fg">NameError</span>: name &#39;info&#39; is not defined
</pre></div></div>
</div>
<p>Get the upstream basin from nldi using the NWIS stream gage station code</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">basindf</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">get_basin</span><span class="p">(</span>
        <span class="n">feature_source</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
        <span class="n">feature_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">sitedf</span><span class="o">.</span><span class="n">site_no</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">basindf</span> <span class="o">=</span> <span class="n">basindf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
    <span class="n">basindf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geospatial_ws</span> <span class="o">/</span> <span class="s2">&quot;basin_boundary.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/pyogrio/__init__.py:7: DeprecationWarning: The &#39;shapely.geos&#39; module is deprecated, and will be removed in a future version. All attributes of &#39;shapely.geos&#39; are available directly from the top-level &#39;shapely&#39; namespace (since shapely 2.0.0).
  import shapely.geos  # noqa: F401
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">DataSourceError</span>                           Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[14]</span><span class="ansi-green-fg">, line 8</span>
<span class="ansi-green-fg">      6</span>     basindf = basindf.to_crs(epsg=epsg)
<span class="ansi-green-fg">      7</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> (<span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>, <span class="ansi-bold" style="color: rgb(215,95,95)">ConnectionError</span>, <span class="ansi-bold" style="color: rgb(215,95,95)">NameError</span>):
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">8</span>     basindf = <span class="ansi-yellow-bg">gpd</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">read_file</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">geospatial_ws</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">/</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">basin_boundary.shp</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/geopandas/io/file.py:316</span>, in <span class="ansi-cyan-fg">_read_file</span><span class="ansi-blue-fg">(filename, bbox, mask, columns, rows, engine, **kwargs)</span>
<span class="ansi-green-fg">    313</span>             filename = response.read()
<span class="ansi-green-fg">    315</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> engine == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">pyogrio</span><span class="ansi-yellow-fg">&#34;</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">316</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">_read_file_pyogrio</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    317</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">filename</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">mask</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mask</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">rows</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">rows</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span>
<span class="ansi-green-fg">    318</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    320</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> engine == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">fiona</span><span class="ansi-yellow-fg">&#34;</span>:
<span class="ansi-green-fg">    321</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> pd.api.types.is_file_like(filename):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/geopandas/io/file.py:576</span>, in <span class="ansi-cyan-fg">_read_file_pyogrio</span><span class="ansi-blue-fg">(path_or_bytes, bbox, mask, rows, **kwargs)</span>
<span class="ansi-green-fg">    567</span>     warnings.warn(
<span class="ansi-green-fg">    568</span>         <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">The </span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">include_fields</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg"> and </span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">ignore_fields</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg"> keywords are deprecated, and </span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">    569</span>         <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">will be removed in a future release. You can use the </span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">columns</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg"> keyword </span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    572</span>         stacklevel=<span class="ansi-green-fg">3</span>,
<span class="ansi-green-fg">    573</span>     )
<span class="ansi-green-fg">    574</span>     kwargs[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">columns</span><span class="ansi-yellow-fg">&#34;</span>] = kwargs.pop(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">include_fields</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">576</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">pyogrio</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">read_dataframe</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">path_or_bytes</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/pyogrio/geopandas.py:275</span>, in <span class="ansi-cyan-fg">read_dataframe</span><span class="ansi-blue-fg">(path_or_buffer, layer, encoding, columns, read_geometry, force_2d, skip_features, max_features, where, bbox, mask, fids, sql, sql_dialect, fid_as_index, use_arrow, on_invalid, arrow_to_pandas_kwargs, **kwargs)</span>
<span class="ansi-green-fg">    270</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> use_arrow:
<span class="ansi-green-fg">    271</span>     <span style="color: rgb(95,135,135)"># For arrow, datetimes are read as is.</span>
<span class="ansi-green-fg">    272</span>     <span style="color: rgb(95,135,135)"># For numpy IO, datetimes are read as string values to preserve timezone info</span>
<span class="ansi-green-fg">    273</span>     <span style="color: rgb(95,135,135)"># as numpy does not directly support timezones.</span>
<span class="ansi-green-fg">    274</span>     kwargs[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">datetime_as_string</span><span class="ansi-yellow-fg">&#34;</span>] = <span class="ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">275</span> result = <span class="ansi-yellow-bg">read_func</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    276</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">path_or_buffer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    277</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">layer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">layer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    278</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">encoding</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">encoding</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    279</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    280</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">read_geometry</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">read_geometry</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    281</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">force_2d</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">gdal_force_2d</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    282</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">skip_features</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">skip_features</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    283</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">max_features</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">max_features</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    284</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">where</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">where</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    285</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    286</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">mask</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mask</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    287</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">fids</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">fids</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    288</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">sql</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sql</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    289</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">sql_dialect</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sql_dialect</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    290</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">return_fids</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">fid_as_index</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    291</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    292</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    294</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> use_arrow:
<span class="ansi-green-fg">    295</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">import</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pyarrow</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">as</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-intense-fg ansi-bold">pa</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/pyclass-docs/lib/python3.11/site-packages/pyogrio/raw.py:198</span>, in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(path_or_buffer, layer, encoding, columns, read_geometry, force_2d, skip_features, max_features, where, bbox, mask, fids, sql, sql_dialect, return_fids, datetime_as_string, **kwargs)</span>
<span class="ansi-green-fg">     59</span> <span class="ansi-yellow-fg">&#34;&#34;&#34;Read OGR data source into numpy arrays.</span>
<span class="ansi-green-fg">     60</span>
<span class="ansi-green-fg">     61</span> <span class="ansi-yellow-fg">IMPORTANT: non-linear geometry types (e.g., MultiSurface) are converted</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    194</span>
<span class="ansi-green-fg">    195</span> <span class="ansi-yellow-fg">&#34;&#34;&#34;</span>
<span class="ansi-green-fg">    196</span> dataset_kwargs = _preprocess_options_key_value(kwargs) <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> kwargs <span class="ansi-bold" style="color: rgb(0,135,0)">else</span> {}
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">198</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">ogr_read</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    199</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">get_vsi_path_or_buffer</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">path_or_buffer</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    200</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">layer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">layer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    201</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">encoding</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">encoding</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    202</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    203</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">read_geometry</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">read_geometry</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    204</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">force_2d</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">force_2d</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    205</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">skip_features</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">skip_features</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    206</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">max_features</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">max_features</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,0,255)">or</span><span class="ansi-yellow-bg"> </span><span class="ansi-green-fg ansi-yellow-bg">0</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    207</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">where</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">where</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    208</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">bbox</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    209</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">mask</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">_mask_to_wkb</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">mask</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    210</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">fids</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">fids</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    211</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">sql</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sql</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    212</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">sql_dialect</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sql_dialect</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    213</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">return_fids</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">return_fids</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    214</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">dataset_kwargs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">dataset_kwargs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    215</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">datetime_as_string</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">datetime_as_string</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    216</span> <span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">pyogrio/_io.pyx:1293</span>, in <span class="ansi-cyan-fg">pyogrio._io.ogr_read</span><span class="ansi-blue-fg">()</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">pyogrio/_io.pyx:232</span>, in <span class="ansi-cyan-fg">pyogrio._io.ogr_open</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">DataSourceError</span>: data/unstructured_grid_data/basin_boundary.shp: No such file or directory
</pre></div></div>
</div>
<p>Plot up the basin boundary with the existing raster</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">rstr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">basindf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">info</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;site_no&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[15]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots()
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">rstr</span>.plot(ax=ax)
<span class="ansi-green-fg">      3</span> basindf.plot(ax=ax, facecolor=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">None</span><span class="ansi-yellow-fg">&#34;</span>, edgecolor=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">k</span><span class="ansi-yellow-fg">&#34;</span>, lw=<span class="ansi-green-fg">1.5</span>)
<span class="ansi-green-fg">      4</span> info.plot(
<span class="ansi-green-fg">      5</span>     column=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">site_no</span><span class="ansi-yellow-fg">&#34;</span>,
<span class="ansi-green-fg">      6</span>     ax=ax,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">      9</span>     legend_kwds={<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">fontsize</span><span class="ansi-yellow-fg">&#34;</span>: <span class="ansi-green-fg">6</span>},
<span class="ansi-green-fg">     10</span> );

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_31_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_31_1.png" />
</div>
</div>
<p>Doing the intersection</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">basindf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contains_centroid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rowcol</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[16]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> ix = <span class="ansi-yellow-bg">GridIntersect</span>(sgrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      2</span> result = ix.intersect(basindf.geometry.values[<span class="ansi-green-fg">0</span>], contains_centroid=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">      3</span> rowcol = result[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">cellids</span><span class="ansi-yellow-fg">&#34;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;GridIntersect&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rowcol</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[17]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> row, col = <span style="color: rgb(0,135,0)">list</span>(<span style="color: rgb(0,135,0)">zip</span>(*<span class="ansi-yellow-bg">rowcol</span>))

<span class="ansi-red-fg">NameError</span>: name &#39;rowcol&#39; is not defined
</pre></div></div>
</div>
<p>Building idomain from the intersection</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlay</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">idomain</span><span class="p">[:,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[18]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> idomain = np.zeros((<span class="ansi-yellow-bg">nlay</span>, nrow, ncol), dtype=<span style="color: rgb(0,135,0)">int</span>)
<span class="ansi-green-fg">      2</span> idomain[:, row, col] = <span class="ansi-green-fg">1</span>

<span class="ansi-red-fg">NameError</span>: name &#39;nlay&#39; is not defined
</pre></div></div>
</div>
<section id="Putting-it-all-together-into-a-completed-StructuredGrid">
<h4>Putting it all together into a completed <code class="docutils literal notranslate"><span class="pre">StructuredGrid</span></code><a class="headerlink" href="#Putting-it-all-together-into-a-completed-StructuredGrid" title="Link to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sgrid</span> <span class="o">=</span> <span class="n">StructuredGrid</span><span class="p">(</span>
    <span class="n">delc</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">delc</span><span class="p">,</span>
    <span class="n">delr</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">delr</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span>
    <span class="n">botm</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">botm</span><span class="p">,</span>
    <span class="n">idomain</span><span class="o">=</span><span class="n">idomain</span><span class="p">,</span>
    <span class="n">nlay</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">nlay</span><span class="p">,</span>
    <span class="n">nrow</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span>
    <span class="n">ncol</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">ncol</span><span class="p">,</span>
    <span class="n">xoff</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">xoffset</span><span class="p">,</span>
    <span class="n">yoff</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">yoffset</span><span class="p">,</span>
    <span class="n">crs</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sgrid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[19]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> sgrid = <span class="ansi-yellow-bg">StructuredGrid</span>(
<span class="ansi-green-fg">      2</span>     delc=sgrid.delc,
<span class="ansi-green-fg">      3</span>     delr=sgrid.delr,
<span class="ansi-green-fg">      4</span>     top=top,
<span class="ansi-green-fg">      5</span>     botm=sgrid.botm,
<span class="ansi-green-fg">      6</span>     idomain=idomain,
<span class="ansi-green-fg">      7</span>     nlay=sgrid.nlay,
<span class="ansi-green-fg">      8</span>     nrow=sgrid.nrow,
<span class="ansi-green-fg">      9</span>     ncol=sgrid.ncol,
<span class="ansi-green-fg">     10</span>     xoff=sgrid.xoffset,
<span class="ansi-green-fg">     11</span>     yoff=sgrid.yoffset,
<span class="ansi-green-fg">     12</span>     crs=sgrid.crs,
<span class="ansi-green-fg">     13</span> )
<span class="ansi-green-fg">     14</span> sgrid

<span class="ansi-red-fg">NameError</span>: name &#39;StructuredGrid&#39; is not defined
</pre></div></div>
</div>
<p>Plotting the completed grid with gage locations and the watershed boundary</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">sgrid</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
<span class="n">ib</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">basindf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">sitedf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;site_no&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">6</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[20]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">5</span>, <span class="ansi-green-fg">5</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=sgrid)
<span class="ansi-green-fg">      3</span> pc = pmv.plot_array(sgrid.top)
<span class="ansi-green-fg">      4</span> ib = pmv.plot_inactive()

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_40_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_40_1.png" />
</div>
</div>
<p>Because this is a watershed, we can also overlay a shapefile of the streams and get the stream cells using <code class="docutils literal notranslate"><span class="pre">GridIntersect</span></code></p>
<p>NHD-Plus stream lines can be downloaded using streamgage information with the <code class="docutils literal notranslate"><span class="pre">dataretrieval</span></code> package</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">nhddf</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">get_flowlines</span><span class="p">(</span>
        <span class="n">navigation_mode</span><span class="o">=</span><span class="s2">&quot;UT&quot;</span><span class="p">,</span>
        <span class="n">distance</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span>
        <span class="n">feature_source</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
        <span class="n">feature_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">sitedf</span><span class="o">.</span><span class="n">site_no</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">nhddf</span> <span class="o">=</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
    <span class="n">nhddf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geospatial_ws</span> <span class="o">/</span> <span class="s2">&quot;nhd_streams.shp&quot;</span><span class="p">)</span>

<span class="n">nhddf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nhdplus_co</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8933522</td>
      <td>LINESTRING (221038.59 4369598.73, 221076.943 4...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8933608</td>
      <td>LINESTRING (220451.353 4367186.202, 220542.627...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8933524</td>
      <td>LINESTRING (220541.209 4369697.393, 220691.816...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8934342</td>
      <td>LINESTRING (219823.023 4371753.116, 219905.68 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8933520</td>
      <td>LINESTRING (220240.836 4369758.678, 220245.466...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Intersect stream lines with the existing modelgrid</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rowcols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">rcs</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">geom</span><span class="p">)[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>
    <span class="n">rowcols</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rcs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[22]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> rowcols = []
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> ix = <span class="ansi-yellow-bg">GridIntersect</span>(sgrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> geom <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> nhddf.geometry.values:
<span class="ansi-green-fg">      4</span>     rcs = ix.intersects(geom)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">cellids</span><span class="ansi-yellow-fg">&#34;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;GridIntersect&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rowcols</span><span class="p">))</span>
<span class="n">strms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">))</span>
<span class="n">strms</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">strms</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[23]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> row, col = <span style="color: rgb(0,135,0)">list</span>(<span style="color: rgb(0,135,0)">zip</span>(*rowcols))
<span class="ansi-green-fg">      2</span> strms = np.zeros((nrow, ncol))
<span class="ansi-green-fg">      3</span> strms[row, col] = <span class="ansi-green-fg">1</span>

<span class="ansi-red-fg">ValueError</span>: not enough values to unpack (expected 2, got 0)
</pre></div></div>
</div>
<p>Plot the intersection results</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">strms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[24]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">5</span>, <span class="ansi-green-fg">5</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=sgrid, ax=ax)
<span class="ansi-green-fg">      3</span> pc = pmv.plot_array(sgrid.top, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">viridis</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      4</span> pmv.plot_array(strms, masked_values=[<span class="ansi-green-fg">0</span>,], alpha=<span class="ansi-green-fg">0.3</span>, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Reds_r</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_48_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_48_1.png" />
</div>
</div>
<p>Information from the grid we’ve created here can now be used for generating more complex meshes.</p>
</section>
</section>
</section>
<section id="Irregular-structured-Grid-(DIS)">
<h2>Irregular structured Grid (DIS)<a class="headerlink" href="#Irregular-structured-Grid-(DIS)" title="Link to this heading"></a></h2>
<p>In this example, an irregular structured grid is created to demonstrate how to add local refinement to an area of the model using a structured (rectilinear) grid.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lx</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span>
<span class="n">ly</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span>
<span class="n">cellsize</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">rcellsize</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">delr</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">[</span><span class="n">cellsize</span><span class="p">]</span> <span class="o">+</span> <span class="n">smooth</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">[</span><span class="n">rcellsize</span><span class="p">]</span> <span class="o">+</span> <span class="n">smooth</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">[</span><span class="n">cellsize</span><span class="p">]</span>
<span class="n">delc</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">[</span><span class="n">cellsize</span><span class="p">]</span> <span class="o">+</span> <span class="n">smooth</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">*</span> <span class="p">[</span><span class="n">rcellsize</span><span class="p">]</span> <span class="o">+</span> <span class="n">smooth</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">[</span><span class="n">cellsize</span><span class="p">]</span>
<span class="n">nlay</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">nrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">delc</span><span class="p">)</span>
<span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">delr</span><span class="p">)</span>

<span class="c1"># create some fake data for the moment</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">))</span>
<span class="n">botm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlay</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">))</span>
<span class="n">idomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">botm</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[25]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> lx = <span class="ansi-yellow-bg">xmax</span> - xmin
<span class="ansi-green-fg">      2</span> ly = ymax - ymin
<span class="ansi-green-fg">      3</span> cellsize = <span class="ansi-green-fg">200</span>

<span class="ansi-red-fg">NameError</span>: name &#39;xmax&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfgrid</span> <span class="o">=</span> <span class="n">StructuredGrid</span><span class="p">(</span>
    <span class="n">delc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delc</span><span class="p">),</span>
    <span class="n">delr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delr</span><span class="p">),</span>
    <span class="n">nlay</span><span class="o">=</span><span class="n">nlay</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span>
    <span class="n">botm</span><span class="o">=</span><span class="n">botm</span><span class="p">,</span>
    <span class="n">idomain</span><span class="o">=</span><span class="n">idomain</span><span class="p">,</span>
    <span class="n">xoff</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
    <span class="n">yoff</span><span class="o">=</span><span class="n">ymin</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nlay</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rfgrid</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span> <span class="n">rfgrid</span><span class="o">.</span><span class="n">ncol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[26]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> rfgrid = <span class="ansi-yellow-bg">StructuredGrid</span>(
<span class="ansi-green-fg">      2</span>     delc=np.array(delc),
<span class="ansi-green-fg">      3</span>     delr=np.array(delr),
<span class="ansi-green-fg">      4</span>     nlay=nlay,
<span class="ansi-green-fg">      5</span>     top=top,
<span class="ansi-green-fg">      6</span>     botm=botm,
<span class="ansi-green-fg">      7</span>     idomain=idomain,
<span class="ansi-green-fg">      8</span>     xoff=xmin,
<span class="ansi-green-fg">      9</span>     yoff=ymin
<span class="ansi-green-fg">     10</span> )
<span class="ansi-green-fg">     11</span> <span style="color: rgb(0,135,0)">print</span>(nlay, nrow, ncol)
<span class="ansi-green-fg">     12</span> <span style="color: rgb(0,135,0)">print</span>(rfgrid.nrow, rfgrid.ncol)

<span class="ansi-red-fg">NameError</span>: name &#39;StructuredGrid&#39; is not defined
</pre></div></div>
</div>
<p>Intersect the basin boundary with the grid to set active and inactive cells (idomain)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">rfgrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">basindf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contains_centroid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rowcol</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>

<span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rowcol</span><span class="p">))</span>
<span class="n">idomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlay</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">idomain</span><span class="p">[:,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># tricky way so we don&#39;t have to recreate the grid</span>
<span class="n">rfgrid</span><span class="o">.</span><span class="n">_idomain</span> <span class="o">=</span> <span class="n">idomain</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[27]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> ix = <span class="ansi-yellow-bg">GridIntersect</span>(rfgrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      2</span> result = ix.intersect(basindf.geometry.values[<span class="ansi-green-fg">0</span>], contains_centroid=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">      3</span> rowcol = result[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">cellids</span><span class="ansi-yellow-fg">&#34;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;GridIntersect&#39; is not defined
</pre></div></div>
</div>
<p>Resample the top elevation</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">resample_to_grid</span><span class="p">(</span>
    <span class="n">rfgrid</span><span class="p">,</span> <span class="n">rstr</span><span class="o">.</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">extrapolate_edges</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># tricky way so we don&#39;t have to recreate the grid</span>
<span class="n">rfgrid</span><span class="o">.</span><span class="n">_top</span> <span class="o">=</span> <span class="n">top</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[28]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> top = <span class="ansi-yellow-bg">rstr</span>.resample_to_grid(
<span class="ansi-green-fg">      2</span>     rfgrid, rstr.bands[<span class="ansi-green-fg">0</span>], method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">min</span><span class="ansi-yellow-fg">&#34;</span>, extrapolate_edges=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">      3</span> )
<span class="ansi-green-fg">      5</span> <span style="color: rgb(95,135,135)"># tricky way so we don&#39;t have to recreate the grid</span>
<span class="ansi-green-fg">      6</span> rfgrid._top = top

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<p>Now we can plot the grid</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">rfgrid</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">rfgrid</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">ib</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">basindf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">sitedf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;site_no&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab20&quot;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">6</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[29]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">5</span>, <span class="ansi-green-fg">5</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=rfgrid)
<span class="ansi-green-fg">      3</span> pc = pmv.plot_array(rfgrid.top, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">viridis</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      4</span> ib = pmv.plot_inactive()

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_58_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_58_1.png" />
</div>
</div>
</section>
<section id="Local-Grid-Refinement-(LGR)-mesh">
<h2>Local Grid Refinement (LGR) mesh<a class="headerlink" href="#Local-Grid-Refinement-(LGR)-mesh" title="Link to this heading"></a></h2>
<p>A Local Grid Refinement (LGR) mesh can be created in an area of interest to get finer discretization than the existing/surrounding mesh. FloPy’s <code class="docutils literal notranslate"><span class="pre">Lgr</span></code> utility, creates the refined mesh as a seperate modelgrid, and calculates the exchanges between the multi-model simulation mesh that results from refinement.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Lgr</span></code> utility has a number of input parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nlayp</span></code>: the number of parent model layers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nrowp</span></code>: the number of parent model rows</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ncolp</span></code>: the number of parent model columns</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delrp</span></code>: the parent model delr array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delcp</span></code>: the parent model delc array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topp</span></code>: the parent model top array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">botmp</span></code>: the parent model botm array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">idomainp</span></code>: an idomain array that is used to create the child grid. Values of 1 indicate parent model cells, values of 0 indicate child model cells. The child model must be a rectangular region that is continuous.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ncpp</span></code>: number of child cells along the face of a parent cell</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ncppl</span></code>: number of child cells per parent layer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xllp</span></code>: (optional) x location of parent grid lower left corner</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yllp</span></code>: (optional) y-location of parent grid lower left corner</p></li>
</ul>
<p><strong>Load up the refinement area polygon</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lgr_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geospatial_ws</span> <span class="o">/</span> <span class="s2">&quot;lgr_bound.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Plot it to see if it lines up properly with our model</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">strms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">lgr_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[31]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">5</span>, <span class="ansi-green-fg">5</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=sgrid, ax=ax)
<span class="ansi-green-fg">      3</span> pc = pmv.plot_array(sgrid.top, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">viridis</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      4</span> pmv.plot_array(strms, masked_values=[<span class="ansi-green-fg">0</span>,], alpha=<span class="ansi-green-fg">0.3</span>, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Reds_r</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_63_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_63_1.png" />
</div>
</div>
<p>Creating the parent/child idomainp array for <code class="docutils literal notranslate"><span class="pre">Lgr</span></code> using <code class="docutils literal notranslate"><span class="pre">GridIntersect</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lgr_gdf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>POLYGON ((221180.716 4369310.065, 219973.134 4...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Activity:-Create-the-idomainp-(parent,-child)-array-from-the-polygon-provided-by-the-lgr-geodataframe">
<h2>Activity: Create the <code class="docutils literal notranslate"><span class="pre">idomainp</span></code> (parent, child) array from the polygon provided by the lgr geodataframe<a class="headerlink" href="#Activity:-Create-the-idomainp-(parent,-child)-array-from-the-polygon-provided-by-the-lgr-geodataframe" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">idomainp</span></code> should be the same shape as the existing modelgrid’s <code class="docutils literal notranslate"><span class="pre">idomain</span></code> array. The child model extent should be represented with the value 0 and the parent 1.</p>
<p><em>Hint</em>: <code class="docutils literal notranslate"><span class="pre">GridIntersect()</span></code> can be used to find the cellids where the lgr polygon intersects with the existing modelgrid</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># live code this/give it as an activity</span>
<span class="n">idomainp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sgrid</span><span class="o">.</span><span class="n">idomain</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="n">gix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">gix</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">lgr_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">cid</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>

<span class="n">crow</span><span class="p">,</span> <span class="n">ccol</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cid</span><span class="p">))</span>
<span class="n">idomainp</span><span class="p">[:,</span> <span class="n">crow</span><span class="p">,</span> <span class="n">ccol</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[33]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># live code this/give it as an activity</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> idomainp = np.ones(<span class="ansi-yellow-bg">sgrid</span>.idomain.shape, dtype=<span style="color: rgb(0,135,0)">int</span>)
<span class="ansi-green-fg">      4</span> gix = GridIntersect(sgrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      5</span> result = gix.intersect(lgr_gdf.geometry.values[<span class="ansi-green-fg">0</span>])

<span class="ansi-red-fg">NameError</span>: name &#39;sgrid&#39; is not defined
</pre></div></div>
</div>
<p>Creating the <code class="docutils literal notranslate"><span class="pre">Lgr</span></code> object/child grid</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lgr</span> <span class="o">=</span> <span class="n">Lgr</span><span class="p">(</span>
    <span class="n">nlayp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">nlay</span><span class="p">,</span>
    <span class="n">nrowp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span>
    <span class="n">ncolp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">ncol</span><span class="p">,</span>
    <span class="n">delrp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">delr</span><span class="p">,</span>
    <span class="n">delcp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">delc</span><span class="p">,</span>
    <span class="n">topp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
    <span class="n">botmp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">botm</span><span class="p">,</span>
    <span class="n">idomainp</span><span class="o">=</span><span class="n">idomainp</span><span class="p">,</span>
    <span class="n">ncpp</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">xllp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">xoffset</span><span class="p">,</span>
    <span class="n">yllp</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">yoffset</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[34]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> lgr = <span class="ansi-yellow-bg">Lgr</span>(
<span class="ansi-green-fg">      2</span>     nlayp=sgrid.nlay,
<span class="ansi-green-fg">      3</span>     nrowp=sgrid.nrow,
<span class="ansi-green-fg">      4</span>     ncolp=sgrid.ncol,
<span class="ansi-green-fg">      5</span>     delrp=sgrid.delr,
<span class="ansi-green-fg">      6</span>     delcp=sgrid.delc,
<span class="ansi-green-fg">      7</span>     topp=sgrid.top,
<span class="ansi-green-fg">      8</span>     botmp=sgrid.botm,
<span class="ansi-green-fg">      9</span>     idomainp=idomainp,
<span class="ansi-green-fg">     10</span>     ncpp=<span class="ansi-green-fg">4</span>,
<span class="ansi-green-fg">     11</span>     xllp=sgrid.xoffset,
<span class="ansi-green-fg">     12</span>     yllp=sgrid.yoffset,
<span class="ansi-green-fg">     13</span> )

<span class="ansi-red-fg">NameError</span>: name &#39;Lgr&#39; is not defined
</pre></div></div>
</div>
<p>Get a <code class="docutils literal notranslate"><span class="pre">StructuredGrid</span></code> of the child model</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">childgrid</span> <span class="o">=</span> <span class="n">lgr</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">modelgrid</span>
<span class="n">childgrid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[35]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> childgrid = <span class="ansi-yellow-bg">lgr</span>.child.modelgrid
<span class="ansi-green-fg">      2</span> childgrid

<span class="ansi-red-fg">NameError</span>: name &#39;lgr&#39; is not defined
</pre></div></div>
</div>
<p>Resample top elevations to the child grid</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">childtop</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">resample_to_grid</span><span class="p">(</span><span class="n">childgrid</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">rstr</span><span class="o">.</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">childtop</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">childgrid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[36]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> childtop = <span class="ansi-yellow-bg">rstr</span>.resample_to_grid(childgrid, band=rstr.bands[<span class="ansi-green-fg">0</span>], method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">min</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      2</span> <span style="color: rgb(0,135,0)">print</span>(childtop.shape)
<span class="ansi-green-fg">      3</span> <span style="color: rgb(0,135,0)">print</span>(childgrid.shape)

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<p>Reset the top elevations in the <code class="docutils literal notranslate"><span class="pre">childgrid</span></code> object</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">childgrid</span><span class="o">.</span><span class="n">_top</span> <span class="o">=</span> <span class="n">childtop</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[37]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> childgrid._top = <span class="ansi-yellow-bg">childtop</span>

<span class="ansi-red-fg">NameError</span>: name &#39;childtop&#39; is not defined
</pre></div></div>
</div>
<p>Intersect streams with the Child mesh to define stream cells</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">childgrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="n">cstrmcells</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">rcs</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">geom</span><span class="p">)[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rowcol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cstrmcells</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rcs</span><span class="p">))</span>

<span class="n">cstrms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">childgrid</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span> <span class="n">childgrid</span><span class="o">.</span><span class="n">ncol</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cstrmcells</span><span class="p">))</span>
<span class="n">cstrms</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[38]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> ix = <span class="ansi-yellow-bg">GridIntersect</span>(childgrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      2</span> cstrmcells = []
<span class="ansi-green-fg">      3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> geom <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> nhddf.geometry.values:

<span class="ansi-red-fg">NameError</span>: name &#39;GridIntersect&#39; is not defined
</pre></div></div>
</div>
<p>And now we can visualize the new LGR mesh</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>

<span class="c1"># plot the parent</span>
<span class="n">pmvp</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ptop</span> <span class="o">=</span> <span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ptop</span><span class="p">[</span><span class="n">crow</span><span class="p">,</span> <span class="n">ccol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">strms</span><span class="p">[</span><span class="n">crow</span><span class="p">,</span> <span class="n">ccol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmvp</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">ptop</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">pmvp</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">strms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
<span class="n">pmvp</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
<span class="n">pmvp</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># plot the child</span>
<span class="n">pmvc</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">childgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">sgrid</span><span class="o">.</span><span class="n">extent</span><span class="p">)</span>
<span class="n">pmvc</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">childtop</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">pmvc</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">cstrms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
<span class="n">pmvc</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[39]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">10</span>, <span class="ansi-green-fg">10</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> vmin, vmax = np.min(<span class="ansi-yellow-bg">sgrid</span>.top), np.max(sgrid.top)
<span class="ansi-green-fg">      4</span> <span style="color: rgb(95,135,135)"># plot the parent</span>
<span class="ansi-green-fg">      5</span> pmvp = PlotMapView(modelgrid=sgrid, ax=ax)

<span class="ansi-red-fg">NameError</span>: name &#39;sgrid&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_79_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_79_1.png" />
</div>
</div>
</section>
<section id="Quadtree-Mesh">
<h2>Quadtree Mesh<a class="headerlink" href="#Quadtree-Mesh" title="Link to this heading"></a></h2>
<p>A quadtree mesh is an unstructured refinement to a rectilinear modelgrid. In a quadtree mesh each node is split into 4 child nodes per level of refinement. The figure below is from <a class="reference external" href="https://pubs.usgs.gov/of/2014/1109/pdf/ofr2014-1109.pdf">Lien and others, 2019</a> and shows multiple levels of recursive refinement.</p>
<p><img alt="Quadmesh.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXMAAAFjCAIAAABADnxeAAAhQ0lEQVR42u3dd1wTZwPA8SSEKQoIDlBQVKxb68BVrXXVXSuOWvesq9W6qtY966zWPftat9bV2jrr3oJbQEVRwQEie2Xc+QYUDFMSEDD8fp/+Yckd4TK+uXtyeSJ5TUSU1Um4CYgIWYgIWYgIWYiIkIWIkIWIkIWICFmIyCBk8fb2Pk15rFOnTrHh2bx6zt7mt2/fFkUx+2QRBMHe3t7IyMiY8kwymUwqlebNDZdIJHK5XL/VpfHpfe2adTV/QI5suGaTXVxcIiMjs08WtVpta2s7e/bs+5Rn6tGjR9u2bfPghk+ZMsXZ2fn69ev6rV6nTh03Nzf91r13756rq+uwYcNyZMMPHTpUsmTJ8PDw7JZl/fr1HE/mnTSP72+//TYPbviyZcs++eQT/Z5gmpo0adK3b1/91tUciXz++eca2nJkwz09PZGFkAVZkIWQBVmQBVkIWZAFWQhZskkWlSLa6/b1O3cfCmm/Nfs+WcSn97wCQ6KQBVmQBVnin/Zqxeyxw2pW+kRuYb3j7B39ZPHxOFnaJt/Gw7eRBVmQBVninwWKKN+HfmpFRN1SlutPXtVDFkX4y06tP5dIJH8cvoMsyIIsyPK22LCgucO/MbOwPOr+QA9ZNsybsHHbxiyU5eTeDWPGjBmbbqNHjz58zRNZCFly8ThLdOS5v7d/6lykxeCJusry1ONE007dF/8yUSPLqMXbMy+LqI7uUb+85H0ZmVufvfsCWQhZcqksishgj5uegij+uWRG30kLdZXlyfUzo4b/0MWtjebZ7jZiVuZlCfG94VjA+L2yVP1quDJjHwVCFkKWHJDl8cU9+SwtB09ZOHhAX0//QD2OhjTduXRQ82zfeNQz87K4H9ksyUC/Hr7POAshS+6VRVApbl/zuHjx8tOXr9JZPX1ZYmMivb29w6IVmZdl7cxRb+ywsLKpVqPWZw20+6yQhZHmIjOHSkEKNbIQsuTqcZaMlF1nygk/dvxcbmI3ZeHaoNBwlVqtOUxLTBXmV8rSTCNL4+5jMj4nArIQsuR1WYTY8Ca1q28/cSPVIRT3A7/LpXG7M3M3H8r4tSMLIUtel0WtiLpxwzON/RHx535tNawYW9l7vwhDFkIWZMmCM+WE2NDqJYtoZCnXsItKl/nhkIWQBVnS7Mn14/Gjt5Ihs1bptCKyELIgS5qtmfq9hhWpicWx20+RhZAlF8liZ2c3Y/r0eXPn6vFfqVKlatasqd+6mpydnSdNmqT3Hy8K6q/rxJ2YW6hahxjhNbIQsuSWli5damZmVqtWrdp6VahQIQ1MtfUtf/7848aN0/uPj/K7amscN0P4iNX/6roushCyZMfRkKhXvXv37tmzp6hvDRs2zMTRkLjse7e4E+SKlHsSHosshCyGM87SJ16WHBlnUUc+q2hXQCNLg07DBN2/NQhZCFmQJZVuHN1pEnckJJmybq8eqyMLIQuypLL2tIGd476DzbLwjSfByELIgixZIIuoiKhbtphGlpK12yj0+QJVZCFkySFZokODjh47dfDgmbNXbqc1kJG+LIJKcdP9/OHjZ8SsluW510VLo7gPC/X6ebF+G44shCw5I8vRjQvj5y2QNu+b5meI05FFGR3SvXn9jsMnvwiJyPJ9lp1Lpsf/abLtJ+8gCyFLild1tTo2VqFWC7lOFlEY+123MZOnb9y688GjF7ofDYkLxvdp3P2H8Jg053jLjCzftf1MA4uJQ7VnMWpkIWRJfNqqTx3a823Hr5xLOBUpUsS+mFPTtp13HzojiGIukUUREVizZGGZTGZhVXDxzkO6yqIMuudc0KpZW7cyzo5T12zJWlmUL70Km8o1svRcsEPvDUcWMjRZFFGhY3u1T2VOV5m84/il0SohN8gS/8wXXjy89U3zmhXqd47VcZwl8uFFmwKWB919hzWtbOvaMmvHWZ5fOTdjxozpM2b6vIpAFkKWt0+oWcN7pD33vMnPK7Zl545Lmt9kJqgfPX6iFsQg3+st2vVQ6iiLMuCOg5Xl5kPXlo1yc6jXRsjqo6HMhyxkULJ4nz5gYiQ1MjYuXbFa4y8aFS9incwWExtnv4jYHJclNiygVgnHBq26zJk3/4iHlx7jLKtnjWzfo2/bxq7Lth1+jSzIgiwfdIdlQq929hVcD168IcS/kRsZ5Nfis2rJcNl83Cs3HA0pYqJfvQpWpTu6nO67zmJEeFhUrCrN2wJZCFmyJFWoX/3Klc54P9H+4Uu/u5VLJtlzWb3jbG6QJSPl4Nn9yELI8jZBpXj85EmKIQvx/K75Rlqy/HH0NrIgCyFLZnt67VjBd7CYXg2IyLarRhZkIYOVxffSAcsEVxyqNY3NxhPnkAVZyEBlEcW9c75POKXFaO7GA9l55ciCLGSYsgjK6PafOr2BpfwX3V/FqJAFWQhZMtu9KwdN4lkp6Fjhsm9gNl+7RhZra+t+/foN0iuNSmXLlh2kb/b29jVq1BiUE3Xp0qV48eIhISHIQgYpiziqR/P4j+3KF+w5mf1Xr5HFzMysZs2a+k2RrVmxRvXqmZlhWyNLZ71q1qyZVCpt2LChfqu3aNHC0dExNDQUWcgAZXl07ZStWdwuy9e9x8XmxCeeM3k0lKnDQEGoX7/+2rVr9Vv92rVrxsbGR48e5WiIkCVJseEBrepWkhrJO4+ZERqtyJENRxZkIYOSRVQrJvRuptlbaTro52Tnzr187v8iOJue6siCLGRQsuxdETcrWoXGX/uHRCZ9/Cm6tGy84/IjZEEWQhZd9lZE9cktv1nnM7VwqLhg+ZrNiW3atH7tmn6d2lkXq+gXI+RxWUTNzaRWpzOhRDqyiFqraa5FTO23IAsZmizel47Y5ov/nJCJSaqTtJRo3DHbZmjJnbIIasWq+bOGDeq9cN0utaiDLBqObp4/Nn/59jf/+8DjxODvBs5fuUWVYopwZCGDkkUR8aJxpTKSdGs/YPLrvC3LtUPbPnFt+ezRDSdbq4NXfTIsi3jqz80NqpRp1TfuW+jD/L3L2Fuv+vOIazmX30/cRRYyWFlU0aH9O30peV9T1u7O1bKIYkxk2D3PW7t2btM8TTZt2nLp6vXA4FBdJ/FNR5ZVc8e5uLaKUsQ2KFd4wvxtOh0NTRzw9RtZTu1dLZFI9533aVm+VIXuI5GFDFUW8cCi4UaS97ft1P1cK4soin9vXV2jYkmpVGJsnr9SlSp2+fNp/uYCRR3Hz10Zq8skvunIcnbPGmk+h92Hzn/qZDVp8U4dZenwRpb9y8cnylLs6yHIQgYrS2TIS98MFKVU51ZZ1L/PGW1qEjdvfuES1U+7e0ZFRz+87V69gnP8l//IO4+envHz/dKRRRUbtWX9il8mjjI2Mz/gfl8/WU7sXB4ny4U4Wcp3H4EsZMjjLLmtjMsiCqrts0eaxH8zoabF+95NfHflwCbTtz+W9J+/Scy0LJpdo6c+NzrUrTLop3m6jeAK6h+/adq85xjNoVnIo5slChdYufVQvXKlVx65jSyELLlRltBn90pZm76brPfKw8SLFIF3SxayePvtA9aVg5RiJmW5637yh9Hj/znrrhLS/FWpynJ017ruXTp2+rb7rhOX4vg490/XXj2nLVqj5r0hQpbcKYv3mb3ag0G/bD72bk8hOrCMY6GEL02Se4YpMymLIKjfOx6cwTPl1CqVwPkshCy5Vpbr/6zXluWTzzspE3YExKgXpR3tEmQp6BulzqQsGYlzcAlZDEGWB1cOab+xJZWZzFq7740tQT7uRSzffunjJ80GKDI20IIshCzI8loZHtiykmPSb4u1+Kr30Psvgrf+OunNTxyr1b39NDiDV40shCzIEpfX8c22ZvJkZ984lK5cumjcVw/YOZS+ct8/41eNLIQsyPJmQEW9ecFU09TO7ivoVOrCncc6XTWyELIgS4ItonBw02L7ghYpcXFt0zn5jBAZkOW3334L1aszZ87I5fJ9+/bpt/rly5eRhZAlt8iiscXzyomGlQqn+rmEJgPGKtWiTrIUKFDAvmhRPf7TPEnj9pVsbPRb3c7OzsHBITg4GFkIWXL+aGjHqlm2+eN2WOp82eWnQT1MZUlkkRqb/LT+gE6yfPPNN4v1asyYMTKZbMiQIfqtPn78eGbYJmTJeVlUsREzv2tr/OYsfiOr03efaY6MPI5sLGNvmfQNo0I3AyIzLgvjLIQseVoWz/92GyfwYVPry5DYt6fDndy8LOnbRdL1+y8gC7IQsmRIluXThifi0bj7NFXCKfOCMqbrl7W0aVm4429kQRZClgzJMq1vi0Q7vhqxWnuuhEt//aF9eu6vO/9FFmQhZMmQLPNGdk+0o82IFdqyBNw+UyhxSl+p0V53P2RBluSJoqhUKnWdeRBZDF6WYztWJszBInFq0DFc8e5jh088jlsl7LSUqNsxNBOzKIiCOuip75JpE896PdQ8FJ/73ps+eoR7akPCqcqiiI489tf2havipqETVTF71vza0c1t+qJ1SmZRyMkEtfeNy8P7dC1bqvSNl1HIgixJnhcx4WO6NZe91cVk9d/nEiwQ5o/q+1accp/dfBGW0YdbarIEB/ht/32hhUSy7YyHKipoxfzJconkgO+rjMkiXDiwp0XtSm/mlLt58q/xM5ZMHt5DJjE++CAQWXKmR14eA7p+ld/C7M1DxCMgAlmQJVnKqFf9OjR9+/ZQkbJ7jl8MDXn1x9IZ5vHzV1o7uVzw9Mv4Vad5NKQOKCmVamSJO87yvmKtgyxxJc5WqYrb9X798v5VayPLc/7ByJKtKWOj3c8dH9G/h7Vlku++QRZkSTVFdMT6pfO+av1liWL2tnaF7B3sCxWyb9S81aQ5C739A3U6hP7Qsrw9iNu1qnXfcRwNZeuIiq+nx9fNP0v1NG1kQZb3HTqrIyLCw8LDFSqVngffH14WMTa8c5smDwJDX/j7IUs2sfLfhtmudeoOGPJD/56dbfLJkQVZsrk0ZYnxKyyVbDtzVfNP/zsXLOJkCc6wLOK4Xq1a9ZsYPzAUNrnbl2Vrf/Zd3+6jl+xBlmxKrVKq1PHD+6K4Y8EUZEGW3CBLZHDgnxtW9O/ff+5vG0Mjw7atWar595xlG18ERWZElhvnj44fOXzE2Annb92/duJg/4RO+AYhSw50/8hmZEGW3LLPkrE4n+Uj6NGpbciCLMiCLMiCLMiCLMiCLMiCLMiCLMiCLMiCLMiCLMiCLMiCLMiCLHlHFlNT08J5L0tLS5lMZmNjUzAnMjEx0fwB+q1rZWWl+csLFCig9+rMsI0s2SFLu3btHuW9pk+frnnpPn/+/PWcyMPDQ7ProffqV65c0XvdvXv3ss+CLBwNGeDRUM7G0RCyIAuyIAuyIAuyIAuyIAuyIAuyIAuyIAuyfMyynHocgizIgizIkql8jmxJJst+r0BkQRZkQZZM9e//FieTZevZe8iCLMiCLJlIUPRp3TCZLJ1HzUYWZEEWZNG5yGc+SxfOGzt8WMOaVY2l0mSyyEzN6jZrPWHy1C37DyELsiALsmQ0ZeSrC2dPv7dbdx8gC7IgC7IQsiALshCyIAuyELIgC7IgCyELsiALIQuyIAshC7IgC7IQsiALshCyIAuyELIgC7IgCyELsiALIQuyIAshC7IgC7IQsiALshCyIAuyELIgC7IgC7J8wNQqxQOvm3d9/d6/qCgqYqIe+tw7e/bMmbPnPe/eD4uKEcWPVRZRFP197125dVePTRBF4Yb7pdOnT7vfvosshCxJUkaF/71ry5f1a5nIJAOmL0h/4eiQwBkTfixbuoRM9m6iv6JOZYaOmxkarfi4ZFHGRJ079k//rm5WFiYVO/ZR6U7LpQObLIyNNLdAtc6DkYWQJeElV1Af2rmmikuxRCYGpitLbFhA+8aukjRyGzkly/dcPpAsmv2UR7cvNKlX1ShhwyvpLosqKsi1tMOb1T9FFkIWTcEBTzevXdqkbo1kMwynI0uQ//0WrmUlaSeTWyzce1bM3bJER4T8vfOP9q0aWxgZaf/xusqijAge2K5u4urIQnldFlGtOrhpZdkSRVPVIR1ZJvT4SrOAVZHiPfoPnjzxp4Y1qqRc3b5qo8BYde6URVQr/9qwpEYF51Q3XFdZti0cK9NaHVkor8uijgmbOmH01t37r111nzWyv1HGZHnqdd7GOn+fn2b6+AeI8c9ARXTkkskjzWVJd3qsnG8+Cc2dsmg2fOK40Rs277h85fKG36YXtTDVW5aAe1cdbQtIkIWQJfWXcWVY5UIFMiCLuGBs32kbdqUYplEtn9RH+6VbYu180y+XypKs8d3b6ieLKupVm5qVJElFRRZCliSPphblC2ZknyUiNEwpCCl/HvngvF1+k8TVi5Rv9CJa9VHIsmxMN31kEZQzBnwtkcgbNaqLLIQsmZUlrRR+HoWszN6sKzU2n7Tlv1w+gpspWUTxwMZF5nJp7a96bpo7ElkIWT6MLKLw95IJxtK3rvwwc32Wny6Xq2R5fOdicStzu0r1HrwI371oNLIQsnwQWUL871Yoahm3mpGk/dgZCrXw2pBlEfq1qGVm7XDS+7nmf5CFkOUDyCKKQf6+nRrXS1zRoVTF/ScvGeo+i6COXTtpqFwun7B855ulkIWQJWtlEfauW9a1Q2u7ApbJTgkxymf9w2+bolSCockiiruXzTQxkjR0GxyTsF+GLIQsWSzLuB4tTdM6D9dIvnL3KQOTJerlo5K25hIbpxt+rxJ/iCyELFl9NCSK4S+frl06r7SDXUpbKjT/ViWIBiOLqFaM7t7GxKbwpiPXtC9HFkKWDzDOEt8rP58fv20ilyWlxazok/BYw5BFUMUsH9tLLpfPWLcn2WXJZKnWBVkIWbJIljfPvcHtaifbbbnyPMwwZPE8s99IJpWb2AwdMTJZ7RrV1F698CdVR44aNfbnSUGxArIQsmRWFk3P73oUtzAxSFmuH9kq0SUza9tHkSpkIWTJAllEUdyzaKzW77B5EBqDLMhCyJIpWTSFPPRwsnj7Eb0C5evEZN0bzzktyxZdZfFFFkKWlLIMmDZfj98iRARUKlXkzW9oP2hiFs4sl32ydOid8i2t0IDHf6bR0B7ttFcvUb+F5od79v8VoWKchZAlhSxtRs5MTQ713k3Lvhvy/ZaDF1SpqaEK9a/gZBO3vkn+A5ezcq7pbJPFvEEnhVoHEXnXmZAlnTGSmHoO1trPkJYjpqdYRti6aKRZ/AxPUiOTToPHhkYlm0lb9Dq+rYBcIpEZd520PFYtfhSyzB7QUXvDjeu56fS5J2QhZEmz0GfeBfMlOZ+2crNu6qQHM6Ja2atNkndYqzdocfjibWXC89Dn6n/ViltLjEyGjf9NkdWfSfxQsqgV7RtVSzobnsuDV1HIgizIktliIoJ/6tYhxen5Jsv+PplkwEEU9y0ak2wpuYlF03ZdV2/YMG/SaPuCBTSr9Zu4QClk/XcOfQhZFFFh68Z/b5psnk2JpP3wSVFKNbIgC7Lol7ByxsiWzZuVcXJyLJ5Kjo6O1V3rtm3b4Xbo27c5BGX0yjmTShQtbJT02Whqnq+Yc5luA74/dvmmWvggX2WWpbIISyYNa9u6VaWyLo5pbHnlqtXbtm2356T7e3/Xv+vnaK/aeugEZCH2WfQpOiLM89aN06dO/Kvp4MFTZ876+D5RqNQf9Er59lVkIQOXJUdCFmQhZEEWZCFkQRZkQRZkQRZkQRZCFmRBFkIWZEEWZEEWZEEWZCFkQRZkIWRBFmQhZEEWZEEWQhZkQRZCFmRBFkIWZEEWZCFkQRZkIWRBFmQhZEEWZEEWQhZkQRZCFmRBFkIWZEEWZCFkQRZkIWRBFmQhZEEWZEEWQhZkQRZCFmRBFkIWZEEWZEEWZEEWZCFkQRZkIWRBlrwui0ql0shibGxsRnkmo/jM816ax7lUKs2DG6650+3t7YODg7N7n6VXr17rKM/UuHHjqlWrzsl7zZ49e/r06Xlww0eOHOnk5BQWFsbREHE0RIyzELIQsiALsiALsiALIQshCyELIQuyIAshC7IQshCyELIQshCyELIgCyELIQshCyELIQshC7IQshCyELIQshCyELIgCyELIQshCyELIQshC7IQshCyELIQshCyELIgCyELsiALIQshCyELIQuyIAuyIAuyELIQshCyELIgC7IQsiALIQshCyELIQshCyELshCyELIQshCyELIQsiALIQshCyELIQshCyELshCyELIQshCyELIQsiALIQuyIAshCyELIQshC7IQsiALshCyELIQshCyIAuyELIgCyELIQshCyELsiALIQuyELIQshCyELIQshCyIAshCyELIQshCyELIQuyELIQshCyELIQshCyIAshCyELIQshCyELIQuyELIgC7IQshCyELIQsiALIQuyIAshCyELIQshS56RRbx54cSaTbti1GL6ywmCoHpfIrJ8DL14dHf10qWPgyP1e8DERITedL+8f8+uVSuW7zp8AlmQJemmKWJOHdrXt3P7/OamjnW+CFYI6S+/YcHPJdOvfI0H4Qpkyb2vIaLw8M7VqeNGFLe1kkgkJ3ye6rS6IiJ4z6Z1Hdu0KFncwdzMrFSFT4eO+um/K7eQBVnePrx8bl+dN/HHcqUcJAk5vU8WISa4QTknSbq5TVwtiiKy5MK7PCo85PDurc3qV5XJpIn3V8ZlCXh8b2jfb/NbmGnWsrAu0uW7EaeveaoFQTSUWwhZMlt40NNfJo3Kb2GaDIX3yuL93/b8cmk6rMit7N2fBDHOktsS1Mq/tqytWq5UyrssQ7KIgtf5f8qXKPJmFdviZY6732OcBVm0HyGqX0b0KePsWKlqVUtzE51kEdWKid0apb/D4tqut8JQXsMMRRbx3ql9rRq6upSv6OJcTA9ZNLu3mxbPKpTwOlTIseZJDx+DHHhClkztEt+4dTNKodL80+/mGWcby4zL8sL7op2J5oFVtlva7Tl9zWAeZwazzxIa+OTOgydxh6iC6rdx3+kmiyj8sXBq4sIlqje8Hxjy2kBDlqxSRjG0foWMy7Jl6RTNMoOmrnidNzLIEdwH/+2R6SLL/fO7CpvL3y4qk288eMmA73FkybKj72luVTIsi9izaU2JPN/+S16aW8MwxmjzoCyBHgeMpBmVJcTfu1apIolLOtdsHa0WkQVZslKWV14nrORGmmWKOBSvUu3TBo2bDhw24vctu7zuP1GpBWQxRFnE8b2/0l5y6tr9hv1agizZL4u47McOqQ7ZmlrYtOk24MGzV8hiYLKoI54VMTXSWjD/pcdBgkoVEvQyICAwVqlCFmTJrCzRL32rFbNO5y2hgsVL/bxoXUhULLIYjCwnd6zQWkpqUbzSwN7dHe3t8lnEVdDOvnmbLjv/PaMynNNZkCXbZbn01/9kkvf35beDYwzoyCiPyzK2b/uUd7GRLMkDQWZi2m/+7zEqAVmQRXdZRHHKgE4ZgEUilcmmrNgpIosByKKO/KJCcW1DWvQccuLcJa9b1+aM/M5c6xReidx08qqdyIIsOssiCup9OzatWrVq+bJlc2fPGDSwT+PP6hayLSiXpXIyrpmN/eGbfsjyscsS/eSKg432Kdr5dp25m/hKM3NEzyRjbXal/SOUyIIsOh8NpdyLiQp9uW/TqjKO9qmchtv1J4HPDX3ksvie3G2tfdxjZP33pUeJl/qc25dsb3XtPxeRBVkyLUsCMMEv/NYsmulc1C7Jo8zK5XmMGlk+alm8Dm1Jcna2eZFTnoGJl0YFPXbKL9e+fPDMtciCLFkly9tePfSqWTLJB1IuPItEFgOWRVRFN6zsrH15+4ETkAVZslgWTRcObbcwfrf3fORRKLJ81LI8PrfXWnunxNj2n2taw2eiqlu9ytq/pFmfIciCLFkvi6iKGeFWN/GUqvsGMZ6Xl2WJfX6nmG0+7VHa9f9d177Dh7Surv1Lug6diSzIkvWyaHp2fLNp/GPWpdUANSO4H7ksr0Vlp88qaS82YPl+rTtV/P7rutqX/rhoM7IgS5qyOLo2Co7VU5Yo7+NmxkYSicmyIzcM49bJI7Icv5f6mXLLJw7WXqxR13HKdy8Y4uA21bVPZPrz9F1kQZZ3mzW1fRJZ5OXq+Kc2ha3PtVMdWzetXqNmm07dtvxzXCWkos+NfcuMZdKKX7iFxKqQJffK4p5cls2XH6S65Is75yy0TlmyKFknIDLxsSEMavnpuw8UFS3/MlaNLMiSuFVRnaq4JHnDuESNRyExKXaM1X2a1NZerLlb3yveT7RPWgnyvVWrTJH8tsXPefobzM1jkLJcO7At2QmOv5/yTH1RUZw2+BvtJTceezvUIigi65ZLPENXPnXVbsO4cZAla3r5+JZDQfOkHwux/Nc9xSuYqOpWu2qy0+HMCxSasmSdIv5TQmGB/i0/rSCR5Fu1+6Ah3T4GKcvy2SOT3ZWjFvyR1sIRL31bVSmcuGTrgePePnJ8rlonTIf8xTeDwg1lLxVZMpXfg7se7ld2b93Utm7NlGfQlqxR739bd7l7eDx+nnj+gnhiz1r7pPNaxu3gSKX2JUvXdq1Z2K5go1ZfH3H3FgxrOiiDkUUVE3Hzqsexf/6aNXFMsfz5kt2PFoWLzV6y8uzFy3fupTwsEiMCfAZ2bik3ijulwMjYYtKC5aeP/9v6C9e4d6JN8/UYMTkkWmkw9ziyZCbx2J7/TclARy8mGYgNefpoza9zurRv/WmVKi4uLmXKuFSoWKlFO7efZ849635bbYhTzBmMLDHBfotmvf8eX7Ntb+qPGEF97tiBUUMG1KleTXPXu5T9xLVew5/nLLpx18/AphZElpyESa1SRmmKjIpVKAx7ykq+fTXFs0AVd9dHR6sFw5xFEFkIWQhZCFkIWZCFkAVZkIWQhZCFkIWQBVmQhdsBWZCFkIWQhZCFkAVZkIWQBVkIWQhZCFkIWQhZCFmQhZCFkIWQhZCFkIWQBVkIWQhZCFkIWQhZCFmQhZCFkIWQhZCFkIWQBVkIWZAFWQhZCFkIWQhZkIWQBVmQhZCFkIWQhZAFWZCFkAVZCFkIWQhZCFmQBVkIWZCFkIWQhZCFkIWQhZAFWQhZCFkIWQhZCFkIWZCFkIWQhZCFkIWQhZAFWQhZCFkIWQhZCFkIWZCFkAVZkIWQhZCFkIWQBVkIWZAFWQhZCFkIWQhZkAVZCFmQhZCFkIWQhZAFWZCFkAVZCFkIWQhZCFkIWQhZkIWQhZCFkIWQhZCFkAVZCFkIWQhZCFkIWQhZkIWQhZCFkIWQhZCFkAVZCFmQBVkIWQhZCFkIWZCFkAVZskmWJk2afE95pipVqpQtW5bbIe/UvXv37JZFFMXx48d3pbxUp06dOnTowO2Qp5owYYJSqcw+WYiIkIWIkIWIkIWICFmICFmICFmIiJCFiJCFiJCFiJCFiCjL+j/g69xcEyj9XQAAAABJRU5ErkJggg==" /></p>
<p>For this example, we will be using GRIDGEN and the FloPy utility <code class="docutils literal notranslate"><span class="pre">Gridgen</span></code> to create quadtree refinement around the streams in our example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gridgen_dir</span> <span class="o">=</span> <span class="n">data_ws</span> <span class="o">/</span> <span class="s2">&quot;sagehen_gridgen&quot;</span>
<span class="n">gridgen_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Gridgen</span></code> class a number of input parameters and further documentation/examples of the class can be found <a class="reference external" href="https://flopy.readthedocs.io/en/latest/Notebooks/gridgen_example.html">here</a>. For our example, we will be refining the area around the stream channels.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">Gridgen</span><span class="p">(</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">model_ws</span><span class="o">=</span><span class="n">gridgen_dir</span><span class="p">)</span>
<span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">geom</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">xy</span><span class="p">))</span>
    <span class="n">g</span><span class="o">.</span><span class="n">add_refinement_features</span><span class="p">([</span><span class="n">xy</span><span class="p">,],</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[41]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> g = <span class="ansi-yellow-bg">Gridgen</span>(sgrid, model_ws=gridgen_dir)
<span class="ansi-green-fg">      2</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> geom <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> nhddf.geometry.values:
<span class="ansi-green-fg">      3</span>     xy = <span style="color: rgb(0,135,0)">list</span>(<span style="color: rgb(0,135,0)">zip</span>(*geom.coords.xy))

<span class="ansi-red-fg">NameError</span>: name &#39;Gridgen&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[42]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">g</span>.build()

<span class="ansi-red-fg">NameError</span>: name &#39;g&#39; is not defined
</pre></div></div>
</div>
<p>After gridgen builds the mesh, it can be used to create a <code class="docutils literal notranslate"><span class="pre">VertexGrid</span></code> (or DISV) that represents the basin</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gridprops</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_gridprops_disv</span><span class="p">()</span>
<span class="n">gridprops</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;nvert&quot;</span><span class="p">)</span>

<span class="n">quadgrid</span> <span class="o">=</span> <span class="n">VertexGrid</span><span class="p">(</span><span class="o">**</span><span class="n">gridprops</span><span class="p">)</span>
<span class="n">quadgrid</span><span class="o">.</span><span class="n">extent</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[43]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> gridprops = <span class="ansi-yellow-bg">g</span>.get_gridprops_disv()
<span class="ansi-green-fg">      2</span> gridprops.pop(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">nvert</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      4</span> quadgrid = VertexGrid(**gridprops)

<span class="ansi-red-fg">NameError</span>: name &#39;g&#39; is not defined
</pre></div></div>
</div>
<p>Resample top elevations to the quadtree mesh and intersect the basin boundary and stream vectors</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the top array</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">resample_to_grid</span><span class="p">(</span><span class="n">quadgrid</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">rstr</span><span class="o">.</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">)</span>
<span class="n">quadgrid</span><span class="o">.</span><span class="n">_top</span> <span class="o">=</span> <span class="n">top</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[44]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># create the top array</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> top = <span class="ansi-yellow-bg">rstr</span>.resample_to_grid(quadgrid, band=rstr.bands[<span class="ansi-green-fg">0</span>], method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">min</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      3</span> quadgrid._top = top

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the idomain array</span>
<span class="n">idomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">quadgrid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">quadgrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">basindf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contains_centroid</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>

<span class="n">idomain</span><span class="p">[:,</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">quadgrid</span><span class="o">.</span><span class="n">_idomain</span> <span class="o">=</span> <span class="n">idomain</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[45]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># create the idomain array</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> idomain = np.zeros(<span class="ansi-yellow-bg">quadgrid</span>.shape, dtype=<span style="color: rgb(0,135,0)">int</span>)
<span class="ansi-green-fg">      3</span> ix = GridIntersect(quadgrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      4</span> nodes = ix.intersect(basindf.geometry.values[<span class="ansi-green-fg">0</span>], contains_centroid=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">cellids</span><span class="ansi-yellow-fg">&#34;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;quadgrid&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an array of stream cells</span>
<span class="n">qstr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">quadgrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">geom</span><span class="p">)[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>
    <span class="n">qstr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[46]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(95,135,135)"># create an array of stream cells</span>
<span class="ansi-green-fg">      2</span> qstr = []
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> ix = <span class="ansi-yellow-bg">GridIntersect</span>(quadgrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      4</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> geom <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> nhddf.geometry.values:
<span class="ansi-green-fg">      5</span>     nodes = ix.intersects(geom)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">cellids</span><span class="ansi-yellow-fg">&#34;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;GridIntersect&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qstrms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">quadgrid</span><span class="o">.</span><span class="n">ncpl</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">qstrms</span><span class="p">[</span><span class="n">qstr</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[47]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> qstrms = np.zeros((<span class="ansi-yellow-bg">quadgrid</span>.ncpl,), dtype=<span style="color: rgb(0,135,0)">int</span>)
<span class="ansi-green-fg">      2</span> qstrms[qstr] = <span class="ansi-green-fg">1</span>

<span class="ansi-red-fg">NameError</span>: name &#39;quadgrid&#39; is not defined
</pre></div></div>
</div>
<p>Plot the quadtree mesh with top elevations and streams</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">quadgrid</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">quadgrid</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">qstrms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[48]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">5</span>, <span class="ansi-green-fg">5</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=quadgrid)
<span class="ansi-green-fg">      4</span> pc = pmv.plot_array(quadgrid.top)
<span class="ansi-green-fg">      5</span> pmv.plot_array(qstrms, masked_values=[<span class="ansi-green-fg">0</span>,], alpha=<span class="ansi-green-fg">0.3</span>, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Reds_r</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_93_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_93_1.png" />
</div>
</div>
</section>
<section id="Triangular-Mesh">
<h2>Triangular Mesh<a class="headerlink" href="#Triangular-Mesh" title="Link to this heading"></a></h2>
<p>An unstructured/vertex based triangular mesh can be generated using the code “triangle”(<a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0925772101000475">Shewchuk, 2002</a>). And the FloPy utility, <code class="docutils literal notranslate"><span class="pre">Triangle</span></code> that creates inputs for and translates the outputs from “triangle”.</p>
<p>For this example, we will be using triangle to generate a mesh and add refinement around the streams.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tri_dir</span> <span class="o">=</span> <span class="n">data_ws</span> <span class="o">/</span> <span class="s2">&quot;sagehen_tri&quot;</span>
<span class="n">tri_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For this example, we will use the watershed boundary we downloaded from NLDI and create a dissovled polygon of stream segments to generate our triangulation regions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basindf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[50]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">basindf</span>.head()

<span class="ansi-red-fg">NameError</span>: name &#39;basindf&#39; is not defined
</pre></div></div>
</div>
<p>We will also dissolve and buffer the stream network into a single polygon that defines our area of refinement</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bufgdf</span> <span class="o">=</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
<span class="n">bufgdf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bufgdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">cap_style</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">join_style</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">bufgdf</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_99_0.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_99_0.png" />
</div>
</div>
<p>These two polygons can now be used to generate a triangular mesh with the <code class="docutils literal notranslate"><span class="pre">Triangle</span></code> utility. The <code class="docutils literal notranslate"><span class="pre">Triangle</span></code> class has a number of input parameters. For more detail on the inputs and additional examples please see this <a class="reference external" href="https://flopy.readthedocs.io/en/latest/Notebooks/dis_voronoi_example.html">notebook</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define point locations within the watershed and the stream for adding regions</span>
<span class="n">wsloc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">220000</span><span class="p">,</span> <span class="mi">4368000</span><span class="p">)</span>
<span class="n">stloc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">219250</span><span class="p">,</span> <span class="mi">4370000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tri</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">model_ws</span><span class="o">=</span><span class="n">tri_dir</span><span class="p">)</span>

<span class="c1"># define the model/mesh boundary</span>
<span class="n">tri</span><span class="o">.</span><span class="n">add_polygon</span><span class="p">(</span><span class="n">basindf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tri</span><span class="o">.</span><span class="n">add_region</span><span class="p">(</span><span class="n">wsloc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maximum_area</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="mi">300</span><span class="p">)</span>

<span class="c1"># define the stream refinement area</span>
<span class="n">tri</span><span class="o">.</span><span class="n">add_polygon</span><span class="p">(</span><span class="n">bufgdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tri</span><span class="o">.</span><span class="n">add_region</span><span class="p">(</span><span class="n">stloc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maximum_area</span><span class="o">=</span><span class="mi">40</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[53]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> tri = <span class="ansi-yellow-bg">Triangle</span>(angle=<span class="ansi-green-fg">30</span>, model_ws=tri_dir)
<span class="ansi-green-fg">      3</span> <span style="color: rgb(95,135,135)"># define the model/mesh boundary</span>
<span class="ansi-green-fg">      4</span> tri.add_polygon(basindf.geometry.values[<span class="ansi-green-fg">0</span>])

<span class="ansi-red-fg">NameError</span>: name &#39;Triangle&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tri</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[54]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">tri</span>.build()

<span class="ansi-red-fg">NameError</span>: name &#39;tri&#39; is not defined
</pre></div></div>
</div>
<p>Visualize the triangular mesh</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">tri</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[55]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">6</span>, <span class="ansi-green-fg">6</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> <span class="ansi-yellow-bg">tri</span>.plot(ax=ax)
<span class="ansi-green-fg">      3</span> nhddf.plot(ax=ax);

<span class="ansi-red-fg">NameError</span>: name &#39;tri&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_105_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_105_1.png" />
</div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">VertexGrid</span></code> from the triangular mesh and resample the land surface elevations</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cell2d</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">get_cell2d</span><span class="p">()</span>
<span class="n">vertices</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">get_vertices</span><span class="p">()</span>
<span class="n">ncpl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell2d</span><span class="p">)</span>
<span class="n">nlay</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">idomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nlay</span><span class="p">,</span> <span class="n">ncpl</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># set fake values for top and botm for now)</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ncpl</span><span class="p">,))</span>
<span class="n">botm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlay</span><span class="p">,</span> <span class="n">ncpl</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[56]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> cell2d = <span class="ansi-yellow-bg">tri</span>.get_cell2d()
<span class="ansi-green-fg">      2</span> vertices = tri.get_vertices()
<span class="ansi-green-fg">      3</span> ncpl = <span style="color: rgb(0,135,0)">len</span>(cell2d)

<span class="ansi-red-fg">NameError</span>: name &#39;tri&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trigrid</span> <span class="o">=</span> <span class="n">VertexGrid</span><span class="p">(</span>
    <span class="n">vertices</span><span class="o">=</span><span class="n">vertices</span><span class="p">,</span>
    <span class="n">cell2d</span><span class="o">=</span><span class="n">cell2d</span><span class="p">,</span>
    <span class="n">ncpl</span><span class="o">=</span><span class="n">ncpl</span><span class="p">,</span>
    <span class="n">nlay</span><span class="o">=</span><span class="n">nlay</span><span class="p">,</span>
    <span class="n">idomain</span><span class="o">=</span><span class="n">idomain</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span>
    <span class="n">botm</span><span class="o">=</span><span class="n">botm</span><span class="p">,</span>
    <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:26911&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">trigrid</span><span class="o">.</span><span class="n">extent</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[57]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> trigrid = <span class="ansi-yellow-bg">VertexGrid</span>(
<span class="ansi-green-fg">      2</span>     vertices=vertices,
<span class="ansi-green-fg">      3</span>     cell2d=cell2d,
<span class="ansi-green-fg">      4</span>     ncpl=ncpl,
<span class="ansi-green-fg">      5</span>     nlay=nlay,
<span class="ansi-green-fg">      6</span>     idomain=idomain,
<span class="ansi-green-fg">      7</span>     top=top,
<span class="ansi-green-fg">      8</span>     botm=botm,
<span class="ansi-green-fg">      9</span>     crs=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">EPSG:26911</span><span class="ansi-yellow-fg">&#34;</span>,
<span class="ansi-green-fg">     10</span> )
<span class="ansi-green-fg">     11</span> trigrid.extent

<span class="ansi-red-fg">NameError</span>: name &#39;VertexGrid&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">resample_to_grid</span><span class="p">(</span>
    <span class="n">trigrid</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">rstr</span><span class="o">.</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">extrapolate_edges</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">trigrid</span><span class="o">.</span><span class="n">_top</span> <span class="o">=</span> <span class="n">top</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[58]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> top = <span class="ansi-yellow-bg">rstr</span>.resample_to_grid(
<span class="ansi-green-fg">      2</span>     trigrid, band=rstr.bands[<span class="ansi-green-fg">0</span>], method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">min</span><span class="ansi-yellow-fg">&#34;</span>, extrapolate_edges=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">      3</span> )
<span class="ansi-green-fg">      4</span> trigrid._top = top

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<p>And perform intersection to identify stream cells</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tristr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">trigrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">geom</span><span class="p">)[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>
    <span class="n">tristr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>

<span class="n">tristrms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">trigrid</span><span class="o">.</span><span class="n">ncpl</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">tristrms</span><span class="p">[</span><span class="n">tristr</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[59]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> tristr = []
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> ix = <span class="ansi-yellow-bg">GridIntersect</span>(trigrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> geom <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> nhddf.geometry.values:
<span class="ansi-green-fg">      4</span>     nodes = ix.intersects(geom)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">cellids</span><span class="ansi-yellow-fg">&#34;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;GridIntersect&#39; is not defined
</pre></div></div>
</div>
<p>Now to plot up the triangular grid</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">trigrid</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">trigrid</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">tristrms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[60]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">7</span>, <span class="ansi-green-fg">7</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=trigrid)
<span class="ansi-green-fg">      4</span> pc = pmv.plot_array(trigrid.top)
<span class="ansi-green-fg">      5</span> pmv.plot_array(tristrms, masked_values=[<span class="ansi-green-fg">0</span>,], alpha=<span class="ansi-green-fg">0.3</span>, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Reds_r</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_113_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_113_1.png" />
</div>
</div>
</section>
<section id="Voronoi-Mesh">
<h2>Voronoi Mesh<a class="headerlink" href="#Voronoi-Mesh" title="Link to this heading"></a></h2>
<p>A voronoi mesh can be generated from the circumcirle centroids of each triangular node in a Delaunay triangulation. The centroid of each circumcirle produces a vertex for the voronoi mesh and these vertices are connected via adjacency relationships of the triangulation.</p>
<p>FloPy has a built in utility <code class="docutils literal notranslate"><span class="pre">VoronoiGrid</span></code> that produces voronoi meshes from Delaunay triangulations. For more information and additional examples on <code class="docutils literal notranslate"><span class="pre">VoronoiGrid</span></code>’s usage, see this <a class="reference external" href="https://flopy.readthedocs.io/en/latest/Notebooks/dis_voronoi_example.html">notebook</a></p>
<p>To generate a voronoi mesh, we just need to pass our triangluation object (<code class="docutils literal notranslate"><span class="pre">tri</span></code>) to the <code class="docutils literal notranslate"><span class="pre">VoronoiGrid</span></code> utility</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vor</span> <span class="o">=</span> <span class="n">VoronoiGrid</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[61]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> vor = <span class="ansi-yellow-bg">VoronoiGrid</span>(tri)

<span class="ansi-red-fg">NameError</span>: name &#39;VoronoiGrid&#39; is not defined
</pre></div></div>
</div>
<p>Build a <code class="docutils literal notranslate"><span class="pre">VertexGrid</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gridprops</span> <span class="o">=</span> <span class="n">vor</span><span class="o">.</span><span class="n">get_gridprops_vertexgrid</span><span class="p">()</span>
<span class="n">nlay</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">idomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">gridprops</span><span class="p">[</span><span class="s2">&quot;ncpl&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">idomain</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">botm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlay</span><span class="p">,</span> <span class="n">gridprops</span><span class="p">[</span><span class="s2">&quot;ncpl&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[62]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> gridprops = <span class="ansi-yellow-bg">vor</span>.get_gridprops_vertexgrid()
<span class="ansi-green-fg">      2</span> nlay = <span class="ansi-green-fg">1</span>
<span class="ansi-green-fg">      3</span> idomain = np.ones(gridprops[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">ncpl</span><span class="ansi-yellow-fg">&#34;</span>], dtype=<span style="color: rgb(0,135,0)">int</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;vor&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vorgrid</span> <span class="o">=</span> <span class="n">VertexGrid</span><span class="p">(</span>
    <span class="n">nlay</span><span class="o">=</span><span class="n">nlay</span><span class="p">,</span> <span class="n">idomain</span><span class="o">=</span><span class="n">idomain</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">botm</span><span class="o">=</span><span class="n">botm</span><span class="p">,</span> <span class="o">**</span><span class="n">gridprops</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[63]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> vorgrid = <span class="ansi-yellow-bg">VertexGrid</span>(
<span class="ansi-green-fg">      2</span>     nlay=nlay, idomain=idomain, top=top, botm=botm, **gridprops
<span class="ansi-green-fg">      3</span> )

<span class="ansi-red-fg">NameError</span>: name &#39;VertexGrid&#39; is not defined
</pre></div></div>
</div>
<p>Resample the land surface elevation from the DEM to the voronoi grid</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top</span> <span class="o">=</span> <span class="n">rstr</span><span class="o">.</span><span class="n">resample_to_grid</span><span class="p">(</span>
    <span class="n">vorgrid</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">rstr</span><span class="o">.</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">extrapolate_edges</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">vorgrid</span><span class="o">.</span><span class="n">_top</span> <span class="o">=</span> <span class="n">top</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[64]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> top = <span class="ansi-yellow-bg">rstr</span>.resample_to_grid(
<span class="ansi-green-fg">      2</span>     vorgrid, band=rstr.bands[<span class="ansi-green-fg">0</span>], method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">min</span><span class="ansi-yellow-fg">&#34;</span>, extrapolate_edges=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">      3</span> )
<span class="ansi-green-fg">      4</span> vorgrid._top = top

<span class="ansi-red-fg">NameError</span>: name &#39;rstr&#39; is not defined
</pre></div></div>
</div>
<p>Identify stream cells with <code class="docutils literal notranslate"><span class="pre">GridIntersect</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vorst</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">GridIntersect</span><span class="p">(</span><span class="n">vorgrid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;vertex&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">geom</span><span class="p">)[</span><span class="s2">&quot;cellids&quot;</span><span class="p">]</span>
    <span class="n">vorst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>

<span class="n">vorstrms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">vorgrid</span><span class="o">.</span><span class="n">ncpl</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">vorstrms</span><span class="p">[</span><span class="n">vorst</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[65]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> vorst = []
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> ix = <span class="ansi-yellow-bg">GridIntersect</span>(vorgrid, method=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">vertex</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> geom <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> nhddf.geometry.values:
<span class="ansi-green-fg">      4</span>     nodes = ix.intersects(geom)[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">cellids</span><span class="ansi-yellow-fg">&#34;</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;GridIntersect&#39; is not defined
</pre></div></div>
</div>
<p>Finally plot the voronoi mesh with the DEM data and stream locations</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">vorgrid</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">vorgrid</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">vorstrms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
<span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[66]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots(figsize=(<span class="ansi-green-fg">7</span>, <span class="ansi-green-fg">7</span>))
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=vorgrid)
<span class="ansi-green-fg">      4</span> pc = pmv.plot_array(vorgrid.top)
<span class="ansi-green-fg">      5</span> pmv.plot_array(vorstrms, masked_values=[<span class="ansi-green-fg">0</span>], alpha=<span class="ansi-green-fg">0.3</span>, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Reds_r</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_125_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_125_1.png" />
</div>
</div>
<section id="plot-the-meshes-we-produced-side-by-side-for-comparison!">
<h3>plot the meshes we produced side by side for comparison!<a class="headerlink" href="#plot-the-meshes-we-produced-side-by-side-for-comparison!" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">flopy.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">styles</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.gridspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSpec</span>

<span class="k">with</span> <span class="n">styles</span><span class="o">.</span><span class="n">USGSMap</span><span class="p">():</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">axm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># structured grid</span>
    <span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">strms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">styles</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;A. &quot;</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;Structured Grid&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>

    <span class="c1"># non-uniform DIS</span>
    <span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">rfgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">rfgrid</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">styles</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;B.&quot;</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;Structured Grid: non-uniform&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>

    <span class="c1"># LGR grid</span>
    <span class="n">pmvp</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">sgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ptop</span> <span class="o">=</span> <span class="n">sgrid</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ptop</span><span class="p">[</span><span class="n">crow</span><span class="p">,</span> <span class="n">ccol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">strms</span><span class="p">[</span><span class="n">crow</span><span class="p">,</span> <span class="n">ccol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">pmvp</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">ptop</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">pmvp</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">strms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
    <span class="n">pmvp</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
    <span class="n">pmvp</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">pmvc</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">childgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">pmvc</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">childtop</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">pmvc</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">cstrms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
    <span class="n">pmvc</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">styles</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;C. &quot;</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;LGR Grid&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>

    <span class="c1"># Quadtree grid</span>
    <span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">quadgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">quadgrid</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">qstrms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">styles</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;D. &quot;</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;Quadtree Grid&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>

    <span class="c1"># Triangular grid</span>
    <span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">trigrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">trigrid</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">tristrms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">styles</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;E. &quot;</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;Triangular Grid&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>

    <span class="c1"># Voronoi grid</span>
    <span class="n">pmv</span> <span class="o">=</span> <span class="n">PlotMapView</span><span class="p">(</span><span class="n">modelgrid</span><span class="o">=</span><span class="n">vorgrid</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">vorgrid</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_array</span><span class="p">(</span><span class="n">vorstrms</span><span class="p">,</span> <span class="n">masked_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds_r&quot;</span><span class="p">)</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_inactive</span><span class="p">()</span>
    <span class="n">pmv</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">styles</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s2">&quot;F. &quot;</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="s2">&quot;Voronoi Grid&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>

    <span class="c1"># colorbar</span>


    <span class="c1"># ax5.spines[[&quot;left&quot;, &quot;right&quot;, &quot;top&quot;, &quot;bottom&quot;]].set_visible(False)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
        <span class="n">pc</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axm</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Land surface elevation, in meters&quot;</span><span class="p">,</span>
        <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">fraction</span><span class="o">=</span><span class="mf">.05</span>
    <span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[67]</span><span class="ansi-green-fg">, line 9</span>
<span class="ansi-green-fg">      6</span> axs = axm.ravel()
<span class="ansi-green-fg">      8</span> <span style="color: rgb(95,135,135)"># structured grid</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">9</span> pmv = <span class="ansi-yellow-bg">PlotMapView</span>(modelgrid=sgrid, ax=axs[<span class="ansi-green-fg">0</span>])
<span class="ansi-green-fg">     10</span> pmv.plot_array(sgrid.top, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">viridis</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">     11</span> pmv.plot_array(strms, masked_values=[<span class="ansi-green-fg">0</span>,], alpha=<span class="ansi-green-fg">0.3</span>, cmap=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Reds_r</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;PlotMapView&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_127_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_127_1.png" />
</div>
</div>
</section>
<section id="More-information">
<h3>More information<a class="headerlink" href="#More-information" title="Link to this heading"></a></h3>
<p>For more inforation and and examples on how to use the utilities presented in this notebook please see:</p>
<section id="Examples">
<h4>Examples<a class="headerlink" href="#Examples" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://flopy.readthedocs.io/en/latest/examples.html">FloPy Examples Gallery</a></p></li>
</ul>
</section>
<section id="API-reference">
<h4>API reference<a class="headerlink" href="#API-reference" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://flopy.readthedocs.io/en/latest/code.html#flopy-utilities">FloPy utils API reference</a></p></li>
<li><p><a class="reference external" href="https://flopy.readthedocs.io/en/latest/source/flopy.utils.lgrutil.html">FloPy lgrutil API reference</a></p></li>
<li><p><a class="reference external" href="https://flopy.readthedocs.io/en/latest/source/flopy.utils.gridgen.html">FloPy gridgen API reference</a></p></li>
<li><p><a class="reference external" href="https://flopy.readthedocs.io/en/latest/source/flopy.utils.triangle.html">FloPy triangle API reference</a></p></li>
<li><p><a class="reference external" href="https://flopy.readthedocs.io/en/latest/source/flopy.utils.voronoi.html">FloPy voronoi API reference</a></p></li>
</ul>
</section>
</section>
</section>
<section id="Activity-(If-time-permits);-Build-a-Voronoi-mesh/Vertex-Grid:">
<h2>Activity (If time permits); Build a Voronoi mesh/Vertex Grid:<a class="headerlink" href="#Activity-(If-time-permits);-Build-a-Voronoi-mesh/Vertex-Grid:" title="Link to this heading"></a></h2>
<p>Define a voronoi grid for the basin upstream of the Black Earth Creek streamgauge near Cross Plains, WI. The upstream basin information is supplied by NLDI and has been saved to the class repo in case of internet connectivity or NLDI service issues.</p>
<p>Some of the previous code can be re-used to create a voronoi mesh and subsequent <code class="docutils literal notranslate"><span class="pre">VertexGrid</span></code> representation of the basin. See the Triangular and Voronoi grid sections of the notebook.</p>
<p><strong>Optional</strong>, use the Upstream Main segment of Black Earth Creek to refine the voronoi mesh around the stream location. Refinement control points have been pre-defined below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsg</span> <span class="o">=</span> <span class="mi">5070</span>  <span class="c1"># NAD83 CONUS Albers</span>
<span class="c1"># try:</span>
    <span class="c1"># todo: update this for black earth creek near cross plains WI site-no 05406479</span>
<span class="n">be_cr_nr_cp</span> <span class="o">=</span> <span class="s2">&quot;05406479&quot;</span>
<span class="n">basindf</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">get_basin</span><span class="p">(</span>
    <span class="n">feature_source</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span> <span class="n">feature_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">be_cr_nr_cp</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">basindf</span> <span class="o">=</span> <span class="n">basindf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">)</span>
<span class="n">basindf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">geospatial_ws</span> <span class="o">/</span> <span class="s2">&quot;black_earth_basin.shp&quot;</span><span class="p">)</span>
<span class="c1"># except (ValueError, ConnectionError, NameError):</span>
<span class="c1">#     basindf = gpd.read_file(geospatial_ws / &quot;black_earth_basin.shp&quot;)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[68]</span><span class="ansi-green-fg">, line 5</span>
<span class="ansi-green-fg">      2</span> <span style="color: rgb(95,135,135)"># try:</span>
<span class="ansi-green-fg">      3</span>     <span style="color: rgb(95,135,135)"># todo: update this for black earth creek near cross plains WI site-no 05406479</span>
<span class="ansi-green-fg">      4</span> be_cr_nr_cp = <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">05406479</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">5</span> basindf = <span class="ansi-yellow-bg">nldi</span>.get_basin(
<span class="ansi-green-fg">      6</span>     feature_source=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">nwissite</span><span class="ansi-yellow-fg">&#34;</span>, feature_id=<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">USGS-</span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>be_cr_nr_cp<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">      7</span> )
<span class="ansi-green-fg">      8</span> basindf = basindf.to_crs(epsg=epsg)
<span class="ansi-green-fg">      9</span> basindf.to_file(geospatial_ws / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">black_earth_basin.shp</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;nldi&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">nhddf</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">get_flowlines</span><span class="p">(</span>
        <span class="n">navigation_mode</span><span class="o">=</span><span class="s2">&quot;UM&quot;</span><span class="p">,</span>
        <span class="n">distance</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span>
        <span class="n">feature_source</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
        <span class="n">feature_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">be_cr_nr_cp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">nhddf</span> <span class="o">=</span> <span class="n">nhddf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">)</span>
    <span class="n">nhddf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">geospatial_ws</span> <span class="o">/</span> <span class="s2">&quot;black_earth_creek_main.shp&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
    <span class="n">nhddf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geospatial_ws</span> <span class="o">/</span> <span class="s2">&quot;black_earth_creek_main.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Visualize the example “study area”</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">basindf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">nhddf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">crs</span><span class="o">=</span><span class="n">basindf</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">USGS</span><span class="o">.</span><span class="n">USTopo</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[70]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> fig, ax = plt.subplots()
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> <span class="ansi-yellow-bg">basindf</span>.plot(ax=ax, facecolor=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">None</span><span class="ansi-yellow-fg">&#34;</span>, edgecolor=<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">k</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      4</span> nhddf.plot(ax=ax)
<span class="ansi-green-fg">      5</span> ctx.add_basemap(
<span class="ansi-green-fg">      6</span>     ax=ax,
<span class="ansi-green-fg">      7</span>     crs=basindf.crs,
<span class="ansi-green-fg">      8</span>     source=ctx.providers.USGS.USTopo
<span class="ansi-green-fg">      9</span> )

<span class="ansi-red-fg">NameError</span>: name &#39;basindf&#39; is not defined
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_133_1.png" src="../../_images/notebooks_part1_flopy_05_Unstructured_Grid_generation_133_1.png" />
</div>
</div>
<p>Grid refinement control points are defined here for the optional part of this exercise</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wsloc</span> <span class="o">=</span> <span class="n">basindf</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">stloc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">nhddf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">xy</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[71]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> wsloc = <span class="ansi-yellow-bg">basindf</span>.centroid.values[<span class="ansi-green-fg">0</span>]
<span class="ansi-green-fg">      2</span> stloc = <span style="color: rgb(0,135,0)">list</span>(<span style="color: rgb(0,135,0)">zip</span>(*nhddf.geometry.values[<span class="ansi-green-fg">10</span>].xy))[<span class="ansi-green-fg">0</span>]

<span class="ansi-red-fg">NameError</span>: name &#39;basindf&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="solutions/04_Modelgrid_and_intersection_solution.html" class="btn btn-neutral float-left" title="04: Modelgrid and intersection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="solutions/06-Project-structured_completed.html" class="btn btn-neutral float-right" title="06: FloPy class project: Structured grid version" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2025, USGS Python for Hydrology instructors.
      <span class="lastupdated">Last updated on Sep 24, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>